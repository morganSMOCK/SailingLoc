<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Simple Bateau - SailingLoc</title>
  <link rel="stylesheet" href="/src/style.css">
  <style>
    body {
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    .test-container {
      max-width: 800px;
      margin: 0 auto;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .boats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .log-container {
      background: #1e1e1e;
      color: #00ff00;
      padding: 15px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    .error { color: #ff6b6b; }
    .success { color: #51cf66; }
    .warning { color: #ffd43b; }
    .info { color: #74c0fc; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üß™ Test Simple - Cr√©ation de Carte de Bateau</h1>
    
    <div class="test-section">
      <h3>üìä Test de cr√©ation de carte</h3>
      <button onclick="testSimpleCard()">Tester la cr√©ation simple</button>
      <button onclick="testWithRealData()">Tester avec donn√©es r√©elles</button>
      <button onclick="clearLogs()">Effacer les logs</button>
    </div>
    
    <div class="test-section">
      <h3>üìù Logs</h3>
      <div id="logs" class="log-container">Logs de test...\n</div>
    </div>
    
    <div class="test-section">
      <h3>üö¢ R√©sultat</h3>
      <div class="boats-grid" id="boats-grid">
        <!-- Les cartes de test appara√Ætront ici -->
      </div>
    </div>
  </div>

  <script>
    // Donn√©es de test simplifi√©es
    const simpleBoatData = {
      _id: 'test123',
      name: 'Bateau Test',
      type: 'voilier',
      location: {
        city: 'Nice',
        country: 'France'
      },
      capacity: {
        maxPeople: 8
      },
      specifications: {
        length: 12
      },
      pricing: {
        dailyRate: 150
      },
      rating: {
        average: 4.5,
        totalReviews: 10
      },
      images: [],
      imageUrls: []
    };

    function log(message, type = 'info') {
      const logsContainer = document.getElementById('logs');
      const timestamp = new Date().toLocaleTimeString();
      const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
      logsContainer.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
      logsContainer.scrollTop = logsContainer.scrollHeight;
      console.log(`[TEST] ${message}`);
    }

    function clearLogs() {
      document.getElementById('logs').innerHTML = 'Logs effac√©s...\n';
    }

    // Test simple de cr√©ation de carte
    function testSimpleCard() {
      log('üß™ Test de cr√©ation de carte simple...', 'info');
      
      try {
        const grid = document.getElementById('boats-grid');
        grid.innerHTML = '';
        
        log('üìä Donn√©es de test:', 'info');
        log(JSON.stringify(simpleBoatData, null, 2), 'info');
        
        // Cr√©er la carte manuellement
        const card = createSimpleBoatCard(simpleBoatData);
        
        if (card) {
          grid.appendChild(card);
          log('‚úÖ Carte cr√©√©e et ajout√©e avec succ√®s', 'success');
        } else {
          log('‚ùå √âchec de la cr√©ation de carte', 'error');
        }
        
      } catch (error) {
        log(`‚ùå Erreur: ${error.message}`, 'error');
        log(`üìä Stack: ${error.stack}`, 'error');
      }
    }

    // Test avec donn√©es r√©elles de l'API
    async function testWithRealData() {
      log('üß™ Test avec donn√©es r√©elles...', 'info');
      
      try {
        const grid = document.getElementById('boats-grid');
        grid.innerHTML = '';
        
        // Appel direct √† l'API
        log('üì° Appel API...', 'info');
        const response = await fetch('https://sailingloc.onrender.com/api/boats');
        const data = await response.json();
        
        log(`üìä R√©ponse API: ${data.success ? 'Succ√®s' : '√âchec'}`, data.success ? 'success' : 'error');
        
        if (data.success && data.data.boats.length > 0) {
          const boat = data.data.boats[0];
          log(`üìä Premier bateau: ${boat.name}`, 'info');
          log(JSON.stringify(boat, null, 2), 'info');
          
          const card = createSimpleBoatCard(boat);
          if (card) {
            grid.appendChild(card);
            log('‚úÖ Carte cr√©√©e avec donn√©es r√©elles', 'success');
          } else {
            log('‚ùå √âchec de la cr√©ation avec donn√©es r√©elles', 'error');
          }
        } else {
          log('‚ùå Aucun bateau trouv√© dans la r√©ponse', 'error');
        }
        
      } catch (error) {
        log(`‚ùå Erreur API: ${error.message}`, 'error');
      }
    }

    // Fonction de cr√©ation de carte simplifi√©e
    function createSimpleBoatCard(boat) {
      try {
        log('üîß D√©but de cr√©ation de carte...', 'info');
        
        // Validation
        if (!boat || !boat._id) {
          log('‚ùå Donn√©es de bateau invalides', 'error');
          return null;
        }
        
        log('‚úÖ Validation OK', 'success');
        
        // Cr√©er l'√©l√©ment
        const card = document.createElement('div');
        card.className = 'boat-card';
        card.setAttribute('data-boat-id', boat._id);
        
        log('‚úÖ √âl√©ment DOM cr√©√©', 'success');
        
        // Donn√©es nettoy√©es
        const boatName = (boat.name || 'Nom non disponible').replace(/[<>]/g, '');
        const boatType = formatBoatType(boat.type || 'voilier');
        const city = (boat.location?.city || 'Ville').replace(/[<>]/g, '');
        const country = (boat.location?.country || 'Pays').replace(/[<>]/g, '');
        const maxPeople = boat.capacity?.maxPeople || 0;
        const length = boat.specifications?.length || 0;
        const dailyRate = boat.pricing?.dailyRate || 0;
        const rating = boat.rating?.average || 0;
        const totalReviews = boat.rating?.totalReviews || 0;
        
        log(`üìä Donn√©es nettoy√©es: ${boatName}, ${boatType}, ${city}`, 'info');
        
        // Image par d√©faut
        const mainImage = 'https://images.pexels.com/photos/1001682/pexels-photo-1001682.jpeg?auto=compress&cs=tinysrgb&w=400&h=300&fit=crop';
        
        // √âtoiles
        const starsHTML = renderStars(rating);
        log(`‚≠ê √âtoiles g√©n√©r√©es: ${starsHTML}`, 'info');
        
        // HTML
        card.innerHTML = `
          <div class="boat-image">
            <img src="${mainImage}" alt="${boatName}" loading="lazy">
            <div class="boat-badge">${boatType}</div>
            <div class="boat-rating">
              <span class="rating-stars">${starsHTML}</span>
              <span class="rating-count">(${totalReviews})</span>
            </div>
          </div>
          <div class="boat-content">
            <h3 class="boat-name">${boatName}</h3>
            <p class="boat-location">üìç ${city}, ${country}</p>
            <div class="boat-specs">
              <span class="spec">üë• ${maxPeople} pers.</span>
              <span class="spec">üìè ${length}m</span>
            </div>
            <div class="boat-price">
              <span class="price">${dailyRate}‚Ç¨</span>
              <span class="price-unit">/jour</span>
            </div>
            <button class="btn-primary btn-full boat-details-btn">Voir les d√©tails</button>
          </div>
        `;
        
        log('‚úÖ innerHTML d√©fini', 'success');
        
        // V√©rifier le contenu
        log(`üìä Contenu de la carte: ${card.innerHTML.length} caract√®res`, 'info');
        log(`üìä Nombre d'enfants: ${card.children.length}`, 'info');
        
        return card;
        
      } catch (error) {
        log(`‚ùå Erreur dans createSimpleBoatCard: ${error.message}`, 'error');
        log(`üìä Stack: ${error.stack}`, 'error');
        return null;
      }
    }

    // Fonctions utilitaires
    function formatBoatType(type) {
      const types = {
        'voilier': 'Voilier',
        'catamaran': 'Catamaran',
        'yacht': 'Yacht',
        'bateau_moteur': 'Bateau √† moteur',
        'bateau √† moteur': 'Bateau √† moteur',
        'semi_rigide': 'Semi-rigide',
        'peniche': 'P√©niche'
      };
      return types[type] || type;
    }

    function renderStars(rating) {
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 >= 0.5;
      const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
      
      let stars = '';
      
      // √âtoiles pleines
      for (let i = 0; i < fullStars; i++) {
        stars += '‚≠ê';
      }
      
      // Demi-√©toile
      if (hasHalfStar) {
        stars += '‚≠ê';
      }
      
      // √âtoiles vides
      for (let i = 0; i < emptyStars; i++) {
        stars += '‚òÜ';
      }
      
      return stars;
    }

    // Initialisation
    log('üöÄ Page de test charg√©e', 'success');
    log('üí° Cliquez sur "Tester la cr√©ation simple" pour commencer', 'info');
  </script>
</body>
</html>
