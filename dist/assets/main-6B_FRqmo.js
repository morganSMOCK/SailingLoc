/* empty css              */(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();class j{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.authEndpoint=`${this.baseURL}/auth`}async register(e){try{const t=await fetch(`${this.authEndpoint}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log("üì° R√©ponse HTTP:",{status:t.status,statusText:t.statusText,ok:t.ok,url:t.url});let r;try{r=await t.json(),console.log("üìä Donn√©es JSON re√ßues:",r)}catch(o){console.error("‚ùå Erreur parsing JSON:",o);const s=await t.text();throw console.log("üìÑ R√©ponse texte:",s),new Error(`R√©ponse invalide du serveur: ${t.status}`)}if(!t.ok)throw console.error("‚ùå R√©ponse HTTP non-OK:",t.status,r),new Error(r.message||"Erreur lors de l'inscription");return r}catch(t){throw console.error("‚ùå Erreur AuthService.register:",t),t}}async login(e,t){try{const r=`${this.authEndpoint}/login`;console.log("üîê AuthService.login appel√©"),console.log("üìç URL:",r),console.log("üìä Donn√©es:",{email:e,password:t?"***":"vide"});const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});console.log("üì° R√©ponse HTTP:",{status:o.status,statusText:o.statusText,ok:o.ok,url:o.url});let s;try{s=await o.json(),console.log("üìä Donn√©es JSON re√ßues:",s)}catch(a){console.error("‚ùå Erreur parsing JSON:",a);const n=await o.text();throw console.log("üìÑ R√©ponse texte:",n),new Error(`R√©ponse invalide du serveur: ${o.status}`)}if(!o.ok)throw console.error("‚ùå R√©ponse HTTP non-OK:",o.status,s),new Error(s.message||"Erreur lors de la connexion");return s}catch(r){throw console.error("‚ùå Erreur AuthService.login:",r),r}}async logout(){try{const e=this.getAuthToken(),t=`${this.authEndpoint}/logout`;console.log("üö™ AuthService.logout appel√©"),console.log("üìç URL:",t);const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}}});let o;try{o=await r.json()}catch{o={success:r.ok}}if(!r.ok)throw new Error(o.message||"Erreur lors de la d√©connexion");return this.clearAuthData(),o}catch(e){throw console.error("Erreur lors de la d√©connexion:",e),this.clearAuthData(),e}}async getProfile(){try{const e=this.getAuthToken();if(!e)throw new Error("Token d'authentification manquant");const t=await fetch(`${this.authEndpoint}/profile`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la r√©cup√©ration du profil");return r}catch(e){throw console.error("Erreur lors de la r√©cup√©ration du profil:",e),e}}async updateProfile(e){try{const t=this.getAuthToken();if(!t)throw new Error("Token d'authentification manquant");const r=await fetch(`${this.authEndpoint}/profile`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)}),o=await r.json();if(!r.ok)throw new Error(o.message||"Erreur lors de la mise √† jour du profil");return o}catch(t){throw console.error("Erreur lors de la mise √† jour du profil:",t),t}}async changePassword(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Token d'authentification manquant");const o=await fetch(`${this.authEndpoint}/change-password`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors du changement de mot de passe");return s}catch(r){throw console.error("Erreur lors du changement de mot de passe:",r),r}}async verifyToken(){try{const e=this.getAuthToken();if(!e)throw new Error("Aucun token trouv√©");const t=await fetch(`${this.authEndpoint}/verify-token`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Token invalide");return r}catch(e){throw console.error("Erreur lors de la v√©rification du token:",e),e}}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}isAuthenticated(){const e=this.getAuthToken();if(!e)return!1;try{const t=JSON.parse(atob(e.split(".")[1])),r=Date.now()/1e3;return t.exp>r}catch(t){return console.error("Token invalide:",t),!1}}getCurrentUser(){try{const e=localStorage.getItem("sailingloc_user");return e?JSON.parse(e):null}catch(e){return console.error("Erreur lors de la r√©cup√©ration des donn√©es utilisateur:",e),null}}clearAuthData(){try{localStorage.removeItem("sailingloc_token"),localStorage.removeItem("sailingloc_user")}catch(e){console.error("Erreur lors du nettoyage des donn√©es d'authentification:",e)}}handleAuthError(e){return(e.message.includes("Token")||e.message.includes("401"))&&this.clearAuthData(),{success:!1,message:e.message||"Erreur d'authentification",error:e}}async refreshToken(){try{const e=this.getAuthToken();if(!e)throw new Error("Aucun token √† rafra√Æchir");const t=await fetch(`${this.authEndpoint}/refresh-token`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors du rafra√Æchissement du token");return r.data&&r.data.token&&localStorage.setItem("sailingloc_token",r.data.token),r}catch(e){throw console.error("Erreur lors du rafra√Æchissement du token:",e),this.clearAuthData(),e}}async authenticatedFetch(e,t={}){const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const o={...t,headers:{...t.headers,Authorization:`Bearer ${r}`,"Content-Type":"application/json"}};try{const s=await fetch(e,o);if(s.status===401)try{await this.refreshToken();const a=this.getAuthToken();return o.headers.Authorization=`Bearer ${a}`,await fetch(e,o)}catch{throw this.clearAuthData(),new Error("Session expir√©e, veuillez vous reconnecter")}return s}catch(s){throw console.error("Erreur lors de la requ√™te authentifi√©e:",s),s}}}class R{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.boatsEndpoint=`${this.baseURL}/boats`}async getBoats(e={}){try{const t=new URLSearchParams;Object.keys(e).forEach(a=>{e[a]!==void 0&&e[a]!==""&&t.append(a,e[a])});const r=`${this.boatsEndpoint}?${t.toString()}`,o=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la r√©cup√©ration des bateaux");return s}catch(t){throw console.error("Erreur lors de la r√©cup√©ration des bateaux:",t),t}}async getBoatById(e){try{const t=await fetch(`${this.boatsEndpoint}/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la r√©cup√©ration du bateau");return r}catch(t){throw console.error("Erreur lors de la r√©cup√©ration du bateau:",t),t}}async createBoat(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(this.boatsEndpoint,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:e}),o=await r.json();if(!r.ok)throw new Error(o.message||"Erreur lors de la cr√©ation du bateau");return o}catch(t){throw console.error("Erreur lors de la cr√©ation du bateau:",t),t}}async updateBoat(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const o=await fetch(`${this.boatsEndpoint}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(t)}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la mise √† jour du bateau");return s}catch(r){throw console.error("Erreur lors de la mise √† jour du bateau:",r),r}}async getOwnerBoats(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams(e),o=`${this.boatsEndpoint}/owner/my-boats?${r.toString()}`,s=await fetch(o,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),a=await s.json();if(!s.ok)throw new Error(a.message||"Erreur lors de la r√©cup√©ration des bateaux");return a}catch(t){throw console.error("Erreur lors de la r√©cup√©ration des bateaux du propri√©taire:",t),t}}async checkAvailability(e,t,r){try{const o=new URLSearchParams({startDate:t,endDate:r}),s=await fetch(`${this.boatsEndpoint}/${e}/availability?${o.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}}),a=await s.json();if(!s.ok)throw new Error(a.message||"Erreur lors de la v√©rification de disponibilit√©");return a}catch(o){throw console.error("Erreur lors de la v√©rification de disponibilit√©:",o),o}}async searchNearby(e,t,r=5e4){try{const o=new URLSearchParams({latitude:e.toString(),longitude:t.toString(),maxDistance:r.toString()}),s=await fetch(`${this.boatsEndpoint}/search/nearby?${o.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}}),a=await s.json();if(!s.ok)throw new Error(a.message||"Erreur lors de la recherche par proximit√©");return a}catch(o){throw console.error("Erreur lors de la recherche par proximit√©:",o),o}}async getOwnerBoats(e={}){var t,r;try{const o=this.getAuthToken();if(!o)throw console.error("‚ùå [BOAT SERVICE] Token manquant pour getOwnerBoats"),new Error("Authentification requise");console.log("üö§ [BOAT SERVICE] R√©cup√©ration des bateaux du propri√©taire"),console.log("üîê [BOAT SERVICE] Token pr√©sent:",o?"Oui":"Non");const s=new URLSearchParams;Object.keys(e).forEach(c=>{e[c]!==void 0&&e[c]!==""&&s.append(c,e[c])});const a=`${this.boatsEndpoint}/owner/my-boats?${s.toString()}`;console.log("üì° [BOAT SERVICE] URL getOwnerBoats:",a);const n=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});console.log("üì° [BOAT SERVICE] R√©ponse getOwnerBoats:",{status:n.status,statusText:n.statusText,ok:n.ok});const i=await n.json();if(!n.ok)throw console.error("‚ùå [BOAT SERVICE] Erreur getOwnerBoats:",i),n.status===401?new Error("Authentification requise - Token expir√© ou invalide"):n.status===403?new Error("Permissions insuffisantes pour acc√©der aux bateaux"):new Error(i.message||"Erreur lors de la r√©cup√©ration des bateaux du propri√©taire");return console.log("‚úÖ [BOAT SERVICE] Bateaux r√©cup√©r√©s avec succ√®s:",((r=(t=i.data)==null?void 0:t.boats)==null?void 0:r.length)||0,"bateaux"),i}catch(o){throw console.error("‚ùå [BOAT SERVICE] Erreur lors de la r√©cup√©ration des bateaux du propri√©taire:",o),o}}async getBoatStats(){try{const e=this.getAuthToken();if(!e)throw console.error("‚ùå [BOAT SERVICE] Token manquant pour getBoatStats"),new Error("Authentification requise");console.log("üìä [BOAT SERVICE] R√©cup√©ration des statistiques des bateaux"),console.log("üîê [BOAT SERVICE] Token pr√©sent:",e?"Oui":"Non");const t=await fetch(`${this.boatsEndpoint}/stats/overview`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});console.log("üì° [BOAT SERVICE] R√©ponse getBoatStats:",{status:t.status,statusText:t.statusText,ok:t.ok});const r=await t.json();if(!t.ok)throw console.error("‚ùå [BOAT SERVICE] Erreur getBoatStats:",r),t.status===401?new Error("Authentification requise - Token expir√© ou invalide"):t.status===403?new Error("Permissions insuffisantes pour acc√©der aux statistiques"):new Error(r.message||"Erreur lors de la r√©cup√©ration des statistiques");return console.log("‚úÖ [BOAT SERVICE] Statistiques r√©cup√©r√©es avec succ√®s"),r}catch(e){throw console.error("‚ùå [BOAT SERVICE] Erreur lors de la r√©cup√©ration des statistiques:",e),e}}async uploadBoatImages(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const o=new FormData;Array.from(t).forEach((n,i)=>{o.append("images",n)});const s=await fetch(`${this.boatsEndpoint}/${e}/images`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:o}),a=await s.json();if(!s.ok)throw new Error(a.message||"Erreur lors de l'upload des images");return a}catch(r){throw console.error("Erreur lors de l'upload des images:",r),r}}async deleteBoatImage(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const o=await fetch(`${this.boatsEndpoint}/${e}/images/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la suppression de l'image");return s}catch(r){throw console.error("Erreur lors de la suppression de l'image:",r),r}}async updateBoat(e,t,r=null){try{const o=this.getAuthToken();if(!o)throw new Error("Authentification requise");const s=new FormData;Object.keys(t).forEach(i=>{t[i]!==void 0&&t[i]!==null&&(typeof t[i]=="object"?s.append(i,JSON.stringify(t[i])):s.append(i,t[i]))}),r&&r.length>0&&r.forEach(i=>{s.append("images",i)});const a=await fetch(`${this.boatsEndpoint}/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${o}`},body:s}),n=await a.json();if(!a.ok)throw new Error(n.message||"Erreur lors de la mise √† jour du bateau");return n}catch(o){throw console.error("Erreur lors de la mise √† jour du bateau:",o),o}}async deleteBoat(e,t=!1){try{const r=this.getAuthToken();if(!r)throw console.error("‚ùå [BOAT SERVICE] Token manquant pour la suppression"),new Error("Authentification requise");console.log("üóëÔ∏è [BOAT SERVICE] Suppression du bateau:",e),console.log("üîê [BOAT SERVICE] Token pr√©sent:",r?"Oui":"Non"),console.log("üîê [BOAT SERVICE] Token (premiers caract√®res):",r?r.substring(0,20)+"...":"N/A");const o=t?"?force=true":"",s=`${this.boatsEndpoint}/${e}${o}`;console.log("üì° [BOAT SERVICE] URL de suppression:",s);const a=await fetch(s,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});console.log("üì° [BOAT SERVICE] R√©ponse HTTP:",{status:a.status,statusText:a.statusText,ok:a.ok});const n=await a.json();if(!a.ok)throw console.error("‚ùå [BOAT SERVICE] Erreur de suppression:",n),a.status===401?new Error("Authentification requise - Token expir√© ou invalide"):a.status===403?new Error("Permissions insuffisantes pour supprimer ce bateau"):new Error(n.message||"Erreur lors de la suppression du bateau");return console.log("‚úÖ [BOAT SERVICE] Suppression r√©ussie:",n),n}catch(r){throw console.error("‚ùå [BOAT SERVICE] Erreur lors de la suppression du bateau:",r),r}}async restoreBoat(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.boatsEndpoint}/${e}/restore`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),o=await r.json();if(!r.ok)throw new Error(o.message||"Erreur lors de la restauration du bateau");return o}catch(t){throw console.error("Erreur lors de la restauration du bateau:",t),t}}async setMainImage(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const o=await fetch(`${this.boatsEndpoint}/${e}/images/${t}/main`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la d√©finition de l'image principale");return s}catch(r){throw console.error("Erreur lors de la d√©finition de l'image principale:",r),r}}getBoatTypes(){return[{value:"voilier",label:"Voilier"},{value:"catamaran",label:"Catamaran"},{value:"yacht",label:"Yacht"},{value:"bateau_moteur",label:"Bateau √† moteur"},{value:"semi_rigide",label:"Semi-rigide"},{value:"peniche",label:"P√©niche"}]}getBoatCategories(){return[{value:"luxe",label:"Luxe"},{value:"standard",label:"Standard"},{value:"economique",label:"√âconomique"},{value:"sportif",label:"Sportif"},{value:"familial",label:"Familial"}]}validateBoatData(e){const t=[];return(!e.name||e.name.trim().length===0)&&t.push("Le nom du bateau est obligatoire"),(!e.description||e.description.trim().length===0)&&t.push("La description est obligatoire"),e.type||t.push("Le type de bateau est obligatoire"),e.category||t.push("La cat√©gorie est obligatoire"),e.specifications?((!e.specifications.length||e.specifications.length<=0)&&t.push("La longueur doit √™tre positive"),(!e.specifications.width||e.specifications.width<=0)&&t.push("La largeur doit √™tre positive")):t.push("Les sp√©cifications sont obligatoires"),e.capacity?(!e.capacity.maxPeople||e.capacity.maxPeople<=0)&&t.push("Le nombre maximum de personnes doit √™tre positif"):t.push("La capacit√© est obligatoire"),e.location?((!e.location.marina||e.location.marina.trim().length===0)&&t.push("Le port d'attache est obligatoire"),(!e.location.city||e.location.city.trim().length===0)&&t.push("La ville est obligatoire")):t.push("La localisation est obligatoire"),e.pricing?((!e.pricing.dailyRate||e.pricing.dailyRate<=0)&&t.push("Le tarif journalier doit √™tre positif"),(!e.pricing.securityDeposit||e.pricing.securityDeposit<0)&&t.push("La caution ne peut pas √™tre n√©gative")):t.push("Les tarifs sont obligatoires"),{isValid:t.length===0,errors:t}}getAuthToken(){try{if(window.app&&window.app.storageManager){const t=window.app.storageManager.getToken();return console.log("üîê [BOAT SERVICE] Token r√©cup√©r√© via StorageManager:",t?"Pr√©sent":"Absent"),t}const e=localStorage.getItem("sailingloc_token");return console.log("üîê [BOAT SERVICE] Token r√©cup√©r√© via localStorage:",e?"Pr√©sent":"Absent"),e}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}formatBoatForDisplay(e){var t,r,o,s,a,n;return{...e,formattedPrice:`${e.pricing.dailyRate}‚Ç¨/jour`,formattedCapacity:`${e.capacity.maxPeople} personnes`,formattedLength:`${e.specifications.length}m`,formattedLocation:`${e.location.city}, ${e.location.country}`,mainImage:((r=(t=e.images)==null?void 0:t.find(i=>i.isMain))==null?void 0:r.url)||((s=(o=e.images)==null?void 0:o[0])==null?void 0:s.url),rating:{...e.rating,formattedAverage:((n=(a=e.rating)==null?void 0:a.average)==null?void 0:n.toFixed(1))||"0.0"}}}calculateTotalPrice(e,t,r){const o=new Date(t),s=new Date(r),a=Math.ceil((s-o)/(1e3*60*60*24));let n=0;if(a>=30&&e.pricing.monthlyRate){const i=Math.floor(a/30),c=a%30;n=i*e.pricing.monthlyRate+c*e.pricing.dailyRate}else if(a>=7&&e.pricing.weeklyRate){const i=Math.floor(a/7),c=a%7;n=i*e.pricing.weeklyRate+c*e.pricing.dailyRate}else n=a*e.pricing.dailyRate;return{days:a,subtotal:n,cleaningFee:e.pricing.cleaningFee||0,securityDeposit:e.pricing.securityDeposit,total:n+(e.pricing.cleaningFee||0)}}}class D{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.bookingsEndpoint=`${this.baseURL}/bookings`}async createBooking(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(this.bookingsEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)}),o=await r.json();if(!r.ok)throw new Error(o.message||"Erreur lors de la cr√©ation de la r√©servation");return o}catch(t){throw console.error("Erreur lors de la cr√©ation de la r√©servation:",t),t}}async getUserBookings(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams;Object.keys(e).forEach(n=>{e[n]!==void 0&&e[n]!==""&&r.append(n,e[n])});const o=`${this.bookingsEndpoint}?${r.toString()}`,s=await fetch(o,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),a=await s.json();if(!s.ok)throw new Error(a.message||"Erreur lors de la r√©cup√©ration des r√©servations");return a}catch(t){throw console.error("Erreur lors de la r√©cup√©ration des r√©servations:",t),t}}async getBookingById(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.bookingsEndpoint}/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),o=await r.json();if(!r.ok)throw new Error(o.message||"Erreur lors de la r√©cup√©ration de la r√©servation");return o}catch(t){throw console.error("Erreur lors de la r√©cup√©ration de la r√©servation:",t),t}}async confirmBooking(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.bookingsEndpoint}/${e}/confirm`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),o=await r.json();if(!r.ok)throw new Error(o.message||"Erreur lors de la confirmation de la r√©servation");return o}catch(t){throw console.error("Erreur lors de la confirmation de la r√©servation:",t),t}}async cancelBooking(e,t=""){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const o=await fetch(`${this.bookingsEndpoint}/${e}/cancel`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({reason:t})}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de l'annulation de la r√©servation");return s}catch(r){throw console.error("Erreur lors de l'annulation de la r√©servation:",r),r}}async checkIn(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const o=await fetch(`${this.bookingsEndpoint}/${e}/checkin`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors du check-in");return s}catch(r){throw console.error("Erreur lors du check-in:",r),r}}async checkOut(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const o=await fetch(`${this.bookingsEndpoint}/${e}/checkout`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors du check-out");return s}catch(r){throw console.error("Erreur lors du check-out:",r),r}}async addReview(e,t,r){try{const o=this.getAuthToken();if(!o)throw new Error("Authentification requise");const s=await fetch(`${this.bookingsEndpoint}/${e}/review`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({rating:t,comment:r})}),a=await s.json();if(!s.ok)throw new Error(a.message||"Erreur lors de l'ajout de l'avis");return a}catch(o){throw console.error("Erreur lors de l'ajout de l'avis:",o),o}}async getBookingStats(){try{const e=this.getAuthToken();if(!e)throw new Error("Authentification requise");const t=await fetch(`${this.bookingsEndpoint}/stats/overview`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la r√©cup√©ration des statistiques");return r}catch(e){throw console.error("Erreur lors de la r√©cup√©ration des statistiques:",e),e}}validateBookingData(e){const t=[];if(e.boatId||t.push("L'ID du bateau est obligatoire"),e.startDate||t.push("La date de d√©but est obligatoire"),e.endDate||t.push("La date de fin est obligatoire"),e.startDate&&e.endDate){const r=new Date(e.startDate),o=new Date(e.endDate),s=new Date;s.setHours(0,0,0,0),r<s&&t.push("La date de d√©but ne peut pas √™tre dans le pass√©"),o<=r&&t.push("La date de fin doit √™tre post√©rieure √† la date de d√©but");const a=new Date;a.setFullYear(a.getFullYear()+1),r>a&&t.push("La r√©servation ne peut pas √™tre faite plus d'un an √† l'avance")}return e.participants?((!e.participants.adults||e.participants.adults<1)&&t.push("Il doit y avoir au moins 1 adulte"),e.participants.children&&e.participants.children<0&&t.push("Le nombre d'enfants ne peut pas √™tre n√©gatif")):t.push("Les informations sur les participants sont obligatoires"),e.emergencyContact?((!e.emergencyContact.name||e.emergencyContact.name.trim().length===0)&&t.push("Le nom du contact d'urgence est obligatoire"),(!e.emergencyContact.phone||e.emergencyContact.phone.trim().length===0)&&t.push("Le t√©l√©phone du contact d'urgence est obligatoire"),(!e.emergencyContact.relationship||e.emergencyContact.relationship.trim().length===0)&&t.push("La relation avec le contact d'urgence est obligatoire")):t.push("Le contact d'urgence est obligatoire"),e.renterExperience?(e.renterExperience.hasLicense===void 0&&t.push("L'information sur le permis nautique est obligatoire"),e.renterExperience.yearsOfExperience!==void 0&&e.renterExperience.yearsOfExperience<0&&t.push("Les ann√©es d'exp√©rience ne peuvent pas √™tre n√©gatives")):t.push("Les informations sur l'exp√©rience nautique sont obligatoires"),{isValid:t.length===0,errors:t}}calculateCancellationFees(e){const t=new Date,r=new Date(e.startDate),o=Math.ceil((r-t)/(1e3*60*60*24));let s=0;o<1?s=100:o<7?s=50:o<14?s=25:o<30&&(s=10);const a=e.pricing.totalAmount*s/100,n=e.pricing.totalAmount-a;return{daysUntilStart:o,feePercentage:s,cancellationFee:a,refundAmount:n,canCancel:o>=0}}formatBookingForDisplay(e){const t=new Date(e.startDate),r=new Date(e.endDate),o=Math.ceil((r-t)/(1e3*60*60*24));return{...e,formattedStartDate:t.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),formattedEndDate:r.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),formattedDuration:`${o} jour${o>1?"s":""}`,formattedTotalAmount:`${e.pricing.totalAmount}‚Ç¨`,formattedStatus:this.getStatusLabel(e.status),statusColor:this.getStatusColor(e.status),canCancel:this.canCancelBooking(e),canReview:this.canReviewBooking(e)}}getStatusLabel(e){return{pending:"En attente",confirmed:"Confirm√©e",paid:"Pay√©e",active:"En cours",completed:"Termin√©e",cancelled:"Annul√©e",refunded:"Rembours√©e"}[e]||e}getStatusColor(e){return{pending:"status-warning",confirmed:"status-info",paid:"status-success",active:"status-primary",completed:"status-success",cancelled:"status-danger",refunded:"status-secondary"}[e]||"status-default"}canCancelBooking(e){const t=["pending","confirmed","paid"],r=new Date,o=new Date(e.startDate);return t.includes(e.status)&&o>r}canReviewBooking(e){var t;return e.status==="completed"&&!((t=e.review)!=null&&t.renterReview)}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}createDefaultBookingData(e){const t=new Date;t.setDate(t.getDate()+1);const r=new Date;return r.setDate(r.getDate()+2),{boatId:e,startDate:t.toISOString().split("T")[0],endDate:r.toISOString().split("T")[0],participants:{adults:2,children:0},emergencyContact:{name:"",phone:"",relationship:""},renterExperience:{hasLicense:!1,licenseType:"",yearsOfExperience:0,previousBoatTypes:[],additionalInfo:""},specialRequests:"",skipperRequested:!1,additionalServices:[]}}toCalendarEvent(e){return{id:e._id,title:`${e.boat.name} - ${e.bookingNumber}`,start:e.startDate,end:e.endDate,color:this.getStatusColor(e.status),extendedProps:{booking:e,status:e.status,boatName:e.boat.name,totalAmount:e.pricing.totalAmount}}}}class q{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.paymentsEndpoint=`${this.baseURL}/payments`,this.stripePublishableKey=void 0,this.stripe=null,this.initializeStripe()}async initializeStripe(){if(this.stripePublishableKey&&window.Stripe)try{this.stripe=window.Stripe(this.stripePublishableKey),console.log("‚úÖ Stripe initialis√©")}catch(e){console.error("‚ùå Erreur lors de l'initialisation de Stripe:",e)}else console.log("‚ÑπÔ∏è Stripe non configur√© - Mode simulation activ√©")}async createPaymentIntent(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.paymentsEndpoint}/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({bookingId:e})}),o=await r.json();if(!r.ok)throw new Error(o.message||"Erreur lors de la cr√©ation du paiement");return o}catch(t){throw console.error("Erreur lors de la cr√©ation du Payment Intent:",t),t}}async confirmPayment(e,t=null){try{if(!this.getAuthToken())throw new Error("Authentification requise");return this.stripe&&t?await this.confirmStripePayment(e,t):await this.confirmSimulatedPayment(e,t)}catch(r){throw console.error("Erreur lors de la confirmation du paiement:",r),r}}async confirmStripePayment(e,t){try{const{error:r,paymentIntent:o}=await this.stripe.confirmCardPayment(e,{payment_method:t});if(r)throw new Error(r.message);return o.status==="succeeded"?await this.notifyPaymentSuccess(e):{success:!1,message:"Le paiement n'a pas pu √™tre trait√©"}}catch(r){throw console.error("Erreur lors du paiement Stripe:",r),r}}async confirmSimulatedPayment(e,t){try{const r=this.getAuthToken(),o=await fetch(`${this.paymentsEndpoint}/confirm-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({paymentIntentId:e,paymentMethodId:t||"pm_simulation_card"})}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la confirmation du paiement");return s}catch(r){throw console.error("Erreur lors du paiement simul√©:",r),r}}async notifyPaymentSuccess(e){try{const t=this.getAuthToken(),r=await fetch(`${this.paymentsEndpoint}/confirm-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({paymentIntentId:e})}),o=await r.json();if(!r.ok)throw new Error(o.message||"Erreur lors de la notification du paiement");return o}catch(t){throw console.error("Erreur lors de la notification du paiement:",t),t}}async refundPayment(e,t=null,r=""){try{const o=this.getAuthToken();if(!o)throw new Error("Authentification requise");const s=await fetch(`${this.paymentsEndpoint}/refund`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({bookingId:e,amount:t,reason:r})}),a=await s.json();if(!s.ok)throw new Error(a.message||"Erreur lors du remboursement");return a}catch(o){throw console.error("Erreur lors du remboursement:",o),o}}async getPaymentHistory(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams;Object.keys(e).forEach(n=>{e[n]!==void 0&&e[n]!==""&&r.append(n,e[n])});const o=`${this.paymentsEndpoint}/history?${r.toString()}`,s=await fetch(o,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),a=await s.json();if(!s.ok)throw new Error(a.message||"Erreur lors de la r√©cup√©ration de l'historique");return a}catch(t){throw console.error("Erreur lors de la r√©cup√©ration de l'historique des paiements:",t),t}}async getPaymentStats(){try{const e=this.getAuthToken();if(!e)throw new Error("Authentification requise");const t=await fetch(`${this.paymentsEndpoint}/stats`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la r√©cup√©ration des statistiques");return r}catch(e){throw console.error("Erreur lors de la r√©cup√©ration des statistiques de paiement:",e),e}}createSimulatedPaymentForm(e,t){const r=document.createElement("form");return r.className="payment-form",r.innerHTML=`
      <div class="payment-header">
        <h3>Paiement s√©curis√©</h3>
        <p class="payment-amount">Montant: ${(e.amount/100).toFixed(2)}‚Ç¨</p>
      </div>
      
      <div class="payment-method">
        <h4>Mode de paiement</h4>
        <div class="payment-options">
          <label class="payment-option">
            <input type="radio" name="payment-method" value="card" checked>
            <span class="option-label">
              üí≥ Carte bancaire
            </span>
          </label>
        </div>
      </div>
      
      <div class="card-form" id="card-form">
        <div class="form-group">
          <label for="card-number">Num√©ro de carte</label>
          <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="card-expiry">MM/AA</label>
            <input type="text" id="card-expiry" placeholder="12/25" maxlength="5" required>
          </div>
          <div class="form-group">
            <label for="card-cvc">CVC</label>
            <input type="text" id="card-cvc" placeholder="123" maxlength="4" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="card-name">Nom sur la carte</label>
          <input type="text" id="card-name" placeholder="Jean Dupont" required>
        </div>
      </div>
      
      <div class="payment-summary">
        <div class="summary-line">
          <span>Sous-total:</span>
          <span>${(e.amount/100).toFixed(2)}‚Ç¨</span>
        </div>
        <div class="summary-line total">
          <span>Total:</span>
          <span>${(e.amount/100).toFixed(2)}‚Ç¨</span>
        </div>
      </div>
      
      <button type="submit" class="btn-primary btn-full payment-submit">
        Payer ${(e.amount/100).toFixed(2)}‚Ç¨
      </button>
      
      <div class="payment-security">
        <p>üîí Paiement s√©curis√© SSL</p>
      </div>
    `,this.setupCardFormatting(r),r.addEventListener("submit",async o=>{o.preventDefault();try{const s=r.querySelector(".payment-submit"),a=s.textContent;s.disabled=!0,s.textContent="Traitement...",await new Promise(i=>setTimeout(i,2e3));const n=await this.confirmPayment(e.id);if(n.success)this.showPaymentSuccess(t,n.data);else throw new Error(n.message||"Erreur de paiement")}catch(s){console.error("Erreur de paiement:",s),this.showPaymentError(t,s.message);const a=r.querySelector(".payment-submit");a.disabled=!1,a.textContent=originalText}}),t.innerHTML="",t.appendChild(r),{form:r,submit:()=>r.dispatchEvent(new Event("submit"))}}setupCardFormatting(e){const t=e.querySelector("#card-number"),r=e.querySelector("#card-expiry"),o=e.querySelector("#card-cvc");t&&t.addEventListener("input",s=>{var i;let a=s.target.value.replace(/\s/g,"").replace(/[^0-9]/gi,""),n=((i=a.match(/.{1,4}/g))==null?void 0:i.join(" "))||a;s.target.value=n}),r&&r.addEventListener("input",s=>{let a=s.target.value.replace(/\D/g,"");a.length>=2&&(a=a.substring(0,2)+"/"+a.substring(2,4)),s.target.value=a}),o&&o.addEventListener("input",s=>{s.target.value=s.target.value.replace(/[^0-9]/g,"")})}showPaymentSuccess(e,t){e.innerHTML=`
      <div class="payment-success">
        <div class="success-icon">‚úÖ</div>
        <h3>Paiement r√©ussi !</h3>
        <p>Votre r√©servation a √©t√© confirm√©e.</p>
        <div class="payment-details">
          <p><strong>Num√©ro de r√©servation:</strong> ${t.booking.bookingNumber}</p>
          <p><strong>Montant pay√©:</strong> ${t.payment.amount}‚Ç¨</p>
        </div>
        <button class="btn-primary" onclick="window.location.reload()">
          Retour √† l'accueil
        </button>
      </div>
    `}showPaymentError(e,t){const r=document.createElement("div");r.className="payment-error",r.innerHTML=`
      <div class="error-icon">‚ùå</div>
      <p><strong>Erreur de paiement:</strong> ${t}</p>
      <button class="btn-secondary" onclick="this.parentElement.remove()">
        R√©essayer
      </button>
    `,e.insertBefore(r,e.firstChild),setTimeout(()=>{r.parentElement&&r.remove()},5e3)}validateCardData(e){const t=[];if((!e.number||e.number.replace(/\s/g,"").length<13)&&t.push("Num√©ro de carte invalide"),!e.expiry||!/^\d{2}\/\d{2}$/.test(e.expiry))t.push("Date d'expiration invalide (MM/AA)");else{const[r,o]=e.expiry.split("/"),s=new Date,a=s.getFullYear()%100,n=s.getMonth()+1;(parseInt(r)<1||parseInt(r)>12)&&t.push("Mois d'expiration invalide"),(parseInt(o)<a||parseInt(o)===a&&parseInt(r)<n)&&t.push("Carte expir√©e")}return(!e.cvc||e.cvc.length<3||e.cvc.length>4)&&t.push("Code CVC inval ide"),(!e.name||e.name.trim().length<2)&&t.push("Nom sur la carte requis"),{isValid:t.length===0,errors:t}}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}formatAmount(e,t="EUR"){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:t}).format(e/100)}isStripeReady(){return this.stripe!==null&&this.stripePublishableKey!==void 0}async loadStripe(){if(window.Stripe)return!0;try{const e=document.createElement("script");return e.src="https://js.stripe.com/v3/",e.async=!0,new Promise((t,r)=>{e.onload=()=>{this.initializeStripe(),t(!0)},e.onerror=()=>r(!1),document.head.appendChild(e)})}catch(e){return console.error("Erreur lors du chargement de Stripe:",e),!1}}}class F{constructor(){this.notificationContainer=null,this.notificationQueue=[],this.maxNotifications=5,this.activeModals=new Set,this.loadingElements=new Map,this.init()}init(){this.createNotificationContainer(),this.setupGlobalEventListeners(),this.setupKeyboardShortcuts()}createNotificationContainer(){this.notificationContainer=document.getElementById("notifications"),this.notificationContainer||(this.notificationContainer=document.createElement("div"),this.notificationContainer.id="notifications",this.notificationContainer.className="notifications",document.body.appendChild(this.notificationContainer))}setupGlobalEventListeners(){document.addEventListener("keydown",e=>{e.key==="Escape"&&this.closeTopModal()}),window.addEventListener("resize",()=>{this.handleWindowResize()}),window.addEventListener("scroll",()=>{this.handleScroll()})}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),this.focusSearchInput())})}showNotification(e,t="info",r=5e3,o={}){const s={id:Date.now()+Math.random(),message:e,type:t,duration:r,...o};if(this.notificationContainer.children.length>=this.maxNotifications){this.notificationQueue.push(s);return}this.renderNotification(s)}renderNotification(e){const t=document.createElement("div");t.className=`notification notification-${e.type}`,t.setAttribute("data-notification-id",e.id);const r={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};if(t.innerHTML=`
      <div class="notification-content">
        <span class="notification-icon">${r[e.type]||r.info}</span>
        <span class="notification-message">${e.message}</span>
        <button class="notification-close" aria-label="Fermer">√ó</button>
      </div>
      ${e.duration>0?'<div class="notification-progress"></div>':""}
    `,t.querySelector(".notification-close").addEventListener("click",()=>{this.hideNotification(e.id)}),t.style.transform="translateX(100%)",t.style.opacity="0",this.notificationContainer.appendChild(t),requestAnimationFrame(()=>{t.style.transform="translateX(0)",t.style.opacity="1"}),e.duration>0){const s=t.querySelector(".notification-progress");s&&(s.style.animationDuration=`${e.duration}ms`),setTimeout(()=>{this.hideNotification(e.id)},e.duration)}}hideNotification(e){const t=this.notificationContainer.querySelector(`[data-notification-id="${e}"]`);t&&(t.style.transform="translateX(100%)",t.style.opacity="0",setTimeout(()=>{if(t.parentElement&&(t.remove(),this.notificationQueue.length>0)){const r=this.notificationQueue.shift();this.renderNotification(r)}},300))}showModal(e,t={}){const r=document.getElementById(e);if(!r){console.error(`Modale ${e} non trouv√©e`);return}this.activeModals.add(e);const o={closeOnBackdrop:!0,focus:!0,...t};r.style.display="flex",r.classList.add("modal-active"),requestAnimationFrame(()=>{r.classList.add("modal-open")}),o.focus&&setTimeout(()=>{const s=r.querySelector("input, button, textarea, select");s&&s.focus()},100),document.body.classList.add("modal-open"),o.closeOnBackdrop&&r.addEventListener("click",this.handleModalBackdropClick.bind(this))}hideModal(e){const t=document.getElementById(e);t&&(this.activeModals.delete(e),t.classList.remove("modal-open"),setTimeout(()=>{t.style.display="none",t.classList.remove("modal-active"),this.activeModals.size===0&&document.body.classList.remove("modal-open")},300),t.removeEventListener("click",this.handleModalBackdropClick.bind(this)))}closeTopModal(){if(this.activeModals.size>0){const e=Array.from(this.activeModals).pop();this.hideModal(e)}}handleModalBackdropClick(e){if(e.target.classList.contains("modal")){const t=e.target.id;this.hideModal(t)}}showLoading(e,t="Chargement..."){const r=typeof e=="string"?document.getElementById(e)||document.querySelector(e):e;if(!r){console.error(`√âl√©ment ${e} non trouv√© pour le loading`);return}this.loadingElements.has(r)||this.loadingElements.set(r,{originalContent:r.innerHTML,originalDisabled:r.disabled});const o=`
      <div class="loading-overlay">
        <div class="loading-spinner">
          <div class="spinner"></div>
          <span class="loading-message">${t}</span>
        </div>
      </div>
    `;r.tagName==="BUTTON"?(r.disabled=!0,r.innerHTML=`<span class="spinner-small"></span> ${t}`):(r.style.position="relative",r.insertAdjacentHTML("beforeend",o))}hideLoading(e){const t=typeof e=="string"?document.getElementById(e)||document.querySelector(e):e;if(!t)return;const r=this.loadingElements.get(t);r&&(t.innerHTML=r.originalContent,t.disabled=r.originalDisabled,this.loadingElements.delete(t));const o=t.querySelector(".loading-overlay");o&&o.remove()}scrollTo(e,t={}){const r=typeof e=="string"?document.querySelector(e):e;if(!r){console.error(`√âl√©ment ${e} non trouv√© pour le scroll`);return}const o={behavior:"smooth",offset:0,...t},a=r.getBoundingClientRect().top+window.pageYOffset-o.offset;window.scrollTo({top:a,behavior:o.behavior})}handleWindowResize(){this.activeModals.forEach(e=>{document.getElementById(e)})}handleScroll(){const e=window.scrollY,t=document.querySelector(".hero");if(t){const o=t.querySelector(".hero-image");o&&(o.style.transform=`translateY(${e*.5}px)`)}const r=document.querySelector(".navbar");r&&(e>100?r.classList.add("scrolled"):r.classList.remove("scrolled"))}focusSearchInput(){const e=document.getElementById("search-location");e&&(e.focus(),e.select())}}const z=(()=>{let m={};const e={get(a){try{return localStorage.getItem(a)}catch{return null}},set(a,n){try{localStorage.setItem(a,n)}catch{}}},t=a=>m[a]??a,r=()=>{document.querySelectorAll("[data-i18n]").forEach(a=>{const n=a.getAttribute("data-i18n"),i=t(n);a.hasAttribute("data-i18n-placeholder")?a.placeholder=i.replace(/<[^>]+>/g,""):a.innerHTML=i})},o=async a=>{m=await(await fetch(`/i18n/${a}.json`,{cache:"no-cache"})).json(),e.set("lang",a),r()};return{init:async()=>{const a=e.get("lang")||(navigator.language||"fr").slice(0,2),n=["fr","en"].includes(a)?a:"fr";await o(n);const i=document.getElementById("langSwitcher");i&&(i.value=n,i.addEventListener("change",c=>o(c.target.value)))},load:o,t}})();class V{constructor(){this.prefix="sailingloc_",this.isStorageAvailable=this.checkStorageAvailability()}checkStorageAvailability(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return console.warn("localStorage non disponible:",e),!1}}setToken(e){if(!this.isStorageAvailable)return!1;try{return localStorage.setItem(`${this.prefix}token`,e),!0}catch(t){return console.error("Erreur lors de la sauvegarde du token:",t),!1}}getToken(){if(!this.isStorageAvailable)return null;try{return localStorage.getItem(`${this.prefix}token`)}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}removeToken(){if(!this.isStorageAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}token`),!0}catch(e){return console.error("Erreur lors de la suppression du token:",e),!1}}setUser(e){if(!this.isStorageAvailable)return!1;try{return localStorage.setItem(`${this.prefix}user`,JSON.stringify(e)),!0}catch(t){return console.error("Erreur lors de la sauvegarde des donn√©es utilisateur:",t),!1}}getUser(){if(!this.isStorageAvailable)return null;try{const e=localStorage.getItem(`${this.prefix}user`);return e?JSON.parse(e):null}catch(e){return console.error("Erreur lors de la r√©cup√©ration des donn√©es utilisateur:",e),null}}removeUser(){if(!this.isStorageAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}user`),!0}catch(e){return console.error("Erreur lors de la suppression des donn√©es utilisateur:",e),!1}}clearAuth(){const e=this.removeToken(),t=this.removeUser();return e&&t}setSearchPreferences(e){if(!this.isStorageAvailable)return!1;try{return localStorage.setItem(`${this.prefix}search_prefs`,JSON.stringify(e)),!0}catch(t){return console.error("Erreur lors de la sauvegarde des pr√©f√©rences:",t),!1}}getSearchPreferences(){if(!this.isStorageAvailable)return this.getDefaultSearchPreferences();try{const e=localStorage.getItem(`${this.prefix}search_prefs`);return e?JSON.parse(e):this.getDefaultSearchPreferences()}catch(e){return console.error("Erreur lors de la r√©cup√©ration des pr√©f√©rences:",e),this.getDefaultSearchPreferences()}}getDefaultSearchPreferences(){return{location:"",type:"all",maxPrice:1e3,minCapacity:1,sortBy:"price",sortOrder:"asc"}}addToSearchHistory(e){if(!this.isStorageAvailable||!e.trim())return!1;try{let t=this.getSearchHistory();return t=t.filter(r=>r.toLowerCase()!==e.toLowerCase()),t.unshift(e.trim()),t=t.slice(0,10),localStorage.setItem(`${this.prefix}search_history`,JSON.stringify(t)),!0}catch(t){return console.error("Erreur lors de la sauvegarde de l'historique:",t),!1}}getSearchHistory(){if(!this.isStorageAvailable)return[];try{const e=localStorage.getItem(`${this.prefix}search_history`);return e?JSON.parse(e):[]}catch(e){return console.error("Erreur lors de la r√©cup√©ration de l'historique:",e),[]}}clearSearchHistory(){if(!this.isStorageAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}search_history`),!0}catch(e){return console.error("Erreur lors de l'effacement de l'historique:",e),!1}}addToFavorites(e){if(!this.isStorageAvailable||!e)return!1;try{let t=this.getFavorites();return t.includes(e)||(t.push(e),localStorage.setItem(`${this.prefix}favorites`,JSON.stringify(t))),!0}catch(t){return console.error("Erreur lors de l'ajout aux favoris:",t),!1}}removeFromFavorites(e){if(!this.isStorageAvailable||!e)return!1;try{let t=this.getFavorites();return t=t.filter(r=>r!==e),localStorage.setItem(`${this.prefix}favorites`,JSON.stringify(t)),!0}catch(t){return console.error("Erreur lors de la suppression des favoris:",t),!1}}getFavorites(){if(!this.isStorageAvailable)return[];try{const e=localStorage.getItem(`${this.prefix}favorites`);return e?JSON.parse(e):[]}catch(e){return console.error("Erreur lors de la r√©cup√©ration des favoris:",e),[]}}isFavorite(e){return this.getFavorites().includes(e)}setAppSettings(e){if(!this.isStorageAvailable)return!1;try{const r={...this.getAppSettings(),...e};return localStorage.setItem(`${this.prefix}app_settings`,JSON.stringify(r)),!0}catch(t){return console.error("Erreur lors de la sauvegarde des param√®tres:",t),!1}}getAppSettings(){if(!this.isStorageAvailable)return this.getDefaultAppSettings();try{const e=localStorage.getItem(`${this.prefix}app_settings`);return e?JSON.parse(e):this.getDefaultAppSettings()}catch(e){return console.error("Erreur lors de la r√©cup√©ration des param√®tres:",e),this.getDefaultAppSettings()}}getDefaultAppSettings(){return{theme:"light",language:"fr",currency:"EUR",notifications:!0,emailUpdates:!0,autoSave:!0}}setFormData(e,t){if(!this.isStorageAvailable||!e)return!1;try{return localStorage.setItem(`${this.prefix}form_${e}`,JSON.stringify(t)),!0}catch(r){return console.error("Erreur lors de la sauvegarde du formulaire:",r),!1}}getFormData(e){if(!this.isStorageAvailable||!e)return null;try{const t=localStorage.getItem(`${this.prefix}form_${e}`);return t?JSON.parse(t):null}catch(t){return console.error("Erreur lors de la r√©cup√©ration du formulaire:",t),null}}removeFormData(e){if(!this.isStorageAvailable||!e)return!1;try{return localStorage.removeItem(`${this.prefix}form_${e}`),!0}catch(t){return console.error("Erreur lors de la suppression du formulaire:",t),!1}}clearAllData(){if(!this.isStorageAvailable)return!1;try{return Object.keys(localStorage).forEach(t=>{t.startsWith(this.prefix)&&localStorage.removeItem(t)}),!0}catch(e){return console.error("Erreur lors du nettoyage des donn√©es:",e),!1}}getStorageSize(){if(!this.isStorageAvailable)return{bytes:0,kb:0,mb:0};try{let e=0;return Object.keys(localStorage).forEach(r=>{r.startsWith(this.prefix)&&(e+=localStorage.getItem(r).length)}),{bytes:e,kb:Math.round(e/1024*100)/100,mb:Math.round(e/(1024*1024)*100)/100}}catch(e){return console.error("Erreur lors du calcul de la taille:",e),{bytes:0,kb:0,mb:0}}}setWithExpiry(e,t,r){if(!this.isStorageAvailable)return!1;try{const s={value:t,expiry:new Date().getTime()+r};return localStorage.setItem(`${this.prefix}${e}`,JSON.stringify(s)),!0}catch(o){return console.error("Erreur lors de la sauvegarde avec expiration:",o),!1}}getWithExpiry(e){if(!this.isStorageAvailable)return null;try{const t=localStorage.getItem(`${this.prefix}${e}`);if(!t)return null;const r=JSON.parse(t);return new Date().getTime()>r.expiry?(localStorage.removeItem(`${this.prefix}${e}`),null):r.value}catch(t){return console.error("Erreur lors de la r√©cup√©ration avec expiration:",t),null}}setSessionData(e,t){try{return sessionStorage.setItem(`${this.prefix}${e}`,JSON.stringify(t)),!0}catch(r){return console.error("Erreur lors de la sauvegarde en session:",r),!1}}getSessionData(e){try{const t=sessionStorage.getItem(`${this.prefix}${e}`);return t?JSON.parse(t):null}catch(t){return console.error("Erreur lors de la r√©cup√©ration en session:",t),null}}removeSessionData(e){try{return sessionStorage.removeItem(`${this.prefix}${e}`),!0}catch(t){return console.error("Erreur lors de la suppression en session:",t),!1}}}class H{constructor(){this.authService=new j,this.boatService=new R,this.bookingService=new D,this.paymentService=new q,this.uiManager=new F,this.storageManager=new V,this.currentUser=null,this.currentPage=1,this.boatsPerPage=12,this.currentFilters={},this.selectedImages=[],this.isLoadingBoats=!1,this.currentBoats=[],this.init()}async init(){try{console.log("üöÄ Initialisation de SailingLoc..."),await z.init(),await this.checkAuthStatus(),this.setupEventListeners();const e=window.location.pathname;(e==="/"||e.endsWith("index.html")||e.endsWith("boats.html"))&&await this.loadBoats(),this.setupNavigation(),this.initBoatManagement(),window.debugSailingLoc={testBoatCard:t=>{console.log("Test de cr√©ation de carte de bateau:",t);const r=this.createBoatCard(t);return console.log("R√©sultat:",r),r},loadBoats:()=>this.loadBoats(),getCurrentBoats:()=>this.currentBoats||[]},console.log("‚úÖ SailingLoc initialis√© avec succ√®s"),console.log("üîß Fonctions de d√©bogage disponibles: window.debugSailingLoc")}catch(e){console.error("‚ùå Erreur lors de l'initialisation:",e),this.uiManager.showNotification("Erreur lors du chargement de l'application","error")}}async checkAuthStatus(){const e=this.storageManager.getToken(),t=this.storageManager.getUser();if(console.log("üîê [AUTH] Token trouv√©:",e?"Oui":"Non"),console.log("üîê [AUTH] User trouv√©:",t?"Oui":"Non"),e&&t){this.currentUser=t,console.log("üîê [AUTH] Utilisateur charg√© depuis localStorage:",this.currentUser.email,"R√¥le:",this.currentUser.role),this.updateUIForAuthenticatedUser();try{const r=await this.authService.verifyToken();console.log("üîê [AUTH] V√©rification token:",r.success?"Valide":"Invalide"),r.success&&r.data.user?(this.currentUser=r.data.user,this.storageManager.setUser(this.currentUser),console.log("üîê [AUTH] Utilisateur mis √† jour depuis le serveur")):(console.log("üîê [AUTH] Token invalide, nettoyage..."),this.storageManager.clearAuth(),this.currentUser=null)}catch(r){console.error("Erreur lors de la v√©rification du token:",r),console.log("üîê [AUTH] Erreur r√©seau, conservation de l'utilisateur localStorage")}}else console.log("üîê [AUTH] Aucun token ou utilisateur trouv√©, utilisateur non connect√©"),this.currentUser=null}setupEventListeners(){this.setupAuthListeners(),this.setupSearchListeners(),this.setupNavigationListeners(),this.setupFormListeners(),this.setupModalListeners()}setupAuthListeners(){const e=document.getElementById("login-btn"),t=document.getElementById("register-btn");e&&e.addEventListener("click",()=>this.uiManager.showModal("login-modal")),t&&t.addEventListener("click",()=>this.uiManager.showModal("register-modal"));const r=document.getElementById("login-form"),o=document.getElementById("register-form");r&&r.addEventListener("submit",l=>this.handleLogin(l)),o&&o.addEventListener("submit",l=>this.handleRegister(l));const s=document.getElementById("switch-to-register"),a=document.getElementById("switch-to-login");s&&s.addEventListener("click",l=>{l.preventDefault(),this.uiManager.hideModal("login-modal"),this.uiManager.showModal("register-modal")}),a&&a.addEventListener("click",l=>{l.preventDefault(),this.uiManager.hideModal("register-modal"),this.uiManager.showModal("login-modal")});const n=document.getElementById("user-avatar"),i=document.getElementById("logout-link");n&&n.addEventListener("click",()=>this.toggleUserMenu()),i&&i.addEventListener("click",l=>{l.preventDefault(),this.handleLogout()});const c=document.getElementById("profile-link"),u=document.getElementById("bookings-link"),h=document.getElementById("boats-link");c&&c.addEventListener("click",l=>{l.preventDefault(),this.showProfile()}),u&&u.addEventListener("click",l=>{l.preventDefault(),this.showBookings()}),h&&h.addEventListener("click",l=>{l.preventDefault(),this.showMyBoats()})}setupSearchListeners(){const e=window.location.pathname;if(!(e==="/"||e.endsWith("index.html")||e.endsWith("boats.html")))return;const r=document.getElementById("search-btn");r&&r.addEventListener("click",()=>this.handleSearch());const o=document.getElementById("apply-filters");o&&o.addEventListener("click",()=>this.applyFilters());const s=document.getElementById("filter-price"),a=document.getElementById("price-display");s&&a&&s.addEventListener("input",c=>{a.textContent=`${c.target.value}‚Ç¨`});const n=document.getElementById("prev-page"),i=document.getElementById("next-page");n&&n.addEventListener("click",()=>this.changePage(this.currentPage-1)),i&&i.addEventListener("click",()=>this.changePage(this.currentPage+1))}setupNavigationListeners(){const e=document.getElementById("mobile-menu-toggle"),t=document.getElementById("nav-menu");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active")});const r=document.querySelectorAll(".nav-link");r.forEach(o=>{o.addEventListener("click",s=>{const a=o.getAttribute("href");if(a&&(a.includes(".html")||a.startsWith("http")))return;s.preventDefault();const n=a.substring(1),i=document.getElementById(n);i&&(i.scrollIntoView({behavior:"smooth",block:"start"}),r.forEach(c=>c.classList.remove("active")),o.classList.add("active"))})}),window.addEventListener("scroll",()=>{const o=document.getElementById("navbar");o&&(window.scrollY>100?o.classList.add("scrolled"):o.classList.remove("scrolled"))})}setupFormListeners(){const e=document.getElementById("contact-form");e&&e.addEventListener("submit",d=>this.handleContactForm(d));const t=document.getElementById("profile-form");t&&t.addEventListener("submit",d=>this.handleProfileUpdate(d));const r=document.getElementById("change-password-form");r&&r.addEventListener("submit",d=>this.handlePasswordChange(d));const o=document.getElementById("change-password-form-profile");o&&o.addEventListener("submit",d=>this.handlePasswordChange(d));const s=document.getElementById("preferences-form");s&&s.addEventListener("submit",d=>this.handlePreferencesUpdate(d));const a=document.getElementById("add-boat-form");a&&a.addEventListener("submit",d=>this.handleAddBoat(d));const n=document.getElementById("edit-boat-form");n&&n.addEventListener("submit",d=>this.handleEditBoat(d)),this.setupImageUpload();const i=document.getElementById("change-password-btn");i&&i.addEventListener("click",()=>{this.uiManager.showModal("change-password-modal")});const c=document.getElementById("add-boat-btn");c&&c.addEventListener("click",()=>{this.showAddBoatModal()}),document.querySelectorAll(".tab-btn").forEach(d=>{d.addEventListener("click",()=>{const g=d.getAttribute("data-tab");this.switchTab(g)})});const h=document.getElementById("refresh-bookings"),l=document.getElementById("refresh-boats");h&&h.addEventListener("click",()=>this.loadUserBookings()),l&&l.addEventListener("click",()=>this.loadOwnerBoats())}setupModalListeners(){document.querySelectorAll(".modal-close").forEach(r=>{r.addEventListener("click",o=>{const s=r.closest(".modal");s&&this.uiManager.hideModal(s.id)})}),document.querySelectorAll(".modal").forEach(r=>{r.addEventListener("click",o=>{o.target===r&&this.uiManager.hideModal(r.id)})})}async handleLogin(e){e.preventDefault();const t=document.getElementById("login-email").value,r=document.getElementById("login-password").value;if(console.log("üîê Tentative de connexion:",{email:t,password:r?"***":"vide"}),!t||!r){this.uiManager.showNotification("Veuillez remplir tous les champs","error");return}try{this.uiManager.showLoading("login-form"),console.log("üîê Appel AuthService.login...");const o=await this.authService.login(t,r);console.log("üì° R√©ponse compl√®te:",o),o.success?(console.log("‚úÖ Connexion r√©ussie, donn√©es utilisateur:",o.data.user),this.currentUser=o.data.user,this.storageManager.setToken(o.data.token),this.storageManager.setUser(o.data.user),this.updateUIForAuthenticatedUser(),this.uiManager.hideModal("login-modal"),this.uiManager.showNotification("Connexion r√©ussie !","success"),document.getElementById("login-form").reset()):(console.error("‚ùå √âchec de connexion:",o.message),this.uiManager.showNotification(o.message||"Email ou mot de passe incorrect","error"))}catch(o){console.error("Erreur de connexion:",o),this.uiManager.showNotification(`Erreur de connexion: ${o.message||"Probl√®me de r√©seau"}`,"error")}finally{this.uiManager.hideLoading("login-form")}}async handleRegister(e){e.preventDefault();const t={firstName:document.getElementById("register-firstname").value,lastName:document.getElementById("register-lastname").value,email:document.getElementById("register-email").value,password:document.getElementById("register-password").value,phone:document.getElementById("register-phone").value,role:document.getElementById("register-role").value};if(console.log("üìù Tentative d'inscription:",{...t,password:t.password?"***":"vide"}),!t.firstName||!t.lastName||!t.email||!t.password||!t.role){this.uiManager.showNotification("Veuillez remplir tous les champs obligatoires","error");return}if(t.password.length<6){this.uiManager.showNotification("Le mot de passe doit contenir au moins 6 caract√®res","error");return}try{this.uiManager.showLoading("register-form"),console.log("üìù Appel AuthService.register...");const r=await this.authService.register(t);console.log("üì° R√©ponse inscription:",r),r.success?(console.log("‚úÖ Inscription r√©ussie, donn√©es utilisateur:",r.data.user),this.currentUser=r.data.user,this.storageManager.setToken(r.data.token),this.storageManager.setUser(r.data.user),this.updateUIForAuthenticatedUser(),this.uiManager.hideModal("register-modal"),this.uiManager.showNotification("Inscription r√©ussie !","success"),document.getElementById("register-form").reset()):(console.error("‚ùå √âchec d'inscription:",r.message),this.uiManager.showNotification(r.message||"Erreur d'inscription","error"))}catch(r){console.error("Erreur d'inscription:",r),this.uiManager.showNotification(`Erreur d'inscription: ${r.message||"Probl√®me de r√©seau"}`,"error")}finally{this.uiManager.hideLoading("register-form")}}async handleLogout(){try{await this.authService.logout(),this.currentUser=null,this.storageManager.clearAuth(),this.updateUIForUnauthenticatedUser(),this.uiManager.showNotification("D√©connexion r√©ussie","success")}catch(e){console.error("Erreur de d√©connexion:",e),this.currentUser=null,this.storageManager.clearAuth(),this.updateUIForUnauthenticatedUser()}}async showProfile(){try{this.uiManager.showModal("profile-modal"),await this.loadUserProfile()}catch(e){console.error("Erreur lors de l'affichage du profil:",e),this.uiManager.showNotification("Erreur lors du chargement du profil","error")}}async loadUserProfile(){var e,t;try{const r=await this.authService.getProfile();if(r.success){const o=r.data.user;document.getElementById("profile-firstname").value=o.firstName||"",document.getElementById("profile-lastname").value=o.lastName||"",document.getElementById("profile-email").value=o.email||"",document.getElementById("profile-phone").value=o.phone||"",o.address&&(document.getElementById("profile-street").value=o.address.street||"",document.getElementById("profile-city").value=o.address.city||"",document.getElementById("profile-postal").value=o.address.postalCode||""),o.preferences&&(document.getElementById("profile-language").value=o.preferences.language||"fr",document.getElementById("profile-currency").value=o.preferences.currency||"EUR",document.getElementById("email-notifications").checked=((e=o.preferences.notifications)==null?void 0:e.email)!==!1,document.getElementById("sms-notifications").checked=((t=o.preferences.notifications)==null?void 0:t.sms)===!0)}}catch(r){console.error("Erreur lors du chargement du profil:",r),this.uiManager.showNotification("Erreur lors du chargement du profil","error")}}async handleProfileUpdate(e){e.preventDefault();const t={firstName:document.getElementById("profile-firstname").value,lastName:document.getElementById("profile-lastname").value,phone:document.getElementById("profile-phone").value,address:{street:document.getElementById("profile-street").value,city:document.getElementById("profile-city").value,postalCode:document.getElementById("profile-postal").value}};try{this.uiManager.showLoading("profile-form");const r=await this.authService.updateProfile(t);r.success?(this.currentUser=r.data.user,this.storageManager.setUser(r.data.user),this.updateUIForAuthenticatedUser(),this.uiManager.showNotification("Profil mis √† jour avec succ√®s !","success")):this.uiManager.showNotification(r.message||"Erreur lors de la mise √† jour","error")}catch(r){console.error("Erreur lors de la mise √† jour du profil:",r),this.uiManager.showNotification("Erreur lors de la mise √† jour du profil","error")}finally{this.uiManager.hideLoading("profile-form")}}async handlePasswordChange(e){e.preventDefault();const t=e.target,r=t.querySelector('[id*="current-password"]').value,o=t.querySelector('[id*="new-password"]').value,s=t.querySelector('[id*="confirm-password"]').value;if(o!==s){this.uiManager.showNotification("Les mots de passe ne correspondent pas","error");return}try{this.uiManager.showLoading(t);const a=await this.authService.changePassword(r,o);a.success?(this.uiManager.showNotification("Mot de passe modifi√© avec succ√®s !","success"),t.reset()):this.uiManager.showNotification(a.message||"Erreur lors du changement de mot de passe","error")}catch(a){console.error("Erreur lors du changement de mot de passe:",a),this.uiManager.showNotification("Erreur lors du changement de mot de passe","error")}finally{this.uiManager.hideLoading(t)}}async handlePreferencesUpdate(e){e.preventDefault();const t={preferences:{language:document.getElementById("profile-language").value,currency:document.getElementById("profile-currency").value,notifications:{email:document.getElementById("email-notifications").checked,sms:document.getElementById("sms-notifications").checked}}};try{this.uiManager.showLoading("preferences-form");const r=await this.authService.updateProfile(t);r.success?(this.currentUser=r.data.user,this.storageManager.setUser(r.data.user),this.uiManager.showNotification("Pr√©f√©rences mises √† jour avec succ√®s !","success")):this.uiManager.showNotification(r.message||"Erreur lors de la mise √† jour","error")}catch(r){console.error("Erreur lors de la mise √† jour des pr√©f√©rences:",r),this.uiManager.showNotification("Erreur lors de la mise √† jour des pr√©f√©rences","error")}finally{this.uiManager.hideLoading("preferences-form")}}async showBookings(){try{this.uiManager.showModal("bookings-modal"),await this.loadUserBookings()}catch(e){console.error("Erreur lors de l'affichage des r√©servations:",e),this.uiManager.showNotification("Erreur lors du chargement des r√©servations","error")}}async loadUserBookings(){try{const e=document.getElementById("bookings-list");e.innerHTML=`
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Chargement des r√©servations...</p>
        </div>
      `;const t=await this.bookingService.getUserBookings();t.success?this.renderBookings(t.data.bookings):e.innerHTML=`
          <div class="no-results">
            <h3>Aucune r√©servation trouv√©e</h3>
            <p>Vous n'avez pas encore de r√©servations</p>
          </div>
        `}catch(e){console.error("Erreur lors du chargement des r√©servations:",e);const t=document.getElementById("bookings-list");t.innerHTML=`
        <div class="no-results">
          <h3>Erreur de chargement</h3>
          <p>Impossible de charger les r√©servations</p>
        </div>
      `}}renderBookings(e){const t=document.getElementById("bookings-list");if(e.length===0){t.innerHTML=`
        <div class="no-results">
          <h3>Aucune r√©servation</h3>
          <p>Vous n'avez pas encore de r√©servations</p>
        </div>
      `;return}t.innerHTML=e.map(r=>{var o,s,a;return`
      <div class="booking-card">
        <div class="booking-header">
          <span class="booking-number">#${r.bookingNumber}</span>
          <span class="booking-status status-${r.status}">${this.getStatusLabel(r.status)}</span>
        </div>
        <div class="booking-details">
          <div class="booking-detail">
            <span class="booking-detail-label">Bateau</span>
            <span class="booking-detail-value">${((o=r.boat)==null?void 0:o.name)||"N/A"}</span>
          </div>
          <div class="booking-detail">
            <span class="booking-detail-label">Dates</span>
            <span class="booking-detail-value">
              ${new Date(r.startDate).toLocaleDateString("fr-FR")} - 
              ${new Date(r.endDate).toLocaleDateString("fr-FR")}
            </span>
          </div>
          <div class="booking-detail">
            <span class="booking-detail-label">Montant</span>
            <span class="booking-detail-value">${((s=r.pricing)==null?void 0:s.totalAmount)||0}‚Ç¨</span>
          </div>
          <div class="booking-detail">
            <span class="booking-detail-label">Participants</span>
            <span class="booking-detail-value">${((a=r.participants)==null?void 0:a.total)||0} personnes</span>
          </div>
        </div>
        <div class="booking-actions">
          <button class="btn-secondary btn-small" onclick="app.viewBookingDetails('${r._id}')">
            Voir d√©tails
          </button>
          ${r.status==="pending"||r.status==="confirmed"?`
            <button class="btn-ghost btn-small" onclick="app.cancelBooking('${r._id}')">
              Annuler
            </button>
          `:""}
        </div>
      </div>
    `}).join("")}async showMyBoats(){try{window.location.href="boat-management.html"}catch(e){console.error("Erreur lors de la redirection:",e),this.uiManager.showNotification("Erreur lors de la redirection","error")}}async loadOwnerBoats(){try{const e=document.getElementById("my-boats-list");e.innerHTML=`
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Chargement de vos bateaux...</p>
        </div>
      `;const t=await this.boatService.getOwnerBoats();t.success?this.renderOwnerBoats(t.data.boats):e.innerHTML=`
          <div class="no-results">
            <h3>Aucun bateau trouv√©</h3>
            <p>Vous n'avez pas encore ajout√© de bateaux</p>
          </div>
        `}catch(e){console.error("Erreur lors du chargement des bateaux:",e);const t=document.getElementById("my-boats-list");t.innerHTML=`
        <div class="no-results">
          <h3>Erreur de chargement</h3>
          <p>Impossible de charger vos bateaux</p>
        </div>
      `}}renderOwnerBoats(e){const t=document.getElementById("my-boats-list");if(e.length===0){t.innerHTML=`
        <div class="no-results">
          <h3>Aucun bateau</h3>
          <p>Vous n'avez pas encore ajout√© de bateaux</p>
          <button class="btn-primary" onclick="app.uiManager.showModal('add-boat-modal')">
            Ajouter votre premier bateau
          </button>
        </div>
      `;return}t.innerHTML=e.map(r=>{var o,s,a,n,i,c,u;return`
      <div class="my-boat-card">
        <div class="my-boat-image">
          <img src="${r.mainImage||((s=(o=r.images)==null?void 0:o[0])==null?void 0:s.url)||"https://images.pexels.com/photos/1001682/pexels-photo-1001682.jpeg?auto=compress&cs=tinysrgb&w=400&h=300&fit=crop"}" alt="${r.name}">
          <div class="boat-status-badge status-${r.status}">${this.getBoatStatusLabel(r.status)}</div>
        </div>
        <div class="my-boat-content">
          <h3 class="my-boat-name">${r.name}</h3>
          <p class="my-boat-location">üìç ${((a=r.location)==null?void 0:a.city)||"N/A"}</p>
          <div class="my-boat-stats">
            <div class="boat-stat">
              <div class="boat-stat-value">${((n=r.pricing)==null?void 0:n.dailyRate)||0}‚Ç¨</div>
              <div class="boat-stat-label">Prix/jour</div>
            </div>
            <div class="boat-stat">
              <div class="boat-stat-value">${((i=r.stats)==null?void 0:i.totalBookings)||0}</div>
              <div class="boat-stat-label">R√©servations</div>
            </div>
            <div class="boat-stat">
              <div class="boat-stat-value">${((u=(c=r.rating)==null?void 0:c.average)==null?void 0:u.toFixed(1))||"0.0"}</div>
              <div class="boat-stat-label">Note</div>
            </div>
          </div>
          <div class="my-boat-actions">
            <button class="btn-primary btn-small" onclick="app.editBoat('${r._id}')">
              Modifier
            </button>
            <button class="btn-secondary btn-small" onclick="app.showBoatDetails('${r._id}')">
              Voir
            </button>
            <button class="btn-ghost btn-small" onclick="app.toggleBoatStatus('${r._id}')">
              ${r.status==="available"?"D√©sactiver":"Activer"}
            </button>
          </div>
        </div>
      </div>
    `}).join("")}switchTab(e){document.querySelectorAll(".tab-btn").forEach(t=>t.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active")),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.getElementById(e).classList.add("active")}getStatusLabel(e){return{pending:"En attente",confirmed:"Confirm√©e",paid:"Pay√©e",active:"En cours",completed:"Termin√©e",cancelled:"Annul√©e",refunded:"Rembours√©e"}[e]||e}getBoatStatusLabel(e){return{available:"Disponible",rented:"Lou√©",maintenance:"Maintenance",inactive:"Inactif"}[e]||e}async viewBookingDetails(e){this.uiManager.showNotification("Fonctionnalit√© en cours de d√©veloppement","info")}async cancelBooking(e){confirm("√ätes-vous s√ªr de vouloir annuler cette r√©servation ?")&&this.uiManager.showNotification("Fonctionnalit√© en cours de d√©veloppement","info")}async toggleBoatStatus(e){this.uiManager.showNotification("Fonctionnalit√© en cours de d√©veloppement","info")}updateUIForAuthenticatedUser(){const e=document.getElementById("login-btn"),t=document.getElementById("register-btn"),r=document.getElementById("user-menu"),o=document.getElementById("user-name"),s=document.getElementById("user-email"),a=document.getElementById("user-initials"),n=document.getElementById("boats-link");e&&(e.style.display="none"),t&&(t.style.display="none"),r&&(r.style.display="block"),this.currentUser&&(o&&(o.textContent=`${this.currentUser.firstName} ${this.currentUser.lastName}`),s&&(s.textContent=this.currentUser.email),a&&(a.textContent=`${this.currentUser.firstName[0]}${this.currentUser.lastName[0]}`.toUpperCase()),n&&["owner","admin"].includes(this.currentUser.role)&&(n.style.display="block"))}updateUIForUnauthenticatedUser(){const e=document.getElementById("login-btn"),t=document.getElementById("register-btn"),r=document.getElementById("user-menu");e&&(e.style.display="block"),t&&(t.style.display="block"),r&&(r.style.display="none")}toggleUserMenu(){const e=document.getElementById("user-dropdown");e&&e.classList.toggle("active")}async loadBoats(e={},t=1){if(this.isLoadingBoats){console.log("‚è≥ Chargement d√©j√† en cours, annulation de la requ√™te");return}this.isLoadingBoats=!0;try{const r=document.getElementById("boats-grid"),o=document.getElementById("boats-loading");o&&(o.style.display="block"),r&&(r.innerHTML="",console.log("üßπ Grille vid√©e avant le chargement"));const s={page:t,limit:this.boatsPerPage,...e};console.log("üö§ Chargement des bateaux depuis:",this.boatService.boatsEndpoint),console.log("üìä Param√®tres:",s);const a=await this.boatService.getBoats(s);console.log("üì° R√©ponse API:",a),a.success?(this.currentBoats=a.data.boats,this.renderBoats(a.data.boats),this.renderPagination(a.data.pagination),this.currentPage=t,this.currentFilters=e):(console.error("‚ùå Erreur API:",a),this.uiManager.showNotification(`Erreur API: ${a.message||"Donn√©es non disponibles"}`,"error"),this.renderBoats([]))}catch(r){console.error("Erreur lors du chargement des bateaux:",r),this.uiManager.showNotification(`Erreur de connexion: ${r.message}`,"error"),this.renderBoats([])}finally{this.isLoadingBoats=!1;const r=document.getElementById("boats-loading");r&&(r.style.display="none")}}renderBoats(e=[]){const t=document.getElementById("boats-grid");if(!t){console.warn("‚ö†Ô∏è Grille de bateaux non trouv√©e");return}if(console.log(`üé® Rendu de ${e.length} bateaux`),t.innerHTML="",e.length===0){t.innerHTML=`
        <div class="no-results">
          <h3>Aucun bateau trouv√©</h3>
          <p>Essayez de modifier vos crit√®res de recherche</p>
        </div>
      `,console.log("üì≠ Aucun bateau √† afficher");return}const r=document.createDocumentFragment();let o=0,s=0;e.forEach((a,n)=>{try{console.log(`üîß Cr√©ation de la carte pour le bateau ${n+1}:`,a.name,a._id);const i=this.createBoatCard(a);if(i instanceof Element)r.appendChild(i),o++,console.log(`‚úÖ Carte cr√©√©e avec succ√®s pour: ${a.name}`);else{console.warn("createBoatCard a renvoy√© un type inattendu",i,a);const c=this.createErrorCard(`Erreur: ${a.name||"Bateau inconnu"}`);r.appendChild(c),s++}}catch(i){console.error("‚ùå Erreur lors de la cr√©ation de la carte du bateau:",i,a);const c=this.createErrorCard(`Erreur: ${a.name||"Bateau inconnu"}`);r.appendChild(c),s++}}),t.appendChild(r),console.log(`üéâ Rendu termin√©: ${o} cartes cr√©√©es, ${s} erreurs`),console.log(`üìä Total d'√©l√©ments dans la grille: ${t.children.length}`)}createBoatCard(e){var s,a,n,i,c,u,h,l,d,g,v,E;const t=p=>(p??"").toString(),r=p=>t(p).slice(0,1).toUpperCase()+t(p).slice(1),o=p=>({EUR:"‚Ç¨",USD:"$",GBP:"¬£"})[p]||(p?` ${p}`:"");try{console.log("üîç [DEBUG] D√©but de createBoatCard pour:",e.name,e._id);const p=e._id||e.id||"",y=t(e.name)||"Bateau",w=r(e.type||""),b=r(e.category||""),_=r(e.status||"Disponible"),x=t((s=e.location)==null?void 0:s.city)||"‚Äî",C=t((a=e.location)==null?void 0:a.marina)||"",B=t((n=e.location)==null?void 0:n.country)||"",S=((i=e.specifications)==null?void 0:i.length)??e.length??"‚Äî",I=((c=e.specifications)==null?void 0:c.width)??e.width??"‚Äî",k=(u=e.specifications)!=null&&u.fuelType?r(e.specifications.fuelType):"‚Äî",T=((h=e.capacity)==null?void 0:h.maxPeople)??((l=e.capacity)==null?void 0:l.people)??e.capacity??"‚Äî",A=((d=e.pricing)==null?void 0:d.dailyRate)??e.pricePerDay??null,$=((g=e.pricing)==null?void 0:g.securityDeposit)??e.deposit??null,L=((v=e.pricing)==null?void 0:v.currency)||"EUR",P=Array.isArray(e.imageUrls)&&e.imageUrls[0]||Array.isArray(e.images)&&((E=e.images[0])==null?void 0:E.url)||"https://images.unsplash.com/photo-1508599589920-14cfa1c1fe4d?q=80&w=1200&auto=format&fit=crop",N=A!=null?`<div class="boat-price">
             <span class="price">${t(A)}</span>
             <span class="price-unit">${o(L)}/jour</span>
           </div>`:"",U=$!=null?`<div class="price-details">Caution : ${t($)}${o(L)}</div>`:"",O=[x,C].filter(Boolean).join(" ‚Ä¢ ")+(B?` (${B})`:""),f=document.createElement("article");f.className="boat-card",f.dataset.id=p,f.innerHTML=`
        <div class="boat-image">
          <img src="${P}" alt="${y}" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1508599589920-14cfa1c1fe4d?q=80&w=1200&auto=format&fit=crop'">
          ${b?`<span class="boat-badge">${b}</span>`:""}
          <div class="boat-rating">‚≠ê 4.8</div>
        </div>

        <div class="boat-content">
          <div class="boat-name">${y}</div>
          <div class="boat-location">${O}</div>

          <div class="boat-specs">
            ${w?`<span class="spec">${w}</span>`:""}
            ${T!=="‚Äî"?`<span class="spec">${T} pers.</span>`:""}
            ${S!=="‚Äî"?`<span class="spec">${S} m</span>`:""}
            ${I!=="‚Äî"?`<span class="spec">${I} m larg.</span>`:""}
            ${k!=="‚Äî"?`<span class="spec">${k}</span>`:""}
          </div>

          ${N}
          ${U}

          <button class="boat-details-btn" data-boat-id="${p}">Voir les d√©tails</button>
        </div>
      `;const M=f.querySelector(".boat-details-btn");return M&&M.addEventListener("click",()=>this.showBoatDetails(p)),console.log("üéâ [DEBUG] Carte cr√©√©e avec succ√®s pour:",y),f}catch(p){return console.error("‚ùå [DEBUG] Erreur lors de la cr√©ation de la carte de bateau:",p),console.error("‚ùå [DEBUG] Stack trace:",p.stack),console.error("‚ùå [DEBUG] Donn√©es du bateau:",e),this.createErrorCard("Erreur lors du chargement")}}createErrorCard(e){const t=document.createElement("div");return t.className="boat-card error-card",t.innerHTML=`
      <div class="boat-content">
        <h3>Erreur</h3>
        <p>${e}</p>
      </div>
    `,t}formatBoatType(e){return{voilier:"Voilier",catamaran:"Catamaran",yacht:"Yacht",bateau_moteur:"Bateau √† moteur","bateau √† moteur":"Bateau √† moteur",semi_rigide:"Semi-rigide",peniche:"P√©niche"}[e]||e}renderStars(e){const t=Math.floor(e),r=e%1>=.5,o=5-t-(r?1:0);let s="";for(let a=0;a<t;a++)s+="‚≠ê";r&&(s+="‚≠ê");for(let a=0;a<o;a++)s+="‚òÜ";return s}async showBoatDetails(e){try{this.uiManager.showLoading("boat-modal");const t=await this.boatService.getBoatById(e);t.success?(this.renderBoatDetails(t.data.boat),this.uiManager.showModal("boat-modal")):this.uiManager.showNotification("Erreur lors du chargement des d√©tails","error")}catch(t){console.error("Erreur lors du chargement des d√©tails:",t),this.uiManager.showNotification("Erreur lors du chargement des d√©tails","error")}finally{this.uiManager.hideLoading("boat-modal")}}renderBoatDetails(e){var o,s,a,n,i,c,u;const t=document.getElementById("boat-modal-title"),r=document.getElementById("boat-details");t&&(t.textContent=e.name),r&&(r.innerHTML=`
        <div class="boat-details-content">
          <div class="boat-gallery">
            <div class="main-image">
              <img src="${e.mainImage||((s=(o=e.images)==null?void 0:o[0])==null?void 0:s.url)}" alt="${e.name}">
            </div>
            ${((a=e.images)==null?void 0:a.length)>1?`
              <div class="image-thumbnails">
                ${e.images.slice(1,5).map(h=>`
                  <img src="${h.url}" alt="${h.caption||e.name}" class="thumbnail">
                `).join("")}
              </div>
            `:""}
          </div>
          
          <div class="boat-info">
            <div class="boat-header">
              <div class="boat-meta">
                <span class="boat-type">${this.formatBoatType(e.type)}</span>
                <span class="boat-category">${e.category}</span>
              </div>
              <div class="boat-rating-large">
                ${this.renderStars(((n=e.rating)==null?void 0:n.average)||0)}
                <span class="rating-text">${((c=(i=e.rating)==null?void 0:i.average)==null?void 0:c.toFixed(1))||"0.0"} (${((u=e.rating)==null?void 0:u.totalReviews)||0} avis)</span>
              </div>
            </div>
            
            <p class="boat-description">${e.description}</p>
            
            <div class="boat-specs-grid">
              <div class="spec-item">
                <strong>Capacit√©:</strong> ${e.capacity.maxPeople} personnes
              </div>
              <div class="spec-item">
                <strong>Longueur:</strong> ${e.specifications.length}m
              </div>
              <div class="spec-item">
                <strong>Largeur:</strong> ${e.specifications.width}m
              </div>
              ${e.capacity.cabins?`
                <div class="spec-item">
                  <strong>Cabines:</strong> ${e.capacity.cabins}
                </div>
              `:""}
              ${e.capacity.berths?`
                <div class="spec-item">
                  <strong>Couchages:</strong> ${e.capacity.berths}
                </div>
              `:""}
              ${e.capacity.bathrooms?`
                <div class="spec-item">
                  <strong>Salles de bain:</strong> ${e.capacity.bathrooms}
                </div>
              `:""}
            </div>
            
            <div class="boat-location-info">
              <h3>Localisation</h3>
              <p>üìç ${e.location.marina}, ${e.location.city}, ${e.location.country}</p>
            </div>
            
            <div class="boat-pricing">
              <div class="price-main">
                <span class="price-amount">${e.pricing.dailyRate}‚Ç¨</span>
                <span class="price-unit">/jour</span>
              </div>
              ${e.pricing.weeklyRate?`
                <div class="price-secondary">
                  <span class="price-amount">${e.pricing.weeklyRate}‚Ç¨</span>
                  <span class="price-unit">/semaine</span>
                </div>
              `:""}
              <div class="price-details">
                <p>Caution: ${e.pricing.securityDeposit}‚Ç¨</p>
                ${e.pricing.cleaningFee>0?`<p>Frais de nettoyage: ${e.pricing.cleaningFee}‚Ç¨</p>`:""}
              </div>
            </div>
            
            <div class="boat-actions">
              ${this.currentUser?`
                <button class="btn-primary btn-large" onclick="app.initiateBooking('${e._id}')">
                  R√©server maintenant
                </button>
              `:`
                <button class="btn-primary btn-large" onclick="app.uiManager.showModal('login-modal')">
                  Connectez-vous pour r√©server
                </button>
              `}
            </div>
          </div>
        </div>
      `)}renderPagination(e){const t=document.getElementById("boats-pagination"),r=document.getElementById("page-numbers"),o=document.getElementById("prev-page"),s=document.getElementById("next-page");if(!t||!r)return;if(e.pages<=1){t.style.display="none";return}t.style.display="flex",o&&(o.disabled=e.page<=1),s&&(s.disabled=e.page>=e.pages),r.innerHTML="";const a=Math.max(1,e.page-2),n=Math.min(e.pages,e.page+2);for(let i=a;i<=n;i++){const c=document.createElement("button");c.className=`btn-page ${i===e.page?"active":""}`,c.textContent=i,c.addEventListener("click",()=>this.changePage(i)),r.appendChild(c)}}async changePage(e){if(e<1)return;await this.loadBoats(this.currentFilters,e);const t=document.getElementById("boats");t&&t.scrollIntoView({behavior:"smooth"})}async handleSearch(){const e=document.getElementById("search-location").value;document.getElementById("search-start-date").value,document.getElementById("search-end-date").value;const t=document.getElementById("search-guests").value,r={};e&&(r.search=e),t&&(r.minCapacity=t);const o=document.getElementById("boats");o&&o.scrollIntoView({behavior:"smooth"}),await this.loadBoats(r,1)}async applyFilters(){const e={},t=document.getElementById("filter-type").value,r=document.getElementById("filter-price").value,o=document.getElementById("filter-capacity").value;t&&(e.type=t),r&&(e.maxPrice=r),o&&(e.minCapacity=o),await this.loadBoats(e,1)}async handleContactForm(e){e.preventDefault();const t=document.getElementById("contact-name").value,r=document.getElementById("contact-email").value,o=document.getElementById("contact-message").value;try{this.uiManager.showLoading("contact-form");const s=await fetch(`${this.apiBaseUrl||""}/api/contact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:r,message:o})}),a=await s.json();if(!s.ok||!a.success)throw new Error(a.message||"√âchec de l'envoi du message");this.uiManager.showNotification("Message envoy√© avec succ√®s !","success"),document.getElementById("contact-form").reset()}catch(s){console.error("Erreur lors de l'envoi du message:",s),this.uiManager.showNotification("Erreur lors de l'envoi du message","error")}finally{this.uiManager.hideLoading("contact-form")}}setupNavigation(){const e=document.querySelectorAll("section[id]"),t=document.querySelectorAll(".nav-link");if(e.length>0&&window.location.pathname==="/"||window.location.pathname.endsWith("index.html")){const r=new IntersectionObserver(o=>{o.forEach(s=>{if(s.isIntersecting){const a=s.target.getAttribute("id");t.forEach(n=>{n.classList.remove("active"),n.getAttribute("href")===`#${a}`&&n.classList.add("active")})}})},{threshold:.3,rootMargin:"-100px 0px -100px 0px"});e.forEach(o=>r.observe(o))}}setupImageUpload(){const e=document.getElementById("boat-image-input"),t=document.getElementById("image-preview-container");e&&t&&e.addEventListener("change",a=>{this.handleImageSelection(a.target.files,"add")});const r=document.getElementById("edit-boat-images"),o=document.getElementById("edit-image-preview-container");r&&o&&r.addEventListener("change",a=>{this.handleImageSelection(a.target.files,"edit")});const s=document.getElementById("edit-image-upload-area");s&&s.addEventListener("click",()=>{r.click()})}handleImageSelection(e,t="add"){const o=["image/jpeg","image/jpg","image/png","image/webp"];Array.from(e).forEach(s=>{if(s.size>5242880){this.uiManager.showNotification(`L'image ${s.name} est trop volumineuse (max 5MB)`,"error");return}if(!o.includes(s.type)){this.uiManager.showNotification(`Format non support√© pour ${s.name}`,"error");return}t==="add"?(this.selectedImages.push(s),this.addImagePreview(s)):t==="edit"&&this.addEditImagePreview(s)})}addImagePreview(e){const t=document.getElementById("image-preview-container"),r=new FileReader;r.onload=o=>{const s=document.createElement("div");s.className="image-preview",s.innerHTML=`
        <img src="${o.target.result}" alt="Aper√ßu">
        <button type="button" class="remove-image" onclick="app.removeImage('${e.name}')">√ó</button>
      `,t.appendChild(s)},r.readAsDataURL(e)}addEditImagePreview(e){const t=document.getElementById("edit-image-preview-container"),r=new FileReader;r.onload=o=>{const s=document.createElement("div");s.className="image-preview-item new",s.innerHTML=`
        <img src="${o.target.result}" alt="Aper√ßu">
        <button type="button" class="remove-image-btn" onclick="app.removeEditImage('${e.name}')">√ó</button>
      `,t.appendChild(s)},r.readAsDataURL(e)}removeImage(e){this.selectedImages=this.selectedImages.filter(t=>t.name!==e),this.updateImagePreviews()}removeEditImage(e){document.getElementById("edit-image-preview-container").querySelectorAll(".image-preview-item.new").forEach(o=>{const s=o.querySelector("img");s&&s.src.includes(e)&&o.remove()})}removeExistingImage(e){const r=document.getElementById("edit-image-preview-container").querySelectorAll(".image-preview-item.existing");r[e]&&r[e].remove()}updateImagePreviews(){const e=document.getElementById("image-preview-container");e.innerHTML="",this.selectedImages.forEach(t=>{this.addImagePreview(t)})}async handleAddBoat(e){if(e.preventDefault(),!this.currentUser){this.uiManager.showNotification("Vous devez √™tre connect√© pour ajouter un bateau","error");return}const t=new FormData;t.append("name",document.getElementById("boat-name").value.trim()),t.append("type",document.getElementById("boat-type").value),t.append("description",document.getElementById("boat-description").value.trim()),t.append("category",document.getElementById("boat-category").value);const r=parseFloat(document.getElementById("boat-length").value),o=parseFloat(document.getElementById("boat-width").value);t.append("specifications[length]",isNaN(r)?"":r),t.append("specifications[width]",isNaN(o)?"":o);const s=parseInt(document.getElementById("boat-capacity").value,10);t.append("capacity[maxPeople]",isNaN(s)?"":s),t.append("location[city]",document.getElementById("boat-city").value.trim()),t.append("location[marina]",document.getElementById("boat-marina").value.trim()),t.append("location[country]","France");const a=parseFloat(document.getElementById("boat-daily-rate").value),n=parseFloat(document.getElementById("boat-security-deposit").value);t.append("pricing[dailyRate]",isNaN(a)?"":a),t.append("pricing[securityDeposit]",isNaN(n)?"":n),this.selectedImages&&this.selectedImages.length>0&&this.selectedImages.forEach(i=>t.append("images",i));try{this.uiManager.showLoading("add-boat-form");const i=await fetch(`${this.boatService.boatsEndpoint}`,{method:"POST",headers:{Authorization:`Bearer ${this.boatService.getAuthToken()}`},body:t}),c=await i.json();if(i.ok&&c.success)this.uiManager.showNotification("Bateau ajout√© avec succ√®s !","success"),this.uiManager.hideModal("add-boat-modal"),document.getElementById("add-boat-form").reset(),this.selectedImages=[],this.updateImagePreviews(),document.getElementById("my-boats-modal").classList.contains("active")&&await this.loadOwnerBoats();else throw new Error(c.message||"Erreur lors de l'ajout du bateau")}catch(i){console.error("Erreur lors de l'ajout du bateau:",i),this.uiManager.showNotification(`Erreur: ${i.message}`,"error")}finally{this.uiManager.hideLoading("add-boat-form")}}async handleEditBoat(e){if(e.preventDefault(),!this.currentUser){this.uiManager.showNotification("Vous devez √™tre connect√© pour modifier un bateau","error");return}const t=e.target,r=t.dataset.boatId;if(!r){this.uiManager.showNotification("ID du bateau manquant","error");return}const o=new FormData(t),s=["name","type","category","length","width","capacity","city","pricePerDay","deposit"];for(const a of s)if(!o.get(a)){this.uiManager.showNotification(`Le champ ${a} est requis`,"error");return}try{this.uiManager.showLoading("edit-boat-form");const a=await fetch(`${this.boatService.boatsEndpoint}/${r}`,{method:"PUT",headers:{Authorization:`Bearer ${this.currentUser.token}`},body:o}),n=await a.json();if(a.ok&&n.success)this.uiManager.showNotification("Bateau modifi√© avec succ√®s !","success"),this.uiManager.hideModal("edit-boat-modal"),t.reset(),this.selectedImages=[],this.updateImagePreviews(),await this.loadBoatManagementData();else throw new Error(n.message||"Erreur lors de la modification du bateau")}catch(a){console.error("Erreur lors de la modification du bateau:",a),this.uiManager.showNotification(`Erreur: ${a.message}`,"error")}finally{this.uiManager.hideLoading("edit-boat-form")}}async initiateBooking(e){if(!this.currentUser){this.uiManager.showModal("login-modal");return}this.uiManager.showNotification("Fonctionnalit√© de r√©servation en cours de d√©veloppement","info")}initBoatManagement(){console.log("üö§ Initialisation de la gestion des bateaux..."),window.location.pathname.includes("boat-management.html")&&(this.setupBoatManagementEventListeners(),setTimeout(()=>{this.loadBoatManagementData()},100))}setupBoatManagementEventListeners(){const e=document.getElementById("status-filter"),t=document.getElementById("type-filter"),r=document.getElementById("search-input"),o=document.getElementById("search-btn");e&&e.addEventListener("change",()=>this.filterBoats()),t&&t.addEventListener("change",()=>this.filterBoats()),r&&r.addEventListener("input",()=>this.debounceSearch()),o&&o.addEventListener("click",()=>this.filterBoats());const s=document.getElementById("grid-view-btn"),a=document.getElementById("list-view-btn");s&&s.addEventListener("click",()=>this.setViewMode("grid")),a&&a.addEventListener("click",()=>this.setViewMode("list"));const n=document.getElementById("prev-page-btn"),i=document.getElementById("next-page-btn");n&&n.addEventListener("click",()=>this.changePage(-1)),i&&i.addEventListener("click",()=>this.changePage(1));const c=document.getElementById("retry-btn");c&&c.addEventListener("click",()=>this.loadBoatManagementData());const u=document.getElementById("add-first-boat-btn");u&&u.addEventListener("click",()=>{this.uiManager.showModal("add-boat-modal")})}async loadBoatManagementData(){try{if(this.showLoadingState(),console.log("üö§ [BOAT MANAGEMENT] Chargement des donn√©es de gestion des bateaux"),!this.currentUser){console.log("üîÑ [BOAT MANAGEMENT] Utilisateur non trouv√©, tentative de rechargement...");const o=this.storageManager.getUser();if(o)this.currentUser=o,console.log("‚úÖ [BOAT MANAGEMENT] Utilisateur recharg√© depuis le localStorage");else throw new Error("Vous devez √™tre connect√© pour acc√©der √† la gestion des bateaux")}const e=this.storageManager.getToken();if(!e)throw new Error("Token d'authentification manquant. Veuillez vous reconnecter.");console.log("üîê [BOAT MANAGEMENT] Utilisateur connect√©:",this.currentUser.email),console.log("üîê [BOAT MANAGEMENT] Token pr√©sent:",e?"Oui":"Non");const[t,r]=await Promise.all([this.boatService.getBoatStats(),this.boatService.getOwnerBoats()]);t.success&&this.updateStats(t.data.overview),r.success&&(this.displayBoats(r.data.boats),this.updatePagination(r.data.pagination)),this.hideLoadingState(),console.log("‚úÖ [BOAT MANAGEMENT] Donn√©es charg√©es avec succ√®s")}catch(e){console.error("‚ùå [BOAT MANAGEMENT] Erreur lors du chargement des donn√©es:",e),e.message.includes("Vous devez √™tre connect√©")||e.message.includes("Authentification requise")||e.message.includes("Token")?(this.showErrorState("Vous devez √™tre connect√© pour acc√©der √† cette page. Redirection vers la page de connexion..."),setTimeout(()=>{window.location.href="index.html"},3e3)):this.showErrorState(e.message)}}showLoadingState(){const e=document.getElementById("loading-message"),t=document.getElementById("error-message"),r=document.getElementById("empty-message"),o=document.getElementById("boats-grid");e&&(e.style.display="block"),t&&(t.style.display="none"),r&&(r.style.display="none"),o&&(o.style.display="none")}hideLoadingState(){const e=document.getElementById("loading-message");e&&(e.style.display="none")}showErrorState(e){const t=document.getElementById("loading-message"),r=document.getElementById("error-message"),o=document.getElementById("error-text"),s=document.getElementById("empty-message"),a=document.getElementById("boats-grid");t&&(t.style.display="none"),r&&(r.style.display="block"),o&&(o.textContent=e),s&&(s.style.display="none"),a&&(a.style.display="none")}updateStats(e){const t=document.getElementById("total-boats"),r=document.getElementById("available-boats"),o=document.getElementById("total-bookings"),s=document.getElementById("total-revenue");t&&(t.textContent=e.totalBoats||0),r&&(r.textContent=e.availableBoats||0),o&&(o.textContent=e.totalBookings||0),s&&(s.textContent=`${e.totalRevenue||0}‚Ç¨`)}displayBoats(e){const t=document.getElementById("boats-grid"),r=document.getElementById("empty-message"),o=document.getElementById("error-message");if(t){if(e.length===0){t.style.display="none",r&&(r.style.display="block"),o&&(o.style.display="none");return}t.style.display="grid",r&&(r.style.display="none"),o&&(o.style.display="none"),t.innerHTML=e.map(s=>this.createBoatManagementCard(s)).join("")}}createBoatManagementCard(e){var a,n,i,c,u,h,l,d;const t=e.status||"available",r=this.getStatusText(e.status),o=this.getTypeText(e.type),s=((n=(a=e.images)==null?void 0:a.find(g=>g.isMain))==null?void 0:n.url)||((c=(i=e.images)==null?void 0:i[0])==null?void 0:c.url)||"boat-icon.svg";return`
      <div class="boat-management-card ${e.isActive?"":"inactive"}" data-boat-id="${e._id}">
        <img src="${s}" alt="${e.name}" class="boat-card-image" onerror="this.src='boat-icon.svg'">
        <div class="boat-card-content">
          <div class="boat-card-header">
            <div>
              <h3 class="boat-card-title">${e.name}</h3>
              <span class="boat-card-type">${o}</span>
            </div>
            <span class="boat-card-status ${t}">${r}</span>
          </div>
          
          <div class="boat-card-info">
            <div class="boat-info-item">
              <span class="boat-info-icon">üë•</span>
              <span>${((u=e.capacity)==null?void 0:u.maxPeople)||0} personnes</span>
            </div>
            <div class="boat-info-item">
              <span class="boat-info-icon">üìè</span>
              <span>${((h=e.specifications)==null?void 0:h.length)||0}m</span>
            </div>
            <div class="boat-info-item">
              <span class="boat-info-icon">üí∞</span>
              <span>${((l=e.pricing)==null?void 0:l.dailyRate)||0}‚Ç¨/jour</span>
            </div>
            <div class="boat-info-item">
              <span class="boat-info-icon">üìç</span>
              <span>${((d=e.location)==null?void 0:d.city)||"N/A"}</span>
            </div>
          </div>
          
          <div class="boat-card-actions">
            <button class="boat-action-btn" onclick="window.app.editBoat('${e._id}')">
              <span>‚úèÔ∏è</span>
              Modifier
            </button>
            <button class="boat-action-btn" onclick="window.app.manageImages('${e._id}')">
              <span>üñºÔ∏è</span>
              Images
            </button>
            ${e.isActive?`<button class="boat-action-btn danger" onclick="window.app.deleteBoat('${e._id}')">
                <span>üóëÔ∏è</span>
                Supprimer
              </button>`:`<button class="boat-action-btn primary" onclick="window.app.restoreBoat('${e._id}')">
                <span>üîÑ</span>
                Restaurer
              </button>`}
          </div>
        </div>
      </div>
    `}getStatusText(e){return{available:"Disponible",booked:"R√©serv√©",maintenance:"Maintenance",inactive:"Inactif"}[e]||"Inconnu"}getTypeText(e){return{sailboat:"Voilier",motorboat:"Bateau √† moteur",catamaran:"Catamaran",yacht:"Yacht",other:"Autre"}[e]||e}async filterBoats(){var o,s,a;const e=(o=document.getElementById("status-filter"))==null?void 0:o.value,t=(s=document.getElementById("type-filter"))==null?void 0:s.value,r=(a=document.getElementById("search-input"))==null?void 0:a.value;try{this.showLoadingState();const n={};e&&(n.status=e),t&&(n.type=t),r&&(n.search=r);const i=await this.boatService.getOwnerBoats(n);i.success&&(this.displayBoats(i.data.boats),this.updatePagination(i.data.pagination))}catch(n){console.error("Erreur lors du filtrage:",n),this.showErrorState("Erreur lors du filtrage des bateaux")}}debounceSearch(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.filterBoats()},500)}setViewMode(e){const t=document.getElementById("boats-grid"),r=document.getElementById("grid-view-btn"),o=document.getElementById("list-view-btn");t&&(t.className=e==="grid"?"boats-grid":"boats-grid list-view"),r&&r.classList.toggle("active",e==="grid"),o&&o.classList.toggle("active",e==="list")}async changePage(e){console.log("Changement de page:",e)}updatePagination(e){const t=document.getElementById("pagination"),r=document.getElementById("page-info"),o=document.getElementById("prev-page-btn"),s=document.getElementById("next-page-btn");!t||!e||(t.style.display=e.pages>1?"flex":"none",r&&(r.textContent=`Page ${e.page} sur ${e.pages}`),o&&(o.disabled=e.page<=1),s&&(s.disabled=e.page>=e.pages))}async editBoat(e){try{const t=await this.boatService.getBoatById(e);if(t.success){const r=t.data.boat;this.showEditBoatModal(r)}else throw new Error(t.message)}catch(t){console.error("Erreur lors de la r√©cup√©ration du bateau:",t),this.uiManager.showNotification(`Erreur: ${t.message}`,"error")}}manageImages(e){this.uiManager.showNotification("Fonctionnalit√© de gestion d'images en cours de d√©veloppement","info")}async deleteBoat(e){if(confirm("√ätes-vous s√ªr de vouloir supprimer ce bateau ?"))try{if(!this.currentUser)throw new Error("Vous devez √™tre connect√© pour supprimer un bateau");const t=this.storageManager.getToken();if(!t)throw new Error("Token d'authentification manquant. Veuillez vous reconnecter.");console.log("üóëÔ∏è [DELETE BOAT] Tentative de suppression du bateau:",e),console.log("üîê [DELETE BOAT] Token pr√©sent:",t?"Oui":"Non"),console.log("üë§ [DELETE BOAT] Utilisateur connect√©:",this.currentUser?this.currentUser.email:"Non"),console.log("üë§ [DELETE BOAT] User ID:",this.currentUser?this.currentUser._id:"Non"),console.log("üë§ [DELETE BOAT] User Role:",this.currentUser?this.currentUser.role:"Non");const r=await this.boatService.deleteBoat(e);if(r.success)this.uiManager.showNotification("Bateau supprim√© avec succ√®s","success"),await this.loadBoatManagementData();else throw new Error(r.message)}catch(t){console.error("‚ùå [DELETE BOAT] Erreur lors de la suppression:",t),t.message.includes("Authentification requise")||t.message.includes("Token")?(this.uiManager.showNotification("Session expir√©e. Veuillez vous reconnecter.","error"),setTimeout(()=>{window.location.href="index.html"},2e3)):this.uiManager.showNotification(`Erreur: ${t.message}`,"error")}}async restoreBoat(e){try{const t=await this.boatService.restoreBoat(e);if(t.success)this.uiManager.showNotification("Bateau restaur√© avec succ√®s","success"),await this.loadBoatManagementData();else throw new Error(t.message)}catch(t){console.error("Erreur lors de la restauration:",t),this.uiManager.showNotification(`Erreur: ${t.message}`,"error")}}showAddBoatModal(){this.uiManager.showModal("add-boat-modal")}showEditBoatModal(e){this.populateEditForm(e),this.uiManager.showModal("edit-boat-modal")}populateEditForm(e){const t=document.getElementById("edit-boat-name"),r=document.getElementById("edit-boat-type"),o=document.getElementById("edit-boat-category"),s=document.getElementById("edit-boat-description"),a=document.getElementById("edit-boat-length"),n=document.getElementById("edit-boat-width"),i=document.getElementById("edit-boat-capacity"),c=document.getElementById("edit-boat-city"),u=document.getElementById("edit-boat-marina"),h=document.getElementById("edit-boat-price"),l=document.getElementById("edit-boat-deposit"),d=document.getElementById("edit-boat-form");t&&(t.value=e.name||""),r&&(r.value=e.type||""),o&&(o.value=e.category||""),s&&(s.value=e.description||""),a&&(a.value=e.length||""),n&&(n.value=e.width||""),i&&(i.value=e.capacity||""),c&&(c.value=e.city||""),u&&(u.value=e.marina||""),h&&(h.value=e.pricePerDay||""),l&&(l.value=e.deposit||""),d&&(d.dataset.boatId=e._id),this.displayExistingImages(e.images||[])}displayExistingImages(e){const t=document.getElementById("edit-image-preview-container");t&&(t.innerHTML="",e&&e.length>0&&e.forEach((r,o)=>{const s=document.createElement("div");s.className="image-preview-item existing",s.innerHTML=`
          <img src="${r}" alt="Image du bateau">
          <button type="button" class="remove-image-btn" onclick="app.removeExistingImage(${o})">√ó</button>
        `,t.appendChild(s)}))}}document.addEventListener("DOMContentLoaded",()=>{window.app=new H});export{H as S};
