/* empty css              */(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class m{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.authEndpoint=`${this.baseURL}/auth`}async register(e){try{const t=await fetch(`${this.authEndpoint}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log("üì° R√©ponse HTTP:",{status:t.status,statusText:t.statusText,ok:t.ok,url:t.url});let r;try{r=await t.json(),console.log("üìä Donn√©es JSON re√ßues:",r)}catch(s){console.error("‚ùå Erreur parsing JSON:",s);const o=await t.text();throw console.log("üìÑ R√©ponse texte:",o),new Error(`R√©ponse invalide du serveur: ${t.status}`)}if(!t.ok)throw console.error("‚ùå R√©ponse HTTP non-OK:",t.status,r),new Error(r.message||"Erreur lors de l'inscription");return r}catch(t){throw console.error("‚ùå Erreur AuthService.register:",t),t}}async login(e,t){try{const r=`${this.authEndpoint}/login`;console.log("üîê AuthService.login appel√©"),console.log("üìç URL:",r),console.log("üìä Donn√©es:",{email:e,password:t?"***":"vide"});const s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});console.log("üì° R√©ponse HTTP:",{status:s.status,statusText:s.statusText,ok:s.ok,url:s.url});let o;try{o=await s.json(),console.log("üìä Donn√©es JSON re√ßues:",o)}catch(n){console.error("‚ùå Erreur parsing JSON:",n);const a=await s.text();throw console.log("üìÑ R√©ponse texte:",a),new Error(`R√©ponse invalide du serveur: ${s.status}`)}if(!s.ok)throw console.error("‚ùå R√©ponse HTTP non-OK:",s.status,o),new Error(o.message||"Erreur lors de la connexion");return o}catch(r){throw console.error("‚ùå Erreur AuthService.login:",r),r}}async logout(){try{const e=this.getAuthToken(),t=`${this.authEndpoint}/register`;console.log("üìù AuthService.register appel√©"),console.log("üìç URL:",t),console.log("üìä Donn√©es:",{...userData,password:userData.password?"***":"vide"});const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}),s=await r.json();if(!r.ok)throw new Error(s.message||"Erreur lors de la d√©connexion");return s}catch(e){throw console.error("Erreur lors de la d√©connexion:",e),e}}async getProfile(){try{const e=this.getAuthToken();if(!e)throw new Error("Token d'authentification manquant");const t=await fetch(`${this.authEndpoint}/profile`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la r√©cup√©ration du profil");return r}catch(e){throw console.error("Erreur lors de la r√©cup√©ration du profil:",e),e}}async updateProfile(e){try{const t=this.getAuthToken();if(!t)throw new Error("Token d'authentification manquant");const r=await fetch(`${this.authEndpoint}/profile`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await r.json();if(!r.ok)throw new Error(s.message||"Erreur lors de la mise √† jour du profil");return s}catch(t){throw console.error("Erreur lors de la mise √† jour du profil:",t),t}}async changePassword(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Token d'authentification manquant");const s=await fetch(`${this.authEndpoint}/change-password`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})}),o=await s.json();if(!s.ok)throw new Error(o.message||"Erreur lors du changement de mot de passe");return o}catch(r){throw console.error("Erreur lors du changement de mot de passe:",r),r}}async verifyToken(){try{const e=this.getAuthToken();if(!e)throw new Error("Aucun token trouv√©");const t=await fetch(`${this.authEndpoint}/verify-token`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Token invalide");return r}catch(e){throw console.error("Erreur lors de la v√©rification du token:",e),e}}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}isAuthenticated(){const e=this.getAuthToken();if(!e)return!1;try{const t=JSON.parse(atob(e.split(".")[1])),r=Date.now()/1e3;return t.exp>r}catch(t){return console.error("Token invalide:",t),!1}}getCurrentUser(){try{const e=localStorage.getItem("sailingloc_user");return e?JSON.parse(e):null}catch(e){return console.error("Erreur lors de la r√©cup√©ration des donn√©es utilisateur:",e),null}}clearAuthData(){try{localStorage.removeItem("sailingloc_token"),localStorage.removeItem("sailingloc_user")}catch(e){console.error("Erreur lors du nettoyage des donn√©es d'authentification:",e)}}handleAuthError(e){return(e.message.includes("Token")||e.message.includes("401"))&&this.clearAuthData(),{success:!1,message:e.message||"Erreur d'authentification",error:e}}async refreshToken(){try{const e=this.getAuthToken();if(!e)throw new Error("Aucun token √† rafra√Æchir");const t=await fetch(`${this.authEndpoint}/refresh-token`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors du rafra√Æchissement du token");return r.data&&r.data.token&&localStorage.setItem("sailingloc_token",r.data.token),r}catch(e){throw console.error("Erreur lors du rafra√Æchissement du token:",e),this.clearAuthData(),e}}async authenticatedFetch(e,t={}){const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const s={...t,headers:{...t.headers,Authorization:`Bearer ${r}`,"Content-Type":"application/json"}};try{const o=await fetch(e,s);if(o.status===401)try{await this.refreshToken();const n=this.getAuthToken();return s.headers.Authorization=`Bearer ${n}`,await fetch(e,s)}catch{throw this.clearAuthData(),new Error("Session expir√©e, veuillez vous reconnecter")}return o}catch(o){throw console.error("Erreur lors de la requ√™te authentifi√©e:",o),o}}}class g{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.boatsEndpoint=`${this.baseURL}/boats`}async getBoats(e={}){try{const t=new URLSearchParams;Object.keys(e).forEach(n=>{e[n]!==void 0&&e[n]!==""&&t.append(n,e[n])});const r=`${this.boatsEndpoint}?${t.toString()}`,s=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}}),o=await s.json();if(!s.ok)throw new Error(o.message||"Erreur lors de la r√©cup√©ration des bateaux");return o}catch(t){throw console.error("Erreur lors de la r√©cup√©ration des bateaux:",t),t}}async getBoatById(e){try{const t=await fetch(`${this.boatsEndpoint}/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la r√©cup√©ration du bateau");return r}catch(t){throw console.error("Erreur lors de la r√©cup√©ration du bateau:",t),t}}async createBoat(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(this.boatsEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)}),s=await r.json();if(!r.ok)throw new Error(s.message||"Erreur lors de la cr√©ation du bateau");return s}catch(t){throw console.error("Erreur lors de la cr√©ation du bateau:",t),t}}async updateBoat(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const s=await fetch(`${this.boatsEndpoint}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(t)}),o=await s.json();if(!s.ok)throw new Error(o.message||"Erreur lors de la mise √† jour du bateau");return o}catch(r){throw console.error("Erreur lors de la mise √† jour du bateau:",r),r}}async deleteBoat(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.boatsEndpoint}/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),s=await r.json();if(!r.ok)throw new Error(s.message||"Erreur lors de la suppression du bateau");return s}catch(t){throw console.error("Erreur lors de la suppression du bateau:",t),t}}async getOwnerBoats(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams(e),s=`${this.boatsEndpoint}/owner/my-boats?${r.toString()}`,o=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),n=await o.json();if(!o.ok)throw new Error(n.message||"Erreur lors de la r√©cup√©ration des bateaux");return n}catch(t){throw console.error("Erreur lors de la r√©cup√©ration des bateaux du propri√©taire:",t),t}}async checkAvailability(e,t,r){try{const s=new URLSearchParams({startDate:t,endDate:r}),o=await fetch(`${this.boatsEndpoint}/${e}/availability?${s.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}}),n=await o.json();if(!o.ok)throw new Error(n.message||"Erreur lors de la v√©rification de disponibilit√©");return n}catch(s){throw console.error("Erreur lors de la v√©rification de disponibilit√©:",s),s}}async searchNearby(e,t,r=5e4){try{const s=new URLSearchParams({latitude:e.toString(),longitude:t.toString(),maxDistance:r.toString()}),o=await fetch(`${this.boatsEndpoint}/search/nearby?${s.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}}),n=await o.json();if(!o.ok)throw new Error(n.message||"Erreur lors de la recherche par proximit√©");return n}catch(s){throw console.error("Erreur lors de la recherche par proximit√©:",s),s}}async getBoatStats(){try{const e=this.getAuthToken();if(!e)throw new Error("Authentification requise");const t=await fetch(`${this.boatsEndpoint}/stats/overview`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la r√©cup√©ration des statistiques");return r}catch(e){throw console.error("Erreur lors de la r√©cup√©ration des statistiques:",e),e}}async uploadBoatImages(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const s=new FormData;Array.from(t).forEach((a,i)=>{s.append("images",a)});const o=await fetch(`${this.boatsEndpoint}/${e}/images`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:s}),n=await o.json();if(!o.ok)throw new Error(n.message||"Erreur lors de l'upload des images");return n}catch(r){throw console.error("Erreur lors de l'upload des images:",r),r}}async deleteBoatImage(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const s=await fetch(`${this.boatsEndpoint}/${e}/images/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),o=await s.json();if(!s.ok)throw new Error(o.message||"Erreur lors de la suppression de l'image");return o}catch(r){throw console.error("Erreur lors de la suppression de l'image:",r),r}}getBoatTypes(){return[{value:"voilier",label:"Voilier"},{value:"catamaran",label:"Catamaran"},{value:"yacht",label:"Yacht"},{value:"bateau_moteur",label:"Bateau √† moteur"},{value:"semi_rigide",label:"Semi-rigide"},{value:"peniche",label:"P√©niche"}]}getBoatCategories(){return[{value:"luxe",label:"Luxe"},{value:"standard",label:"Standard"},{value:"economique",label:"√âconomique"},{value:"sportif",label:"Sportif"},{value:"familial",label:"Familial"}]}validateBoatData(e){const t=[];return(!e.name||e.name.trim().length===0)&&t.push("Le nom du bateau est obligatoire"),(!e.description||e.description.trim().length===0)&&t.push("La description est obligatoire"),e.type||t.push("Le type de bateau est obligatoire"),e.category||t.push("La cat√©gorie est obligatoire"),e.specifications?((!e.specifications.length||e.specifications.length<=0)&&t.push("La longueur doit √™tre positive"),(!e.specifications.width||e.specifications.width<=0)&&t.push("La largeur doit √™tre positive")):t.push("Les sp√©cifications sont obligatoires"),e.capacity?(!e.capacity.maxPeople||e.capacity.maxPeople<=0)&&t.push("Le nombre maximum de personnes doit √™tre positif"):t.push("La capacit√© est obligatoire"),e.location?((!e.location.marina||e.location.marina.trim().length===0)&&t.push("Le port d'attache est obligatoire"),(!e.location.city||e.location.city.trim().length===0)&&t.push("La ville est obligatoire")):t.push("La localisation est obligatoire"),e.pricing?((!e.pricing.dailyRate||e.pricing.dailyRate<=0)&&t.push("Le tarif journalier doit √™tre positif"),(!e.pricing.securityDeposit||e.pricing.securityDeposit<0)&&t.push("La caution ne peut pas √™tre n√©gative")):t.push("Les tarifs sont obligatoires"),{isValid:t.length===0,errors:t}}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}formatBoatForDisplay(e){var t,r,s,o,n,a;return{...e,formattedPrice:`${e.pricing.dailyRate}‚Ç¨/jour`,formattedCapacity:`${e.capacity.maxPeople} personnes`,formattedLength:`${e.specifications.length}m`,formattedLocation:`${e.location.city}, ${e.location.country}`,mainImage:((r=(t=e.images)==null?void 0:t.find(i=>i.isMain))==null?void 0:r.url)||((o=(s=e.images)==null?void 0:s[0])==null?void 0:o.url),rating:{...e.rating,formattedAverage:((a=(n=e.rating)==null?void 0:n.average)==null?void 0:a.toFixed(1))||"0.0"}}}calculateTotalPrice(e,t,r){const s=new Date(t),o=new Date(r),n=Math.ceil((o-s)/(1e3*60*60*24));let a=0;if(n>=30&&e.pricing.monthlyRate){const i=Math.floor(n/30),l=n%30;a=i*e.pricing.monthlyRate+l*e.pricing.dailyRate}else if(n>=7&&e.pricing.weeklyRate){const i=Math.floor(n/7),l=n%7;a=i*e.pricing.weeklyRate+l*e.pricing.dailyRate}else a=n*e.pricing.dailyRate;return{days:n,subtotal:a,cleaningFee:e.pricing.cleaningFee||0,securityDeposit:e.pricing.securityDeposit,total:a+(e.pricing.cleaningFee||0)}}}class f{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.bookingsEndpoint=`${this.baseURL}/bookings`}async createBooking(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(this.bookingsEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)}),s=await r.json();if(!r.ok)throw new Error(s.message||"Erreur lors de la cr√©ation de la r√©servation");return s}catch(t){throw console.error("Erreur lors de la cr√©ation de la r√©servation:",t),t}}async getUserBookings(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams;Object.keys(e).forEach(a=>{e[a]!==void 0&&e[a]!==""&&r.append(a,e[a])});const s=`${this.bookingsEndpoint}?${r.toString()}`,o=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),n=await o.json();if(!o.ok)throw new Error(n.message||"Erreur lors de la r√©cup√©ration des r√©servations");return n}catch(t){throw console.error("Erreur lors de la r√©cup√©ration des r√©servations:",t),t}}async getBookingById(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.bookingsEndpoint}/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),s=await r.json();if(!r.ok)throw new Error(s.message||"Erreur lors de la r√©cup√©ration de la r√©servation");return s}catch(t){throw console.error("Erreur lors de la r√©cup√©ration de la r√©servation:",t),t}}async confirmBooking(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.bookingsEndpoint}/${e}/confirm`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),s=await r.json();if(!r.ok)throw new Error(s.message||"Erreur lors de la confirmation de la r√©servation");return s}catch(t){throw console.error("Erreur lors de la confirmation de la r√©servation:",t),t}}async cancelBooking(e,t=""){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const s=await fetch(`${this.bookingsEndpoint}/${e}/cancel`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({reason:t})}),o=await s.json();if(!s.ok)throw new Error(o.message||"Erreur lors de l'annulation de la r√©servation");return o}catch(r){throw console.error("Erreur lors de l'annulation de la r√©servation:",r),r}}async checkIn(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const s=await fetch(`${this.bookingsEndpoint}/${e}/checkin`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await s.json();if(!s.ok)throw new Error(o.message||"Erreur lors du check-in");return o}catch(r){throw console.error("Erreur lors du check-in:",r),r}}async checkOut(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const s=await fetch(`${this.bookingsEndpoint}/${e}/checkout`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await s.json();if(!s.ok)throw new Error(o.message||"Erreur lors du check-out");return o}catch(r){throw console.error("Erreur lors du check-out:",r),r}}async addReview(e,t,r){try{const s=this.getAuthToken();if(!s)throw new Error("Authentification requise");const o=await fetch(`${this.bookingsEndpoint}/${e}/review`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify({rating:t,comment:r})}),n=await o.json();if(!o.ok)throw new Error(n.message||"Erreur lors de l'ajout de l'avis");return n}catch(s){throw console.error("Erreur lors de l'ajout de l'avis:",s),s}}async getBookingStats(){try{const e=this.getAuthToken();if(!e)throw new Error("Authentification requise");const t=await fetch(`${this.bookingsEndpoint}/stats/overview`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la r√©cup√©ration des statistiques");return r}catch(e){throw console.error("Erreur lors de la r√©cup√©ration des statistiques:",e),e}}validateBookingData(e){const t=[];if(e.boatId||t.push("L'ID du bateau est obligatoire"),e.startDate||t.push("La date de d√©but est obligatoire"),e.endDate||t.push("La date de fin est obligatoire"),e.startDate&&e.endDate){const r=new Date(e.startDate),s=new Date(e.endDate),o=new Date;o.setHours(0,0,0,0),r<o&&t.push("La date de d√©but ne peut pas √™tre dans le pass√©"),s<=r&&t.push("La date de fin doit √™tre post√©rieure √† la date de d√©but");const n=new Date;n.setFullYear(n.getFullYear()+1),r>n&&t.push("La r√©servation ne peut pas √™tre faite plus d'un an √† l'avance")}return e.participants?((!e.participants.adults||e.participants.adults<1)&&t.push("Il doit y avoir au moins 1 adulte"),e.participants.children&&e.participants.children<0&&t.push("Le nombre d'enfants ne peut pas √™tre n√©gatif")):t.push("Les informations sur les participants sont obligatoires"),e.emergencyContact?((!e.emergencyContact.name||e.emergencyContact.name.trim().length===0)&&t.push("Le nom du contact d'urgence est obligatoire"),(!e.emergencyContact.phone||e.emergencyContact.phone.trim().length===0)&&t.push("Le t√©l√©phone du contact d'urgence est obligatoire"),(!e.emergencyContact.relationship||e.emergencyContact.relationship.trim().length===0)&&t.push("La relation avec le contact d'urgence est obligatoire")):t.push("Le contact d'urgence est obligatoire"),e.renterExperience?(e.renterExperience.hasLicense===void 0&&t.push("L'information sur le permis nautique est obligatoire"),e.renterExperience.yearsOfExperience!==void 0&&e.renterExperience.yearsOfExperience<0&&t.push("Les ann√©es d'exp√©rience ne peuvent pas √™tre n√©gatives")):t.push("Les informations sur l'exp√©rience nautique sont obligatoires"),{isValid:t.length===0,errors:t}}calculateCancellationFees(e){const t=new Date,r=new Date(e.startDate),s=Math.ceil((r-t)/(1e3*60*60*24));let o=0;s<1?o=100:s<7?o=50:s<14?o=25:s<30&&(o=10);const n=e.pricing.totalAmount*o/100,a=e.pricing.totalAmount-n;return{daysUntilStart:s,feePercentage:o,cancellationFee:n,refundAmount:a,canCancel:s>=0}}formatBookingForDisplay(e){const t=new Date(e.startDate),r=new Date(e.endDate),s=Math.ceil((r-t)/(1e3*60*60*24));return{...e,formattedStartDate:t.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),formattedEndDate:r.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),formattedDuration:`${s} jour${s>1?"s":""}`,formattedTotalAmount:`${e.pricing.totalAmount}‚Ç¨`,formattedStatus:this.getStatusLabel(e.status),statusColor:this.getStatusColor(e.status),canCancel:this.canCancelBooking(e),canReview:this.canReviewBooking(e)}}getStatusLabel(e){return{pending:"En attente",confirmed:"Confirm√©e",paid:"Pay√©e",active:"En cours",completed:"Termin√©e",cancelled:"Annul√©e",refunded:"Rembours√©e"}[e]||e}getStatusColor(e){return{pending:"status-warning",confirmed:"status-info",paid:"status-success",active:"status-primary",completed:"status-success",cancelled:"status-danger",refunded:"status-secondary"}[e]||"status-default"}canCancelBooking(e){const t=["pending","confirmed","paid"],r=new Date,s=new Date(e.startDate);return t.includes(e.status)&&s>r}canReviewBooking(e){var t;return e.status==="completed"&&!((t=e.review)!=null&&t.renterReview)}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}createDefaultBookingData(e){const t=new Date;t.setDate(t.getDate()+1);const r=new Date;return r.setDate(r.getDate()+2),{boatId:e,startDate:t.toISOString().split("T")[0],endDate:r.toISOString().split("T")[0],participants:{adults:2,children:0},emergencyContact:{name:"",phone:"",relationship:""},renterExperience:{hasLicense:!1,licenseType:"",yearsOfExperience:0,previousBoatTypes:[],additionalInfo:""},specialRequests:"",skipperRequested:!1,additionalServices:[]}}toCalendarEvent(e){return{id:e._id,title:`${e.boat.name} - ${e.bookingNumber}`,start:e.startDate,end:e.endDate,color:this.getStatusColor(e.status),extendedProps:{booking:e,status:e.status,boatName:e.boat.name,totalAmount:e.pricing.totalAmount}}}}class y{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.paymentsEndpoint=`${this.baseURL}/payments`,this.stripePublishableKey=void 0,this.stripe=null,this.initializeStripe()}async initializeStripe(){if(this.stripePublishableKey&&window.Stripe)try{this.stripe=window.Stripe(this.stripePublishableKey),console.log("‚úÖ Stripe initialis√©")}catch(e){console.error("‚ùå Erreur lors de l'initialisation de Stripe:",e)}else console.log("‚ÑπÔ∏è Stripe non configur√© - Mode simulation activ√©")}async createPaymentIntent(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.paymentsEndpoint}/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({bookingId:e})}),s=await r.json();if(!r.ok)throw new Error(s.message||"Erreur lors de la cr√©ation du paiement");return s}catch(t){throw console.error("Erreur lors de la cr√©ation du Payment Intent:",t),t}}async confirmPayment(e,t=null){try{if(!this.getAuthToken())throw new Error("Authentification requise");return this.stripe&&t?await this.confirmStripePayment(e,t):await this.confirmSimulatedPayment(e,t)}catch(r){throw console.error("Erreur lors de la confirmation du paiement:",r),r}}async confirmStripePayment(e,t){try{const{error:r,paymentIntent:s}=await this.stripe.confirmCardPayment(e,{payment_method:t});if(r)throw new Error(r.message);return s.status==="succeeded"?await this.notifyPaymentSuccess(e):{success:!1,message:"Le paiement n'a pas pu √™tre trait√©"}}catch(r){throw console.error("Erreur lors du paiement Stripe:",r),r}}async confirmSimulatedPayment(e,t){try{const r=this.getAuthToken(),s=await fetch(`${this.paymentsEndpoint}/confirm-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({paymentIntentId:e,paymentMethodId:t||"pm_simulation_card"})}),o=await s.json();if(!s.ok)throw new Error(o.message||"Erreur lors de la confirmation du paiement");return o}catch(r){throw console.error("Erreur lors du paiement simul√©:",r),r}}async notifyPaymentSuccess(e){try{const t=this.getAuthToken(),r=await fetch(`${this.paymentsEndpoint}/confirm-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({paymentIntentId:e})}),s=await r.json();if(!r.ok)throw new Error(s.message||"Erreur lors de la notification du paiement");return s}catch(t){throw console.error("Erreur lors de la notification du paiement:",t),t}}async refundPayment(e,t=null,r=""){try{const s=this.getAuthToken();if(!s)throw new Error("Authentification requise");const o=await fetch(`${this.paymentsEndpoint}/refund`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({bookingId:e,amount:t,reason:r})}),n=await o.json();if(!o.ok)throw new Error(n.message||"Erreur lors du remboursement");return n}catch(s){throw console.error("Erreur lors du remboursement:",s),s}}async getPaymentHistory(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams;Object.keys(e).forEach(a=>{e[a]!==void 0&&e[a]!==""&&r.append(a,e[a])});const s=`${this.paymentsEndpoint}/history?${r.toString()}`,o=await fetch(s,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),n=await o.json();if(!o.ok)throw new Error(n.message||"Erreur lors de la r√©cup√©ration de l'historique");return n}catch(t){throw console.error("Erreur lors de la r√©cup√©ration de l'historique des paiements:",t),t}}async getPaymentStats(){try{const e=this.getAuthToken();if(!e)throw new Error("Authentification requise");const t=await fetch(`${this.paymentsEndpoint}/stats`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la r√©cup√©ration des statistiques");return r}catch(e){throw console.error("Erreur lors de la r√©cup√©ration des statistiques de paiement:",e),e}}createSimulatedPaymentForm(e,t){const r=document.createElement("form");return r.className="payment-form",r.innerHTML=`
      <div class="payment-header">
        <h3>Paiement s√©curis√©</h3>
        <p class="payment-amount">Montant: ${(e.amount/100).toFixed(2)}‚Ç¨</p>
      </div>
      
      <div class="payment-method">
        <h4>Mode de paiement</h4>
        <div class="payment-options">
          <label class="payment-option">
            <input type="radio" name="payment-method" value="card" checked>
            <span class="option-label">
              üí≥ Carte bancaire
            </span>
          </label>
        </div>
      </div>
      
      <div class="card-form" id="card-form">
        <div class="form-group">
          <label for="card-number">Num√©ro de carte</label>
          <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="card-expiry">MM/AA</label>
            <input type="text" id="card-expiry" placeholder="12/25" maxlength="5" required>
          </div>
          <div class="form-group">
            <label for="card-cvc">CVC</label>
            <input type="text" id="card-cvc" placeholder="123" maxlength="4" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="card-name">Nom sur la carte</label>
          <input type="text" id="card-name" placeholder="Jean Dupont" required>
        </div>
      </div>
      
      <div class="payment-summary">
        <div class="summary-line">
          <span>Sous-total:</span>
          <span>${(e.amount/100).toFixed(2)}‚Ç¨</span>
        </div>
        <div class="summary-line total">
          <span>Total:</span>
          <span>${(e.amount/100).toFixed(2)}‚Ç¨</span>
        </div>
      </div>
      
      <button type="submit" class="btn-primary btn-full payment-submit">
        Payer ${(e.amount/100).toFixed(2)}‚Ç¨
      </button>
      
      <div class="payment-security">
        <p>üîí Paiement s√©curis√© SSL</p>
      </div>
    `,this.setupCardFormatting(r),r.addEventListener("submit",async s=>{s.preventDefault();try{const o=r.querySelector(".payment-submit"),n=o.textContent;o.disabled=!0,o.textContent="Traitement...",await new Promise(i=>setTimeout(i,2e3));const a=await this.confirmPayment(e.id);if(a.success)this.showPaymentSuccess(t,a.data);else throw new Error(a.message||"Erreur de paiement")}catch(o){console.error("Erreur de paiement:",o),this.showPaymentError(t,o.message);const n=r.querySelector(".payment-submit");n.disabled=!1,n.textContent=originalText}}),t.innerHTML="",t.appendChild(r),{form:r,submit:()=>r.dispatchEvent(new Event("submit"))}}setupCardFormatting(e){const t=e.querySelector("#card-number"),r=e.querySelector("#card-expiry"),s=e.querySelector("#card-cvc");t&&t.addEventListener("input",o=>{var i;let n=o.target.value.replace(/\s/g,"").replace(/[^0-9]/gi,""),a=((i=n.match(/.{1,4}/g))==null?void 0:i.join(" "))||n;o.target.value=a}),r&&r.addEventListener("input",o=>{let n=o.target.value.replace(/\D/g,"");n.length>=2&&(n=n.substring(0,2)+"/"+n.substring(2,4)),o.target.value=n}),s&&s.addEventListener("input",o=>{o.target.value=o.target.value.replace(/[^0-9]/g,"")})}showPaymentSuccess(e,t){e.innerHTML=`
      <div class="payment-success">
        <div class="success-icon">‚úÖ</div>
        <h3>Paiement r√©ussi !</h3>
        <p>Votre r√©servation a √©t√© confirm√©e.</p>
        <div class="payment-details">
          <p><strong>Num√©ro de r√©servation:</strong> ${t.booking.bookingNumber}</p>
          <p><strong>Montant pay√©:</strong> ${t.payment.amount}‚Ç¨</p>
        </div>
        <button class="btn-primary" onclick="window.location.reload()">
          Retour √† l'accueil
        </button>
      </div>
    `}showPaymentError(e,t){const r=document.createElement("div");r.className="payment-error",r.innerHTML=`
      <div class="error-icon">‚ùå</div>
      <p><strong>Erreur de paiement:</strong> ${t}</p>
      <button class="btn-secondary" onclick="this.parentElement.remove()">
        R√©essayer
      </button>
    `,e.insertBefore(r,e.firstChild),setTimeout(()=>{r.parentElement&&r.remove()},5e3)}validateCardData(e){const t=[];if((!e.number||e.number.replace(/\s/g,"").length<13)&&t.push("Num√©ro de carte invalide"),!e.expiry||!/^\d{2}\/\d{2}$/.test(e.expiry))t.push("Date d'expiration invalide (MM/AA)");else{const[r,s]=e.expiry.split("/"),o=new Date,n=o.getFullYear()%100,a=o.getMonth()+1;(parseInt(r)<1||parseInt(r)>12)&&t.push("Mois d'expiration invalide"),(parseInt(s)<n||parseInt(s)===n&&parseInt(r)<a)&&t.push("Carte expir√©e")}return(!e.cvc||e.cvc.length<3||e.cvc.length>4)&&t.push("Code CVC inval ide"),(!e.name||e.name.trim().length<2)&&t.push("Nom sur la carte requis"),{isValid:t.length===0,errors:t}}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}formatAmount(e,t="EUR"){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:t}).format(e/100)}isStripeReady(){return this.stripe!==null&&this.stripePublishableKey!==void 0}async loadStripe(){if(window.Stripe)return!0;try{const e=document.createElement("script");return e.src="https://js.stripe.com/v3/",e.async=!0,new Promise((t,r)=>{e.onload=()=>{this.initializeStripe(),t(!0)},e.onerror=()=>r(!1),document.head.appendChild(e)})}catch(e){return console.error("Erreur lors du chargement de Stripe:",e),!1}}}class v{constructor(){this.notificationContainer=null,this.notificationQueue=[],this.maxNotifications=5,this.activeModals=new Set,this.loadingElements=new Map,this.init()}init(){this.createNotificationContainer(),this.setupGlobalEventListeners(),this.setupKeyboardShortcuts()}createNotificationContainer(){this.notificationContainer=document.getElementById("notifications"),this.notificationContainer||(this.notificationContainer=document.createElement("div"),this.notificationContainer.id="notifications",this.notificationContainer.className="notifications",document.body.appendChild(this.notificationContainer))}setupGlobalEventListeners(){document.addEventListener("keydown",e=>{e.key==="Escape"&&this.closeTopModal()}),window.addEventListener("resize",()=>{this.handleWindowResize()}),window.addEventListener("scroll",()=>{this.handleScroll()})}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),this.focusSearchInput())})}showNotification(e,t="info",r=5e3,s={}){const o={id:Date.now()+Math.random(),message:e,type:t,duration:r,...s};if(this.notificationContainer.children.length>=this.maxNotifications){this.notificationQueue.push(o);return}this.renderNotification(o)}renderNotification(e){const t=document.createElement("div");t.className=`notification notification-${e.type}`,t.setAttribute("data-notification-id",e.id);const r={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};if(t.innerHTML=`
      <div class="notification-content">
        <span class="notification-icon">${r[e.type]||r.info}</span>
        <span class="notification-message">${e.message}</span>
        <button class="notification-close" aria-label="Fermer">√ó</button>
      </div>
      ${e.duration>0?'<div class="notification-progress"></div>':""}
    `,t.querySelector(".notification-close").addEventListener("click",()=>{this.hideNotification(e.id)}),t.style.transform="translateX(100%)",t.style.opacity="0",this.notificationContainer.appendChild(t),requestAnimationFrame(()=>{t.style.transform="translateX(0)",t.style.opacity="1"}),e.duration>0){const o=t.querySelector(".notification-progress");o&&(o.style.animationDuration=`${e.duration}ms`),setTimeout(()=>{this.hideNotification(e.id)},e.duration)}}hideNotification(e){const t=this.notificationContainer.querySelector(`[data-notification-id="${e}"]`);t&&(t.style.transform="translateX(100%)",t.style.opacity="0",setTimeout(()=>{if(t.parentElement&&(t.remove(),this.notificationQueue.length>0)){const r=this.notificationQueue.shift();this.renderNotification(r)}},300))}showModal(e,t={}){const r=document.getElementById(e);if(!r){console.error(`Modale ${e} non trouv√©e`);return}this.activeModals.add(e);const s={closeOnBackdrop:!0,focus:!0,...t};r.style.display="flex",r.classList.add("modal-active"),requestAnimationFrame(()=>{r.classList.add("modal-open")}),s.focus&&setTimeout(()=>{const o=r.querySelector("input, button, textarea, select");o&&o.focus()},100),document.body.classList.add("modal-open"),s.closeOnBackdrop&&r.addEventListener("click",this.handleModalBackdropClick.bind(this))}hideModal(e){const t=document.getElementById(e);t&&(this.activeModals.delete(e),t.classList.remove("modal-open"),setTimeout(()=>{t.style.display="none",t.classList.remove("modal-active"),this.activeModals.size===0&&document.body.classList.remove("modal-open")},300),t.removeEventListener("click",this.handleModalBackdropClick.bind(this)))}closeTopModal(){if(this.activeModals.size>0){const e=Array.from(this.activeModals).pop();this.hideModal(e)}}handleModalBackdropClick(e){if(e.target.classList.contains("modal")){const t=e.target.id;this.hideModal(t)}}showLoading(e,t="Chargement..."){const r=typeof e=="string"?document.getElementById(e)||document.querySelector(e):e;if(!r){console.error(`√âl√©ment ${e} non trouv√© pour le loading`);return}this.loadingElements.has(r)||this.loadingElements.set(r,{originalContent:r.innerHTML,originalDisabled:r.disabled});const s=`
      <div class="loading-overlay">
        <div class="loading-spinner">
          <div class="spinner"></div>
          <span class="loading-message">${t}</span>
        </div>
      </div>
    `;r.tagName==="BUTTON"?(r.disabled=!0,r.innerHTML=`<span class="spinner-small"></span> ${t}`):(r.style.position="relative",r.insertAdjacentHTML("beforeend",s))}hideLoading(e){const t=typeof e=="string"?document.getElementById(e)||document.querySelector(e):e;if(!t)return;const r=this.loadingElements.get(t);r&&(t.innerHTML=r.originalContent,t.disabled=r.originalDisabled,this.loadingElements.delete(t));const s=t.querySelector(".loading-overlay");s&&s.remove()}scrollTo(e,t={}){const r=typeof e=="string"?document.querySelector(e):e;if(!r){console.error(`√âl√©ment ${e} non trouv√© pour le scroll`);return}const s={behavior:"smooth",offset:0,...t},n=r.getBoundingClientRect().top+window.pageYOffset-s.offset;window.scrollTo({top:n,behavior:s.behavior})}handleWindowResize(){this.activeModals.forEach(e=>{document.getElementById(e)})}handleScroll(){const e=window.scrollY,t=document.querySelector(".hero");if(t){const s=t.querySelector(".hero-image");s&&(s.style.transform=`translateY(${e*.5}px)`)}const r=document.querySelector(".navbar");r&&(e>100?r.classList.add("scrolled"):r.classList.remove("scrolled"))}focusSearchInput(){const e=document.getElementById("search-location");e&&(e.focus(),e.select())}}class w{constructor(){this.prefix="sailingloc_",this.isStorageAvailable=this.checkStorageAvailability()}checkStorageAvailability(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return console.warn("localStorage non disponible:",e),!1}}setToken(e){if(!this.isStorageAvailable)return!1;try{return localStorage.setItem(`${this.prefix}token`,e),!0}catch(t){return console.error("Erreur lors de la sauvegarde du token:",t),!1}}getToken(){if(!this.isStorageAvailable)return null;try{return localStorage.getItem(`${this.prefix}token`)}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}removeToken(){if(!this.isStorageAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}token`),!0}catch(e){return console.error("Erreur lors de la suppression du token:",e),!1}}setUser(e){if(!this.isStorageAvailable)return!1;try{return localStorage.setItem(`${this.prefix}user`,JSON.stringify(e)),!0}catch(t){return console.error("Erreur lors de la sauvegarde des donn√©es utilisateur:",t),!1}}getUser(){if(!this.isStorageAvailable)return null;try{const e=localStorage.getItem(`${this.prefix}user`);return e?JSON.parse(e):null}catch(e){return console.error("Erreur lors de la r√©cup√©ration des donn√©es utilisateur:",e),null}}removeUser(){if(!this.isStorageAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}user`),!0}catch(e){return console.error("Erreur lors de la suppression des donn√©es utilisateur:",e),!1}}clearAuth(){const e=this.removeToken(),t=this.removeUser();return e&&t}setSearchPreferences(e){if(!this.isStorageAvailable)return!1;try{return localStorage.setItem(`${this.prefix}search_prefs`,JSON.stringify(e)),!0}catch(t){return console.error("Erreur lors de la sauvegarde des pr√©f√©rences:",t),!1}}getSearchPreferences(){if(!this.isStorageAvailable)return this.getDefaultSearchPreferences();try{const e=localStorage.getItem(`${this.prefix}search_prefs`);return e?JSON.parse(e):this.getDefaultSearchPreferences()}catch(e){return console.error("Erreur lors de la r√©cup√©ration des pr√©f√©rences:",e),this.getDefaultSearchPreferences()}}getDefaultSearchPreferences(){return{location:"",type:"all",maxPrice:1e3,minCapacity:1,sortBy:"price",sortOrder:"asc"}}addToSearchHistory(e){if(!this.isStorageAvailable||!e.trim())return!1;try{let t=this.getSearchHistory();return t=t.filter(r=>r.toLowerCase()!==e.toLowerCase()),t.unshift(e.trim()),t=t.slice(0,10),localStorage.setItem(`${this.prefix}search_history`,JSON.stringify(t)),!0}catch(t){return console.error("Erreur lors de la sauvegarde de l'historique:",t),!1}}getSearchHistory(){if(!this.isStorageAvailable)return[];try{const e=localStorage.getItem(`${this.prefix}search_history`);return e?JSON.parse(e):[]}catch(e){return console.error("Erreur lors de la r√©cup√©ration de l'historique:",e),[]}}clearSearchHistory(){if(!this.isStorageAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}search_history`),!0}catch(e){return console.error("Erreur lors de l'effacement de l'historique:",e),!1}}addToFavorites(e){if(!this.isStorageAvailable||!e)return!1;try{let t=this.getFavorites();return t.includes(e)||(t.push(e),localStorage.setItem(`${this.prefix}favorites`,JSON.stringify(t))),!0}catch(t){return console.error("Erreur lors de l'ajout aux favoris:",t),!1}}removeFromFavorites(e){if(!this.isStorageAvailable||!e)return!1;try{let t=this.getFavorites();return t=t.filter(r=>r!==e),localStorage.setItem(`${this.prefix}favorites`,JSON.stringify(t)),!0}catch(t){return console.error("Erreur lors de la suppression des favoris:",t),!1}}getFavorites(){if(!this.isStorageAvailable)return[];try{const e=localStorage.getItem(`${this.prefix}favorites`);return e?JSON.parse(e):[]}catch(e){return console.error("Erreur lors de la r√©cup√©ration des favoris:",e),[]}}isFavorite(e){return this.getFavorites().includes(e)}setAppSettings(e){if(!this.isStorageAvailable)return!1;try{const r={...this.getAppSettings(),...e};return localStorage.setItem(`${this.prefix}app_settings`,JSON.stringify(r)),!0}catch(t){return console.error("Erreur lors de la sauvegarde des param√®tres:",t),!1}}getAppSettings(){if(!this.isStorageAvailable)return this.getDefaultAppSettings();try{const e=localStorage.getItem(`${this.prefix}app_settings`);return e?JSON.parse(e):this.getDefaultAppSettings()}catch(e){return console.error("Erreur lors de la r√©cup√©ration des param√®tres:",e),this.getDefaultAppSettings()}}getDefaultAppSettings(){return{theme:"light",language:"fr",currency:"EUR",notifications:!0,emailUpdates:!0,autoSave:!0}}setFormData(e,t){if(!this.isStorageAvailable||!e)return!1;try{return localStorage.setItem(`${this.prefix}form_${e}`,JSON.stringify(t)),!0}catch(r){return console.error("Erreur lors de la sauvegarde du formulaire:",r),!1}}getFormData(e){if(!this.isStorageAvailable||!e)return null;try{const t=localStorage.getItem(`${this.prefix}form_${e}`);return t?JSON.parse(t):null}catch(t){return console.error("Erreur lors de la r√©cup√©ration du formulaire:",t),null}}removeFormData(e){if(!this.isStorageAvailable||!e)return!1;try{return localStorage.removeItem(`${this.prefix}form_${e}`),!0}catch(t){return console.error("Erreur lors de la suppression du formulaire:",t),!1}}clearAllData(){if(!this.isStorageAvailable)return!1;try{return Object.keys(localStorage).forEach(t=>{t.startsWith(this.prefix)&&localStorage.removeItem(t)}),!0}catch(e){return console.error("Erreur lors du nettoyage des donn√©es:",e),!1}}getStorageSize(){if(!this.isStorageAvailable)return{bytes:0,kb:0,mb:0};try{let e=0;return Object.keys(localStorage).forEach(r=>{r.startsWith(this.prefix)&&(e+=localStorage.getItem(r).length)}),{bytes:e,kb:Math.round(e/1024*100)/100,mb:Math.round(e/(1024*1024)*100)/100}}catch(e){return console.error("Erreur lors du calcul de la taille:",e),{bytes:0,kb:0,mb:0}}}setWithExpiry(e,t,r){if(!this.isStorageAvailable)return!1;try{const o={value:t,expiry:new Date().getTime()+r};return localStorage.setItem(`${this.prefix}${e}`,JSON.stringify(o)),!0}catch(s){return console.error("Erreur lors de la sauvegarde avec expiration:",s),!1}}getWithExpiry(e){if(!this.isStorageAvailable)return null;try{const t=localStorage.getItem(`${this.prefix}${e}`);if(!t)return null;const r=JSON.parse(t);return new Date().getTime()>r.expiry?(localStorage.removeItem(`${this.prefix}${e}`),null):r.value}catch(t){return console.error("Erreur lors de la r√©cup√©ration avec expiration:",t),null}}setSessionData(e,t){try{return sessionStorage.setItem(`${this.prefix}${e}`,JSON.stringify(t)),!0}catch(r){return console.error("Erreur lors de la sauvegarde en session:",r),!1}}getSessionData(e){try{const t=sessionStorage.getItem(`${this.prefix}${e}`);return t?JSON.parse(t):null}catch(t){return console.error("Erreur lors de la r√©cup√©ration en session:",t),null}}removeSessionData(e){try{return sessionStorage.removeItem(`${this.prefix}${e}`),!0}catch(t){return console.error("Erreur lors de la suppression en session:",t),!1}}}class E{constructor(){this.authService=new m,this.boatService=new g,this.bookingService=new f,this.paymentService=new y,this.uiManager=new v,this.storageManager=new w,this.currentUser=null,this.currentPage=1,this.boatsPerPage=12,this.currentFilters={},this.init()}async init(){try{console.log("üöÄ Initialisation de SailingLoc..."),await this.checkAuthStatus(),this.setupEventListeners();const e=window.location.pathname;(e==="/"||e.endsWith("index.html")||e.endsWith("boats.html"))&&await this.loadBoats(),this.setupNavigation(),console.log("‚úÖ SailingLoc initialis√© avec succ√®s")}catch(e){console.error("‚ùå Erreur lors de l'initialisation:",e),this.uiManager.showNotification("Erreur lors du chargement de l'application","error")}}async checkAuthStatus(){if(this.storageManager.getToken())try{const t=await this.authService.verifyToken();t.success?(this.currentUser=t.data.user,this.updateUIForAuthenticatedUser()):this.storageManager.clearAuth()}catch(t){console.error("Erreur lors de la v√©rification du token:",t),this.storageManager.clearAuth()}}setupEventListeners(){this.setupAuthListeners(),this.setupSearchListeners(),this.setupNavigationListeners(),this.setupFormListeners(),this.setupModalListeners()}setupAuthListeners(){const e=document.getElementById("login-btn"),t=document.getElementById("register-btn");e&&e.addEventListener("click",()=>this.uiManager.showModal("login-modal")),t&&t.addEventListener("click",()=>this.uiManager.showModal("register-modal"));const r=document.getElementById("login-form"),s=document.getElementById("register-form");r&&r.addEventListener("submit",c=>this.handleLogin(c)),s&&s.addEventListener("submit",c=>this.handleRegister(c));const o=document.getElementById("switch-to-register"),n=document.getElementById("switch-to-login");o&&o.addEventListener("click",c=>{c.preventDefault(),this.uiManager.hideModal("login-modal"),this.uiManager.showModal("register-modal")}),n&&n.addEventListener("click",c=>{c.preventDefault(),this.uiManager.hideModal("register-modal"),this.uiManager.showModal("login-modal")});const a=document.getElementById("user-avatar"),i=document.getElementById("logout-link");a&&a.addEventListener("click",()=>this.toggleUserMenu()),i&&i.addEventListener("click",c=>{c.preventDefault(),this.handleLogout()});const l=document.getElementById("profile-link"),d=document.getElementById("bookings-link"),u=document.getElementById("boats-link");l&&l.addEventListener("click",c=>{c.preventDefault(),this.showProfile()}),d&&d.addEventListener("click",c=>{c.preventDefault(),this.showBookings()}),u&&u.addEventListener("click",c=>{c.preventDefault(),this.showMyBoats()})}setupSearchListeners(){const e=window.location.pathname;if(!(e==="/"||e.endsWith("index.html")||e.endsWith("boats.html")))return;const r=document.getElementById("search-btn");r&&r.addEventListener("click",()=>this.handleSearch());const s=document.getElementById("apply-filters");s&&s.addEventListener("click",()=>this.applyFilters());const o=document.getElementById("filter-price"),n=document.getElementById("price-display");o&&n&&o.addEventListener("input",l=>{n.textContent=`${l.target.value}‚Ç¨`});const a=document.getElementById("prev-page"),i=document.getElementById("next-page");a&&a.addEventListener("click",()=>this.changePage(this.currentPage-1)),i&&i.addEventListener("click",()=>this.changePage(this.currentPage+1))}setupNavigationListeners(){const e=document.getElementById("mobile-menu-toggle"),t=document.getElementById("nav-menu");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active")});const r=document.querySelectorAll(".nav-link");r.forEach(s=>{s.addEventListener("click",o=>{const n=s.getAttribute("href");if(n&&(n.includes(".html")||n.startsWith("http")))return;o.preventDefault();const a=n.substring(1),i=document.getElementById(a);i&&(i.scrollIntoView({behavior:"smooth",block:"start"}),r.forEach(l=>l.classList.remove("active")),s.classList.add("active"))})}),window.addEventListener("scroll",()=>{const s=document.getElementById("navbar");s&&(window.scrollY>100?s.classList.add("scrolled"):s.classList.remove("scrolled"))})}setupFormListeners(){const e=document.getElementById("contact-form");e&&e.addEventListener("submit",c=>this.handleContactForm(c));const t=document.getElementById("profile-form");t&&t.addEventListener("submit",c=>this.handleProfileUpdate(c));const r=document.getElementById("change-password-form");r&&r.addEventListener("submit",c=>this.handlePasswordChange(c));const s=document.getElementById("change-password-form-profile");s&&s.addEventListener("submit",c=>this.handlePasswordChange(c));const o=document.getElementById("preferences-form");o&&o.addEventListener("submit",c=>this.handlePreferencesUpdate(c));const n=document.getElementById("add-boat-form");n&&n.addEventListener("submit",c=>this.handleAddBoat(c));const a=document.getElementById("change-password-btn");a&&a.addEventListener("click",()=>{this.uiManager.showModal("change-password-modal")});const i=document.getElementById("add-boat-btn");i&&i.addEventListener("click",()=>{this.uiManager.showModal("add-boat-modal")}),document.querySelectorAll(".tab-btn").forEach(c=>{c.addEventListener("click",()=>{const p=c.getAttribute("data-tab");this.switchTab(p)})});const d=document.getElementById("refresh-bookings"),u=document.getElementById("refresh-boats");d&&d.addEventListener("click",()=>this.loadUserBookings()),u&&u.addEventListener("click",()=>this.loadOwnerBoats())}setupModalListeners(){document.querySelectorAll(".modal-close").forEach(r=>{r.addEventListener("click",s=>{const o=r.closest(".modal");o&&this.uiManager.hideModal(o.id)})}),document.querySelectorAll(".modal").forEach(r=>{r.addEventListener("click",s=>{s.target===r&&this.uiManager.hideModal(r.id)})})}async handleLogin(e){e.preventDefault();const t=document.getElementById("login-email").value,r=document.getElementById("login-password").value;if(console.log("üîê Tentative de connexion:",{email:t,password:r?"***":"vide"}),!t||!r){this.uiManager.showNotification("Veuillez remplir tous les champs","error");return}try{this.uiManager.showLoading("login-form"),console.log("üîê Appel AuthService.login...");const s=await this.authService.login(t,r);console.log("üì° R√©ponse compl√®te:",s),s.success?(console.log("‚úÖ Connexion r√©ussie, donn√©es utilisateur:",s.data.user),this.currentUser=s.data.user,this.storageManager.setToken(s.data.token),this.storageManager.setUser(s.data.user),this.updateUIForAuthenticatedUser(),this.uiManager.hideModal("login-modal"),this.uiManager.showNotification("Connexion r√©ussie !","success"),document.getElementById("login-form").reset()):(console.error("‚ùå √âchec de connexion:",s.message),this.uiManager.showNotification(s.message||"Email ou mot de passe incorrect","error"))}catch(s){console.error("Erreur de connexion:",s),this.uiManager.showNotification(`Erreur de connexion: ${s.message||"Probl√®me de r√©seau"}`,"error")}finally{this.uiManager.hideLoading("login-form")}}async handleRegister(e){e.preventDefault();const t={firstName:document.getElementById("register-firstname").value,lastName:document.getElementById("register-lastname").value,email:document.getElementById("register-email").value,password:document.getElementById("register-password").value,phone:document.getElementById("register-phone").value,role:document.getElementById("register-role").value};if(console.log("üìù Tentative d'inscription:",{...t,password:t.password?"***":"vide"}),!t.firstName||!t.lastName||!t.email||!t.password||!t.role){this.uiManager.showNotification("Veuillez remplir tous les champs obligatoires","error");return}if(t.password.length<6){this.uiManager.showNotification("Le mot de passe doit contenir au moins 6 caract√®res","error");return}try{this.uiManager.showLoading("register-form"),console.log("üìù Appel AuthService.register...");const r=await this.authService.register(t);console.log("üì° R√©ponse inscription:",r),r.success?(console.log("‚úÖ Inscription r√©ussie, donn√©es utilisateur:",r.data.user),this.currentUser=r.data.user,this.storageManager.setToken(r.data.token),this.storageManager.setUser(r.data.user),this.updateUIForAuthenticatedUser(),this.uiManager.hideModal("register-modal"),this.uiManager.showNotification("Inscription r√©ussie !","success"),document.getElementById("register-form").reset()):(console.error("‚ùå √âchec d'inscription:",r.message),this.uiManager.showNotification(r.message||"Erreur d'inscription","error"))}catch(r){console.error("Erreur d'inscription:",r),this.uiManager.showNotification(`Erreur d'inscription: ${r.message||"Probl√®me de r√©seau"}`,"error")}finally{this.uiManager.hideLoading("register-form")}}async handleLogout(){try{await this.authService.logout(),this.currentUser=null,this.storageManager.clearAuth(),this.updateUIForUnauthenticatedUser(),this.uiManager.showNotification("D√©connexion r√©ussie","success")}catch(e){console.error("Erreur de d√©connexion:",e),this.currentUser=null,this.storageManager.clearAuth(),this.updateUIForUnauthenticatedUser()}}async showProfile(){try{this.uiManager.showModal("profile-modal"),await this.loadUserProfile()}catch(e){console.error("Erreur lors de l'affichage du profil:",e),this.uiManager.showNotification("Erreur lors du chargement du profil","error")}}async loadUserProfile(){var e,t;try{const r=await this.authService.getProfile();if(r.success){const s=r.data.user;document.getElementById("profile-firstname").value=s.firstName||"",document.getElementById("profile-lastname").value=s.lastName||"",document.getElementById("profile-email").value=s.email||"",document.getElementById("profile-phone").value=s.phone||"",s.address&&(document.getElementById("profile-street").value=s.address.street||"",document.getElementById("profile-city").value=s.address.city||"",document.getElementById("profile-postal").value=s.address.postalCode||""),s.preferences&&(document.getElementById("profile-language").value=s.preferences.language||"fr",document.getElementById("profile-currency").value=s.preferences.currency||"EUR",document.getElementById("email-notifications").checked=((e=s.preferences.notifications)==null?void 0:e.email)!==!1,document.getElementById("sms-notifications").checked=((t=s.preferences.notifications)==null?void 0:t.sms)===!0)}}catch(r){console.error("Erreur lors du chargement du profil:",r),this.uiManager.showNotification("Erreur lors du chargement du profil","error")}}async handleProfileUpdate(e){e.preventDefault();const t={firstName:document.getElementById("profile-firstname").value,lastName:document.getElementById("profile-lastname").value,phone:document.getElementById("profile-phone").value,address:{street:document.getElementById("profile-street").value,city:document.getElementById("profile-city").value,postalCode:document.getElementById("profile-postal").value}};try{this.uiManager.showLoading("profile-form");const r=await this.authService.updateProfile(t);r.success?(this.currentUser=r.data.user,this.storageManager.setUser(r.data.user),this.updateUIForAuthenticatedUser(),this.uiManager.showNotification("Profil mis √† jour avec succ√®s !","success")):this.uiManager.showNotification(r.message||"Erreur lors de la mise √† jour","error")}catch(r){console.error("Erreur lors de la mise √† jour du profil:",r),this.uiManager.showNotification("Erreur lors de la mise √† jour du profil","error")}finally{this.uiManager.hideLoading("profile-form")}}async handlePasswordChange(e){e.preventDefault();const t=e.target,r=t.querySelector('[id*="current-password"]').value,s=t.querySelector('[id*="new-password"]').value,o=t.querySelector('[id*="confirm-password"]').value;if(s!==o){this.uiManager.showNotification("Les mots de passe ne correspondent pas","error");return}try{this.uiManager.showLoading(t);const n=await this.authService.changePassword(r,s);n.success?(this.uiManager.showNotification("Mot de passe modifi√© avec succ√®s !","success"),t.reset()):this.uiManager.showNotification(n.message||"Erreur lors du changement de mot de passe","error")}catch(n){console.error("Erreur lors du changement de mot de passe:",n),this.uiManager.showNotification("Erreur lors du changement de mot de passe","error")}finally{this.uiManager.hideLoading(t)}}async handlePreferencesUpdate(e){e.preventDefault();const t={preferences:{language:document.getElementById("profile-language").value,currency:document.getElementById("profile-currency").value,notifications:{email:document.getElementById("email-notifications").checked,sms:document.getElementById("sms-notifications").checked}}};try{this.uiManager.showLoading("preferences-form");const r=await this.authService.updateProfile(t);r.success?(this.currentUser=r.data.user,this.storageManager.setUser(r.data.user),this.uiManager.showNotification("Pr√©f√©rences mises √† jour avec succ√®s !","success")):this.uiManager.showNotification(r.message||"Erreur lors de la mise √† jour","error")}catch(r){console.error("Erreur lors de la mise √† jour des pr√©f√©rences:",r),this.uiManager.showNotification("Erreur lors de la mise √† jour des pr√©f√©rences","error")}finally{this.uiManager.hideLoading("preferences-form")}}async showBookings(){try{this.uiManager.showModal("bookings-modal"),await this.loadUserBookings()}catch(e){console.error("Erreur lors de l'affichage des r√©servations:",e),this.uiManager.showNotification("Erreur lors du chargement des r√©servations","error")}}async loadUserBookings(){try{const e=document.getElementById("bookings-list");e.innerHTML=`
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Chargement des r√©servations...</p>
        </div>
      `;const t=await this.bookingService.getUserBookings();t.success?this.renderBookings(t.data.bookings):e.innerHTML=`
          <div class="no-results">
            <h3>Aucune r√©servation trouv√©e</h3>
            <p>Vous n'avez pas encore de r√©servations</p>
          </div>
        `}catch(e){console.error("Erreur lors du chargement des r√©servations:",e);const t=document.getElementById("bookings-list");t.innerHTML=`
        <div class="no-results">
          <h3>Erreur de chargement</h3>
          <p>Impossible de charger les r√©servations</p>
        </div>
      `}}renderBookings(e){const t=document.getElementById("bookings-list");if(e.length===0){t.innerHTML=`
        <div class="no-results">
          <h3>Aucune r√©servation</h3>
          <p>Vous n'avez pas encore de r√©servations</p>
        </div>
      `;return}t.innerHTML=e.map(r=>{var s,o,n;return`
      <div class="booking-card">
        <div class="booking-header">
          <span class="booking-number">#${r.bookingNumber}</span>
          <span class="booking-status status-${r.status}">${this.getStatusLabel(r.status)}</span>
        </div>
        <div class="booking-details">
          <div class="booking-detail">
            <span class="booking-detail-label">Bateau</span>
            <span class="booking-detail-value">${((s=r.boat)==null?void 0:s.name)||"N/A"}</span>
          </div>
          <div class="booking-detail">
            <span class="booking-detail-label">Dates</span>
            <span class="booking-detail-value">
              ${new Date(r.startDate).toLocaleDateString("fr-FR")} - 
              ${new Date(r.endDate).toLocaleDateString("fr-FR")}
            </span>
          </div>
          <div class="booking-detail">
            <span class="booking-detail-label">Montant</span>
            <span class="booking-detail-value">${((o=r.pricing)==null?void 0:o.totalAmount)||0}‚Ç¨</span>
          </div>
          <div class="booking-detail">
            <span class="booking-detail-label">Participants</span>
            <span class="booking-detail-value">${((n=r.participants)==null?void 0:n.total)||0} personnes</span>
          </div>
        </div>
        <div class="booking-actions">
          <button class="btn-secondary btn-small" onclick="app.viewBookingDetails('${r._id}')">
            Voir d√©tails
          </button>
          ${r.status==="pending"||r.status==="confirmed"?`
            <button class="btn-ghost btn-small" onclick="app.cancelBooking('${r._id}')">
              Annuler
            </button>
          `:""}
        </div>
      </div>
    `}).join("")}async showMyBoats(){try{this.uiManager.showModal("my-boats-modal"),await this.loadOwnerBoats()}catch(e){console.error("Erreur lors de l'affichage des bateaux:",e),this.uiManager.showNotification("Erreur lors du chargement des bateaux","error")}}async loadOwnerBoats(){try{const e=document.getElementById("my-boats-list");e.innerHTML=`
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Chargement de vos bateaux...</p>
        </div>
      `;const t=await this.boatService.getOwnerBoats();t.success?this.renderOwnerBoats(t.data.boats):e.innerHTML=`
          <div class="no-results">
            <h3>Aucun bateau trouv√©</h3>
            <p>Vous n'avez pas encore ajout√© de bateaux</p>
          </div>
        `}catch(e){console.error("Erreur lors du chargement des bateaux:",e);const t=document.getElementById("my-boats-list");t.innerHTML=`
        <div class="no-results">
          <h3>Erreur de chargement</h3>
          <p>Impossible de charger vos bateaux</p>
        </div>
      `}}renderOwnerBoats(e){const t=document.getElementById("my-boats-list");if(e.length===0){t.innerHTML=`
        <div class="no-results">
          <h3>Aucun bateau</h3>
          <p>Vous n'avez pas encore ajout√© de bateaux</p>
          <button class="btn-primary" onclick="app.uiManager.showModal('add-boat-modal')">
            Ajouter votre premier bateau
          </button>
        </div>
      `;return}t.innerHTML=e.map(r=>{var s,o,n,a,i,l,d;return`
      <div class="my-boat-card">
        <div class="my-boat-image">
          <img src="${r.mainImage||((o=(s=r.images)==null?void 0:s[0])==null?void 0:o.url)||"https://images.pexels.com/photos/1001682/pexels-photo-1001682.jpeg?auto=compress&cs=tinysrgb&w=400&h=300&fit=crop"}" alt="${r.name}">
          <div class="boat-status-badge status-${r.status}">${this.getBoatStatusLabel(r.status)}</div>
        </div>
        <div class="my-boat-content">
          <h3 class="my-boat-name">${r.name}</h3>
          <p class="my-boat-location">üìç ${((n=r.location)==null?void 0:n.city)||"N/A"}</p>
          <div class="my-boat-stats">
            <div class="boat-stat">
              <div class="boat-stat-value">${((a=r.pricing)==null?void 0:a.dailyRate)||0}‚Ç¨</div>
              <div class="boat-stat-label">Prix/jour</div>
            </div>
            <div class="boat-stat">
              <div class="boat-stat-value">${((i=r.stats)==null?void 0:i.totalBookings)||0}</div>
              <div class="boat-stat-label">R√©servations</div>
            </div>
            <div class="boat-stat">
              <div class="boat-stat-value">${((d=(l=r.rating)==null?void 0:l.average)==null?void 0:d.toFixed(1))||"0.0"}</div>
              <div class="boat-stat-label">Note</div>
            </div>
          </div>
          <div class="my-boat-actions">
            <button class="btn-primary btn-small" onclick="app.editBoat('${r._id}')">
              Modifier
            </button>
            <button class="btn-secondary btn-small" onclick="app.showBoatDetails('${r._id}')">
              Voir
            </button>
            <button class="btn-ghost btn-small" onclick="app.toggleBoatStatus('${r._id}')">
              ${r.status==="available"?"D√©sactiver":"Activer"}
            </button>
          </div>
        </div>
      </div>
    `}).join("")}switchTab(e){document.querySelectorAll(".tab-btn").forEach(t=>t.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active")),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.getElementById(e).classList.add("active")}getStatusLabel(e){return{pending:"En attente",confirmed:"Confirm√©e",paid:"Pay√©e",active:"En cours",completed:"Termin√©e",cancelled:"Annul√©e",refunded:"Rembours√©e"}[e]||e}getBoatStatusLabel(e){return{available:"Disponible",rented:"Lou√©",maintenance:"Maintenance",inactive:"Inactif"}[e]||e}async viewBookingDetails(e){this.uiManager.showNotification("Fonctionnalit√© en cours de d√©veloppement","info")}async cancelBooking(e){confirm("√ätes-vous s√ªr de vouloir annuler cette r√©servation ?")&&this.uiManager.showNotification("Fonctionnalit√© en cours de d√©veloppement","info")}async editBoat(e){this.uiManager.showNotification("Fonctionnalit√© en cours de d√©veloppement","info")}async toggleBoatStatus(e){this.uiManager.showNotification("Fonctionnalit√© en cours de d√©veloppement","info")}updateUIForAuthenticatedUser(){const e=document.getElementById("login-btn"),t=document.getElementById("register-btn"),r=document.getElementById("user-menu"),s=document.getElementById("user-name"),o=document.getElementById("user-email"),n=document.getElementById("user-initials"),a=document.getElementById("boats-link");e&&(e.style.display="none"),t&&(t.style.display="none"),r&&(r.style.display="block"),this.currentUser&&(s&&(s.textContent=`${this.currentUser.firstName} ${this.currentUser.lastName}`),o&&(o.textContent=this.currentUser.email),n&&(n.textContent=`${this.currentUser.firstName[0]}${this.currentUser.lastName[0]}`.toUpperCase()),a&&["owner","admin"].includes(this.currentUser.role)&&(a.style.display="block"))}updateUIForUnauthenticatedUser(){const e=document.getElementById("login-btn"),t=document.getElementById("register-btn"),r=document.getElementById("user-menu");e&&(e.style.display="block"),t&&(t.style.display="block"),r&&(r.style.display="none")}toggleUserMenu(){const e=document.getElementById("user-dropdown");e&&e.classList.toggle("active")}async loadBoats(e={},t=1){try{const r=document.getElementById("boats-grid"),s=document.getElementById("boats-loading");s&&(s.style.display="block");const o={page:t,limit:this.boatsPerPage,...e};console.log("üö§ Chargement des bateaux depuis:",this.boatService.boatsEndpoint),console.log("üìä Param√®tres:",o);const n=await this.boatService.getBoats(o);console.log("üì° R√©ponse API:",n),n.success?(this.renderBoats(n.data.boats),this.renderPagination(n.data.pagination),this.currentPage=t,this.currentFilters=e):(console.error("‚ùå Erreur API:",n),this.uiManager.showNotification(`Erreur API: ${n.message||"Donn√©es non disponibles"}`,"error"),this.renderBoats([]))}catch(r){console.error("Erreur lors du chargement des bateaux:",r),this.uiManager.showNotification(`Erreur de connexion: ${r.message}`,"error"),this.renderBoats([])}finally{const r=document.getElementById("boats-loading");r&&(r.style.display="none")}}renderBoats(e){const t=document.getElementById("boats-grid");if(t){if(t.innerHTML="",e.length===0){t.innerHTML=`
        <div class="no-results">
          <h3>Aucun bateau trouv√©</h3>
          <p>Essayez de modifier vos crit√®res de recherche</p>
        </div>
      `;return}e.forEach(r=>{const s=this.createBoatCard(r);t.appendChild(s)})}}createBoatCard(e){var o,n,a,i;const t=document.createElement("div");t.className="boat-card",t.setAttribute("data-boat-id",e._id);const r=e.mainImage||((n=(o=e.images)==null?void 0:o[0])==null?void 0:n.url)||"https://images.pexels.com/photos/1001682/pexels-photo-1001682.jpeg?auto=compress&cs=tinysrgb&w=400&h=300&fit=crop";return t.innerHTML=`
      <div class="boat-image">
        <img src="${r}" alt="${e.name}" loading="lazy">
        <div class="boat-badge">${this.formatBoatType(e.type)}</div>
        <div class="boat-rating">
          <span class="rating-stars">${this.renderStars(((a=e.rating)==null?void 0:a.average)||0)}</span>
          <span class="rating-count">(${((i=e.rating)==null?void 0:i.totalReviews)||0})</span>
        </div>
      </div>
      <div class="boat-content">
        <h3 class="boat-name">${e.name}</h3>
        <p class="boat-location">üìç ${e.location.city}, ${e.location.country}</p>
        <div class="boat-specs">
          <span class="spec">üë• ${e.capacity.maxPeople} pers.</span>
          <span class="spec">üìè ${e.specifications.length}m</span>
          ${e.capacity.cabins?`<span class="spec">üõèÔ∏è ${e.capacity.cabins} cabines</span>`:""}
        </div>
        <div class="boat-price">
          <span class="price">${e.pricing.dailyRate}‚Ç¨</span>
          <span class="price-unit">/jour</span>
        </div>
        <button class="btn-primary btn-full boat-details-btn">Voir les d√©tails</button>
      </div>
    `,t.querySelector(".boat-details-btn").addEventListener("click",()=>this.showBoatDetails(e._id)),t}formatBoatType(e){return{voilier:"Voilier",catamaran:"Catamaran",yacht:"Yacht",bateau_moteur:"Bateau √† moteur",semi_rigide:"Semi-rigide",peniche:"P√©niche"}[e]||e}renderStars(e){const t=Math.floor(e),r=e%1>=.5,s=5-t-(r?1:0);let o="";for(let n=0;n<t;n++)o+="‚≠ê";r&&(o+="‚≠ê");for(let n=0;n<s;n++)o+="‚òÜ";return o}async showBoatDetails(e){try{this.uiManager.showLoading("boat-modal");const t=await this.boatService.getBoatById(e);t.success?(this.renderBoatDetails(t.data.boat),this.uiManager.showModal("boat-modal")):this.uiManager.showNotification("Erreur lors du chargement des d√©tails","error")}catch(t){console.error("Erreur lors du chargement des d√©tails:",t),this.uiManager.showNotification("Erreur lors du chargement des d√©tails","error")}finally{this.uiManager.hideLoading("boat-modal")}}renderBoatDetails(e){var s,o,n,a,i,l,d;const t=document.getElementById("boat-modal-title"),r=document.getElementById("boat-details");t&&(t.textContent=e.name),r&&(r.innerHTML=`
        <div class="boat-details-content">
          <div class="boat-gallery">
            <div class="main-image">
              <img src="${e.mainImage||((o=(s=e.images)==null?void 0:s[0])==null?void 0:o.url)}" alt="${e.name}">
            </div>
            ${((n=e.images)==null?void 0:n.length)>1?`
              <div class="image-thumbnails">
                ${e.images.slice(1,5).map(u=>`
                  <img src="${u.url}" alt="${u.caption||e.name}" class="thumbnail">
                `).join("")}
              </div>
            `:""}
          </div>
          
          <div class="boat-info">
            <div class="boat-header">
              <div class="boat-meta">
                <span class="boat-type">${this.formatBoatType(e.type)}</span>
                <span class="boat-category">${e.category}</span>
              </div>
              <div class="boat-rating-large">
                ${this.renderStars(((a=e.rating)==null?void 0:a.average)||0)}
                <span class="rating-text">${((l=(i=e.rating)==null?void 0:i.average)==null?void 0:l.toFixed(1))||"0.0"} (${((d=e.rating)==null?void 0:d.totalReviews)||0} avis)</span>
              </div>
            </div>
            
            <p class="boat-description">${e.description}</p>
            
            <div class="boat-specs-grid">
              <div class="spec-item">
                <strong>Capacit√©:</strong> ${e.capacity.maxPeople} personnes
              </div>
              <div class="spec-item">
                <strong>Longueur:</strong> ${e.specifications.length}m
              </div>
              <div class="spec-item">
                <strong>Largeur:</strong> ${e.specifications.width}m
              </div>
              ${e.capacity.cabins?`
                <div class="spec-item">
                  <strong>Cabines:</strong> ${e.capacity.cabins}
                </div>
              `:""}
              ${e.capacity.berths?`
                <div class="spec-item">
                  <strong>Couchages:</strong> ${e.capacity.berths}
                </div>
              `:""}
              ${e.capacity.bathrooms?`
                <div class="spec-item">
                  <strong>Salles de bain:</strong> ${e.capacity.bathrooms}
                </div>
              `:""}
            </div>
            
            <div class="boat-location-info">
              <h3>Localisation</h3>
              <p>üìç ${e.location.marina}, ${e.location.city}, ${e.location.country}</p>
            </div>
            
            <div class="boat-pricing">
              <div class="price-main">
                <span class="price-amount">${e.pricing.dailyRate}‚Ç¨</span>
                <span class="price-unit">/jour</span>
              </div>
              ${e.pricing.weeklyRate?`
                <div class="price-secondary">
                  <span class="price-amount">${e.pricing.weeklyRate}‚Ç¨</span>
                  <span class="price-unit">/semaine</span>
                </div>
              `:""}
              <div class="price-details">
                <p>Caution: ${e.pricing.securityDeposit}‚Ç¨</p>
                ${e.pricing.cleaningFee>0?`<p>Frais de nettoyage: ${e.pricing.cleaningFee}‚Ç¨</p>`:""}
              </div>
            </div>
            
            <div class="boat-actions">
              ${this.currentUser?`
                <button class="btn-primary btn-large" onclick="app.initiateBooking('${e._id}')">
                  R√©server maintenant
                </button>
              `:`
                <button class="btn-primary btn-large" onclick="app.uiManager.showModal('login-modal')">
                  Connectez-vous pour r√©server
                </button>
              `}
            </div>
          </div>
        </div>
      `)}renderPagination(e){const t=document.getElementById("boats-pagination"),r=document.getElementById("page-numbers"),s=document.getElementById("prev-page"),o=document.getElementById("next-page");if(!t||!r)return;if(e.pages<=1){t.style.display="none";return}t.style.display="flex",s&&(s.disabled=e.page<=1),o&&(o.disabled=e.page>=e.pages),r.innerHTML="";const n=Math.max(1,e.page-2),a=Math.min(e.pages,e.page+2);for(let i=n;i<=a;i++){const l=document.createElement("button");l.className=`btn-page ${i===e.page?"active":""}`,l.textContent=i,l.addEventListener("click",()=>this.changePage(i)),r.appendChild(l)}}async changePage(e){if(e<1)return;await this.loadBoats(this.currentFilters,e);const t=document.getElementById("boats");t&&t.scrollIntoView({behavior:"smooth"})}async handleSearch(){const e=document.getElementById("search-location").value;document.getElementById("search-start-date").value,document.getElementById("search-end-date").value;const t=document.getElementById("search-guests").value,r={};e&&(r.search=e),t&&(r.minCapacity=t);const s=document.getElementById("boats");s&&s.scrollIntoView({behavior:"smooth"}),await this.loadBoats(r,1)}async applyFilters(){const e={},t=document.getElementById("filter-type").value,r=document.getElementById("filter-price").value,s=document.getElementById("filter-capacity").value;t&&(e.type=t),r&&(e.maxPrice=r),s&&(e.minCapacity=s),await this.loadBoats(e,1)}async handleContactForm(e){e.preventDefault();const t=document.getElementById("contact-name").value,r=document.getElementById("contact-email").value,s=document.getElementById("contact-message").value;try{this.uiManager.showLoading("contact-form");const o=await fetch(`${this.apiBaseUrl||""}/api/contact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:r,message:s})}),n=await o.json();if(!o.ok||!n.success)throw new Error(n.message||"√âchec de l'envoi du message");this.uiManager.showNotification("Message envoy√© avec succ√®s !","success"),document.getElementById("contact-form").reset()}catch(o){console.error("Erreur lors de l'envoi du message:",o),this.uiManager.showNotification("Erreur lors de l'envoi du message","error")}finally{this.uiManager.hideLoading("contact-form")}}setupNavigation(){const e=document.querySelectorAll("section[id]"),t=document.querySelectorAll(".nav-link");if(e.length>0&&window.location.pathname==="/"||window.location.pathname.endsWith("index.html")){const r=new IntersectionObserver(s=>{s.forEach(o=>{if(o.isIntersecting){const n=o.target.getAttribute("id");t.forEach(a=>{a.classList.remove("active"),a.getAttribute("href")===`#${n}`&&a.classList.add("active")})}})},{threshold:.3,rootMargin:"-100px 0px -100px 0px"});e.forEach(s=>r.observe(s))}}async initiateBooking(e){if(!this.currentUser){this.uiManager.showModal("login-modal");return}this.uiManager.showNotification("Fonctionnalit√© de r√©servation en cours de d√©veloppement","info")}}document.addEventListener("DOMContentLoaded",()=>{window.app=new E});
