import{A as m}from"./AuthService-BR8AMDic.js";/* empty css              */import{B as p,U as g}from"./main-Bxbxu5nv.js";import{g as h}from"./apiConfig-Hw5SgeDb.js";class y{constructor(){this.bookingService=new p,this.authService=new m,this.uiManager=new g,this.currentStep=1,this.totalSteps=4,this.boatData=null,this.bookingData={boatId:null,startDate:"",endDate:"",participants:{adults:0,children:0},emergencyContact:{name:"",phone:"",relationship:""},renterExperience:{hasLicense:!1,licenseType:"",yearsOfExperience:0,previousBoatTypes:"",additionalInfo:""},specialRequests:"",skipperRequested:!1,additionalServices:[]},this.init()}init(){this.loadBoatData(),this.setupEventListeners(),this.setupDateValidation(),this.updateSummary()}async loadBoatData(){try{const t=new URLSearchParams(window.location.search),e=t.get("boatId"),a=t.get("startDate"),n=t.get("endDate");if(!e)throw new Error("Aucun bateau spécifié");const s=await fetch(`${h()}/boats/${e}`);if(!s.ok)throw new Error("Bateau non trouvé");this.boatData=await s.json(),this.bookingData.boatId=e,a&&(this.bookingData.startDate=a,document.getElementById("start-date").value=a),n&&(this.bookingData.endDate=n,document.getElementById("end-date").value=n),this.displayBoatInfo(),this.updateSummary(),this.showContent()}catch(t){console.error("Erreur lors du chargement des données:",t),this.showError("Impossible de charger les informations du bateau")}}displayBoatInfo(){if(!this.boatData)return;document.getElementById("boat-name").textContent=this.boatData.name,document.getElementById("boat-name").textContent=this.boatData.name,document.getElementById("boat-location").textContent=`${this.boatData.location.city}, ${this.boatData.location.country}`,document.getElementById("boat-capacity").textContent=`${this.boatData.capacity.maxPeople} personnes`,document.getElementById("boat-type").textContent=this.boatData.type;const t=document.getElementById("boat-image");this.boatData.images&&this.boatData.images.length>0&&(t.src=this.boatData.images[0],t.style.display="block",document.querySelector(".boat-placeholder").style.display="none")}setupEventListeners(){document.getElementById("next-step").addEventListener("click",()=>this.nextStep()),document.getElementById("prev-step").addEventListener("click",()=>this.prevStep()),document.getElementById("booking-form").addEventListener("submit",t=>this.submitBooking(t)),this.setupFormListeners(),document.getElementById("skipper-requested").addEventListener("change",t=>{this.bookingData.skipperRequested=t.target.checked,this.updateSummary()}),document.getElementById("has-license").addEventListener("change",t=>{this.bookingData.renterExperience.hasLicense=t.target.checked;const e=document.getElementById("license-details");e.style.display=t.target.checked?"block":"none"}),document.querySelectorAll('input[name="additionalServices"]').forEach(t=>{t.addEventListener("change",()=>this.updateAdditionalServices())})}setupFormListeners(){document.getElementById("start-date").addEventListener("change",t=>{this.bookingData.startDate=t.target.value,this.updateSummary(),this.validateStep(1)}),document.getElementById("end-date").addEventListener("change",t=>{this.bookingData.endDate=t.target.value,this.updateSummary(),this.validateStep(1)}),document.getElementById("adults").addEventListener("change",t=>{this.bookingData.participants.adults=parseInt(t.target.value),this.updateSummary(),this.validateStep(1)}),document.getElementById("children").addEventListener("change",t=>{this.bookingData.participants.children=parseInt(t.target.value),this.updateSummary()}),document.getElementById("emergency-name").addEventListener("input",t=>{this.bookingData.emergencyContact.name=t.target.value,this.validateStep(2)}),document.getElementById("emergency-phone").addEventListener("input",t=>{this.bookingData.emergencyContact.phone=t.target.value,this.validateStep(2)}),document.getElementById("emergency-relationship").addEventListener("change",t=>{this.bookingData.emergencyContact.relationship=t.target.value,this.validateStep(2)}),document.getElementById("license-type").addEventListener("change",t=>{this.bookingData.renterExperience.licenseType=t.target.value}),document.getElementById("experience-years").addEventListener("change",t=>{this.bookingData.renterExperience.yearsOfExperience=parseInt(t.target.value)}),document.getElementById("previous-boats").addEventListener("input",t=>{this.bookingData.renterExperience.previousBoatTypes=t.target.value}),document.getElementById("additional-info").addEventListener("input",t=>{this.bookingData.renterExperience.additionalInfo=t.target.value}),document.getElementById("special-requests").addEventListener("input",t=>{this.bookingData.specialRequests=t.target.value})}setupDateValidation(){const t=document.getElementById("start-date"),e=document.getElementById("end-date"),a=new Date().toISOString().split("T")[0];t.min=a,e.min=a,t.addEventListener("change",function(){e.min=this.value,e.value&&e.value<=this.value&&(e.value="")})}nextStep(){this.validateCurrentStep()&&this.currentStep<this.totalSteps&&(this.currentStep++,this.updateStepDisplay())}prevStep(){this.currentStep>1&&(this.currentStep--,this.updateStepDisplay())}updateStepDisplay(){document.querySelectorAll(".form-step").forEach(n=>{n.classList.remove("active")}),document.getElementById(`step-${this.currentStep}`).classList.add("active");const t=document.getElementById("prev-step"),e=document.getElementById("next-step"),a=document.getElementById("submit-booking");t.style.display=this.currentStep>1?"block":"none",this.currentStep===this.totalSteps?(e.style.display="none",a.style.display="block"):(e.style.display="block",a.style.display="none"),this.validateStep(this.currentStep)}validateCurrentStep(){return this.validateStep(this.currentStep)}validateStep(t){let e=!0;const a=document.getElementById("next-step"),n=document.getElementById("submit-booking");switch(t){case 1:e=this.bookingData.startDate&&this.bookingData.endDate&&this.bookingData.participants.adults>0;break;case 2:e=this.bookingData.emergencyContact.name&&this.bookingData.emergencyContact.phone&&this.bookingData.emergencyContact.relationship;break;case 3:e=!0;break;case 4:e=!0;break}return t===this.currentStep&&(a.disabled=!e,n.disabled=!e),e}updateAdditionalServices(){const t=document.querySelectorAll('input[name="additionalServices"]:checked');this.bookingData.additionalServices=Array.from(t).map(e=>({name:e.value,price:parseFloat(e.dataset.price)})),this.updateSummary()}updateSummary(){if(this.boatData){if(document.getElementById("summary-start-date").textContent=this.bookingData.startDate?this.formatDate(this.bookingData.startDate):"-",document.getElementById("summary-end-date").textContent=this.bookingData.endDate?this.formatDate(this.bookingData.endDate):"-",this.bookingData.startDate&&this.bookingData.endDate){const t=this.calculateDays();document.getElementById("summary-duration").textContent=`${t} jour${t>1?"s":""}`}else document.getElementById("summary-duration").textContent="-";document.getElementById("summary-adults").textContent=this.bookingData.participants.adults>0?`${this.bookingData.participants.adults} adulte${this.bookingData.participants.adults>1?"s":""}`:"-",document.getElementById("summary-children").textContent=this.bookingData.participants.children>0?`${this.bookingData.participants.children} enfant${this.bookingData.participants.children>1?"s":""}`:"-",this.updatePricing()}}updatePricing(){if(!this.boatData||!this.bookingData.startDate||!this.bookingData.endDate)return;const t=this.calculateDays(),e=this.boatData.pricing.dailyRate,a=t*e;document.getElementById("daily-rate").textContent=e,document.getElementById("days-count").textContent=t,document.getElementById("subtotal-price").textContent=`${a}€`;const n=document.getElementById("skipper-price-item"),s=document.getElementById("skipper-days"),d=document.getElementById("skipper-total");if(this.bookingData.skipperRequested){const i=t*150;s.textContent=t,d.textContent=`${i}€`,n.style.display="flex"}else n.style.display="none";const r=document.getElementById("services-price-item"),c=document.getElementById("services-total");if(this.bookingData.additionalServices.length>0){const i=this.bookingData.additionalServices.reduce((o,u)=>o+u.price,0);c.textContent=`${i}€`,r.style.display="flex"}else r.style.display="none";document.getElementById("cleaning-fee").textContent=`${this.boatData.pricing.cleaningFee||0}€`,document.getElementById("security-deposit").textContent=`${this.boatData.pricing.securityDeposit||0}€`;const l=a+(this.bookingData.skipperRequested?t*150:0)+this.bookingData.additionalServices.reduce((i,o)=>i+o.price,0)+(this.boatData.pricing.cleaningFee||0);document.getElementById("total-price").textContent=`${l}€`}calculateDays(){if(!this.bookingData.startDate||!this.bookingData.endDate)return 0;const t=new Date(this.bookingData.startDate),e=new Date(this.bookingData.endDate);return Math.ceil((e-t)/(1e3*60*60*24))}formatDate(t){return new Date(t).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}async submitBooking(t){if(t.preventDefault(),!this.authService.isAuthenticated()){this.uiManager.showNotification("Vous devez être connecté pour effectuer une réservation","error"),this.uiManager.showModal("login-modal");return}if(!this.validateAllSteps()){this.uiManager.showNotification("Veuillez compléter tous les champs obligatoires","error");return}try{this.uiManager.showLoading("submit-booking");const e={boatId:this.bookingData.boatId,startDate:this.bookingData.startDate,endDate:this.bookingData.endDate,participants:this.bookingData.participants,emergencyContact:this.bookingData.emergencyContact,renterExperience:this.bookingData.renterExperience,specialRequests:this.bookingData.specialRequests,skipperRequested:this.bookingData.skipperRequested,additionalServices:this.bookingData.additionalServices},a=await this.bookingService.createBooking(e);if(a.success)this.uiManager.showNotification("Réservation créée avec succès !","success"),setTimeout(()=>{window.location.href=`booking-confirmation.html?id=${a.data.booking._id}`},2e3);else throw new Error(a.message||"Erreur lors de la création de la réservation")}catch(e){console.error("Erreur lors de la réservation:",e),this.uiManager.showNotification(e.message||"Erreur lors de la création de la réservation","error")}finally{this.uiManager.hideLoading("submit-booking")}}validateAllSteps(){for(let t=1;t<=this.totalSteps;t++)if(!this.validateStep(t))return!1;return!0}showContent(){document.getElementById("loading").style.display="none",document.getElementById("booking-content").style.display="block"}showError(t){document.getElementById("loading").style.display="none",document.getElementById("error-message").textContent=t,document.getElementById("error").style.display="block"}}document.addEventListener("DOMContentLoaded",()=>{new y});
