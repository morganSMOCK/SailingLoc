import"./AuthService-DvEDo84p.js";/* empty css              */import"./init-CUDXmtww.js";import{g as l}from"./apiConfig-Hw5SgeDb.js";const E=new URLSearchParams(window.location.search),u=E.get("session_id"),m=E.get("booking_id");let o=null,n=null;const t={bookingNumber:document.getElementById("booking-number"),boatImage:document.getElementById("boat-image"),noImage:document.getElementById("no-image"),boatName:document.getElementById("boat-name"),boatType:document.getElementById("boat-type"),boatLocation:document.getElementById("boat-location"),startDate:document.getElementById("start-date"),endDate:document.getElementById("end-date"),passengers:document.getElementById("passengers"),duration:document.getElementById("duration"),dailyRate:document.getElementById("daily-rate"),daysCount:document.getElementById("days-count"),subtotal:document.getElementById("subtotal"),serviceFee:document.getElementById("service-fee"),totalPrice:document.getElementById("total-price"),errorMessage:document.getElementById("error-message")};document.addEventListener("DOMContentLoaded",async()=>{try{await w()}catch(e){console.error("❌ Erreur lors de l'initialisation:",e),i("Une erreur est survenue lors du chargement de la page.")}});async function w(){if(!u&&!m){i("Paramètres de confirmation manquants. Veuillez vérifier votre lien.");return}await $(),C(),B()}async function $(){try{let e;if(u?e=await fetch(`${l()}/payments/verify-session/${u}`):m&&(e=await fetch(`${l()}/bookings/${m}`)),!e.ok)throw new Error(`Erreur HTTP: ${e.status}`);const a=await e.json();o=a.data.booking||a.data,await h(o.boatId),console.log("✅ Données de la réservation chargées:",o)}catch(e){throw console.error("❌ Erreur lors du chargement de la réservation:",e),e}}async function h(e){try{const a=await fetch(`${l()}/boats/${e}`);if(!a.ok)throw new Error(`Erreur HTTP: ${a.status}`);n=(await a.json()).data.boat,console.log("✅ Données du bateau chargées:",n)}catch(a){throw console.error("❌ Erreur lors du chargement du bateau:",a),a}}function B(){const e=document.getElementById("breadcrumb-boat-name");e&&n&&(e.textContent=n.name||"Bateau")}function C(){var b;if(t.bookingNumber.textContent=o.bookingNumber||`#${(b=o._id)==null?void 0:b.slice(-8).toUpperCase()}`,n.images&&n.images.length>0){const d=n.images.find(I=>I.isMain)||n.images[0];d&&d.url&&(t.boatImage.src=`https://sailingloc.onrender.com${d.url}`,t.boatImage.style.display="block",t.noImage.style.display="none")}t.boatName.textContent=n.name,t.boatType.textContent=`${n.type} • ${n.category}`,t.boatLocation.textContent=`${n.location.city}, ${n.location.marina}, ${n.location.country} • ${n.capacity.maxPeople} pers.`,t.startDate.textContent=p(o.startDate),t.endDate.textContent=p(o.endDate),t.passengers.textContent=o.passengers||o.guests;const e=new Date(o.startDate),a=new Date(o.endDate),r=Math.ceil((a-e)/(1e3*60*60*24));t.duration.textContent=`${r} jour${r>1?"s":""}`;const g=o.dailyRate||n.pricing.dailyRate,c=o.subtotal||r*g,y=o.serviceFee||Math.round(c*.05),f=o.total||c+y,s=o.currency||n.pricing.currency||"EUR";t.dailyRate.textContent=`${g} ${s}`,t.daysCount.textContent=r,t.subtotal.textContent=`${c} ${s}`,t.serviceFee.textContent=`${y} ${s}`,t.totalPrice.textContent=`${f} ${s}`}function i(e){t.errorMessage.textContent=e,t.errorMessage.style.display="flex"}function p(e){return new Date(e).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}window.addEventListener("error",e=>{console.error("❌ Erreur globale:",e.error),i("Une erreur inattendue est survenue.")});window.addEventListener("unhandledrejection",e=>{console.error("❌ Promesse rejetée:",e.reason),i("Une erreur est survenue lors du traitement.")});
