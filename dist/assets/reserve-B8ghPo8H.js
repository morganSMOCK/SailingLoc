import"./AuthService-BR8AMDic.js";/* empty css              */import"./init-CvdFLqyy.js";import{g as U}from"./apiConfig-Hw5SgeDb.js";const M=U(),A=new URLSearchParams(location.search),v=A.get("id");window.getBoatImageByType=window.getBoatImageByType||function(t,e){console.log("🔍 getBoatImageByType appelée avec:",{type:t,category:e});const n={voilier:"https://images.unsplash.com/photo-1508599589920-14cfa1c1fe4d?q=80&w=1200&auto=format&fit=crop",catamaran:"https://images.unsplash.com/photo-1544551763-46a013bb70d5?q=80&w=1200&auto=format&fit=crop",yacht:"https://images.unsplash.com/photo-1544551763-46a013bb70d5?q=80&w=1200&auto=format&fit=crop",bateau:"https://images.unsplash.com/photo-1508599589920-14cfa1c1fe4d?q=80&w=1200&auto=format&fit=crop"};if(e==="luxe")return console.log("✅ Catégorie luxe détectée, utilisation image premium"),"https://images.unsplash.com/photo-1544551763-46a013bb70d5?q=80&w=1200&auto=format&fit=crop";const o=n[t]||n.bateau;return console.log("✅ Image sélectionnée:",o),o};let c=null,E=new Set,l=null,u=null,C=new Date;q().catch(t=>{console.error(t),w()});async function q(){if(!v)return w();const t=await fetch(`${M}/boats/${encodeURIComponent(v)}`,{credentials:"include",cache:"no-store"});if(!t.ok)return w();const e=await t.json();if(e.success&&e.data&&e.data.boat?c=e.data.boat:e.data?c=e.data.boat||e.data:c=e,!c||!c._id)return w();P(c);const n=new Date;await x(n.getFullYear(),n.getMonth()+1),V(),h()}function F(t){if(Array.isArray(t==null?void 0:t.images)&&t.images.length>0){const e=t.images.find(o=>o==null?void 0:o.isMain);if(e&&e.url)return`https://sailingloc.onrender.com${e.url}`;const n=t.images[0];if(n&&n.url)return`https://sailingloc.onrender.com${n.url}`}if(Array.isArray(t==null?void 0:t.imageUrls)&&t.imageUrls.length>0){const e=t.imageUrls[0];return e.fullUrl?e.fullUrl.replace("http://localhost:3000","https://sailingloc.onrender.com"):e.url?`https://sailingloc.onrender.com${e.url}`:`https://sailingloc.onrender.com${e}`}return console.log("⚠️ Aucune image trouvée, utilisation image par défaut"),window.getBoatImageByType(t.type,t.category)}function P(t){var m,I,L,B,R;document.title=`Réserver ${t.name||"Bateau"} — SailingLoc`;const e=document.getElementById("breadcrumb-boat-name");e&&(e.textContent=t.name||"Bateau"),console.log("🔍 [RESERVE] Données du bateau reçues:",t),console.log("🔍 [RESERVE] boat.coverImageUrl:",t.coverImageUrl),console.log("🔍 [RESERVE] boat.images:",t.images),console.log("🔍 [RESERVE] boat.imageUrls:",t.imageUrls);const n=F(t),o=document.getElementById("boat-image");if(n)console.log("✅ Image de couverture trouvée:",n),o.src=n,o.alt=t.name||"Bateau",o.style.display="block";else{console.log("⚠️ Aucune image de couverture trouvée"),o.style.display="none";const y=document.querySelector(".summary-card"),g=document.createElement("div");g.className="notice error",g.textContent="Image principale manquante pour cette annonce.",g.style.marginBottom="10px",y.insertBefore(g,y.firstChild)}a("#boat-name").textContent=t.name||"Bateau",a("#boat-type").textContent=t.type||"",a("#boat-category").textContent=t.category||"",a("#boat-port").textContent=[(m=t==null?void 0:t.location)==null?void 0:m.marina,(I=t==null?void 0:t.location)==null?void 0:I.city,(L=t==null?void 0:t.location)==null?void 0:L.country].filter(Boolean).join(", ")||"—";const s=((B=t==null?void 0:t.capacity)==null?void 0:B.maxPeople)||(t==null?void 0:t.capacity)||1;a("#boat-capacity").textContent=`${s} pers.`;const d=a("#guests");d.innerHTML=Array.from({length:s},(y,g)=>`<option value="${g+1}">${g+1}</option>`).join("");const p=((R=t==null?void 0:t.pricing)==null?void 0:R.dailyRate)||0;a("#rate").textContent=p,a("#sidebar-rate").textContent=`${p}€`;const r=(t==null?void 0:t.specifications)||{},i=a("#summary-specs");i.innerHTML="",[r.length?`Longueur : ${r.length} m`:null,r.width?`Largeur : ${r.width} m`:null,r.fuelType?`Motorisation : ${r.fuelType}`:null,t!=null&&t.status?`Statut : ${t.status}`:null].filter(Boolean).forEach(y=>{const g=document.createElement("li");g.textContent=y,i.appendChild(g)})}async function x(t,e){const n=`${t}-${String(e).padStart(2,"0")}`;a("#calendar-title").textContent=new Date(`${n}-01T00:00:00`).toLocaleString("fr-FR",{month:"long",year:"numeric"});let o=[];try{const s=await fetch(`${M}/boats/${encodeURIComponent(v)}/availability?month=${n}`,{cache:"no-store"});if(s.ok){const d=await s.json();Array.isArray(d.unavailable)&&(o=d.unavailable)}else console.warn("availability request failed",s.status)}catch(s){console.warn("availability fetch error",s)}E=new Set(o),j(t,e,E),C=new Date(`${n}-01T00:00:00`)}function j(t,e,n){const o=a("#calendar");o.innerHTML="";const d=(new Date(t,e-1,1).getDay()+6)%7,p=new Date(t,e,0).getDate();for(let r=0;r<d;r++){const i=document.createElement("button");i.type="button",i.className="cal-cell empty",i.tabIndex=-1,i.disabled=!0,o.appendChild(i)}for(let r=1;r<=p;r++){const i=H(t,e,r),f=n.has(i),m=document.createElement("button");m.type="button",m.className=`cal-cell${f?" disabled":""}`,m.textContent=r,f?(m.disabled=!0,m.tabIndex=-1):(m.dataset.date=i,m.addEventListener("click",()=>N(i))),o.appendChild(m)}$()}function N(t){!l||l&&u?(l=t,u=null):(t<l?(u=l,l=t):u=t,k(l,u)?T():(S("Cette plage de dates contient des jours indisponibles."),l=u=null)),D(),$(),h()}function k(t,e){if(!t||!e)return!0;const n=new Date(`${t}T00:00:00`),o=new Date(`${e}T00:00:00`);for(let s=new Date(n);s<=o;s.setDate(s.getDate()+1)){const d=s.toISOString().slice(0,10);if(E.has(d))return!1}return!0}function $(){document.querySelectorAll(".cal-cell").forEach(t=>{var n;t.classList.remove("selected","between","start","end");const e=(n=t.dataset)==null?void 0:n.date;e&&(l&&e===l&&t.classList.add("selected","start"),u&&e===u&&t.classList.add("selected","end"),l&&u&&e>l&&e<u&&t.classList.add("between"))})}function D(){const t=a("#start-date"),e=a("#end-date");t.value=l||"",e.value=u||"",e.min=l||""}function h(){var r,i;const t=a("#start-date").value,e=a("#end-date").value,n=parseInt(a("#guests").value||"1",10),o=((r=c==null?void 0:c.capacity)==null?void 0:r.maxPeople)||(c==null?void 0:c.capacity)||1,s=((i=c==null?void 0:c.pricing)==null?void 0:i.dailyRate)||0;let d=0;if(t&&e){const f=new Date(`${t}T00:00:00`),m=new Date(`${e}T00:00:00`);d=Math.max(0,Math.round((m-f)/864e5))}a("#nights").textContent=d,a("#rate").textContent=s,a("#sidebar-rate").textContent=`${s}€`,a("#total").textContent=(d*s).toLocaleString("fr-FR")+" €";const p=d>0&&n>=1&&n<=o&&k(t,e);a("#checkout-btn").disabled=!p}function V(){a("#start-date").addEventListener("change",t=>{l=t.target.value||null,u&&u<l&&(u=null),D(),$(),h()}),a("#end-date").addEventListener("change",t=>{u=t.target.value||null,D(),$(),h()}),a("#guests").addEventListener("change",h),a("#prev-month").addEventListener("click",async()=>{const t=new Date(C);t.setMonth(t.getMonth()-1),await x(t.getFullYear(),t.getMonth()+1)}),a("#next-month").addEventListener("click",async()=>{const t=new Date(C);t.setMonth(t.getMonth()+1),await x(t.getFullYear(),t.getMonth()+1)}),a("#checkout-btn").addEventListener("click",Y)}async function Y(){T();const t={boatId:v,startDate:a("#start-date").value,endDate:a("#end-date").value,passengers:parseInt(a("#guests").value,10)};if(!(!t.startDate||!t.endDate))try{if(t.passengers<1||t.passengers>c.capacity.maxPeople)return S(`Le nombre de passagers doit être entre 1 et ${c.capacity.maxPeople}.`);const e=new URLSearchParams({boatId:t.boatId,startDate:t.startDate,endDate:t.endDate,passengers:t.passengers});window.location.href=`/payment-summary.html?${e.toString()}`}catch(e){console.error(e),S("Erreur pendant la création du paiement.")}}function w(){const t=document.querySelector(".booking-grid");t&&(t.style.display="none");const e=a("#not-found");e&&(e.style.display="block")}function S(t){const e=a("#form-error");e.textContent=t,e.style.display="block"}function T(){const t=a("#form-error");t.textContent="",t.style.display="none"}function a(t){return document.querySelector(t)}function H(t,e,n){return`${t}-${String(e).padStart(2,"0")}-${String(n).padStart(2,"0")}`}
