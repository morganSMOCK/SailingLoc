import"./AuthService-hkblqokD.js";/* empty css              */import"./init-D7pXTd_4.js";const p=new URLSearchParams(window.location.search),l=p.get("session_id"),u=p.get("booking_id");let o=null,n=null;const t={bookingNumber:document.getElementById("booking-number"),boatImage:document.getElementById("boat-image"),noImage:document.getElementById("no-image"),boatName:document.getElementById("boat-name"),boatType:document.getElementById("boat-type"),boatLocation:document.getElementById("boat-location"),startDate:document.getElementById("start-date"),endDate:document.getElementById("end-date"),passengers:document.getElementById("passengers"),duration:document.getElementById("duration"),dailyRate:document.getElementById("daily-rate"),daysCount:document.getElementById("days-count"),subtotal:document.getElementById("subtotal"),serviceFee:document.getElementById("service-fee"),totalPrice:document.getElementById("total-price"),errorMessage:document.getElementById("error-message")};document.addEventListener("DOMContentLoaded",async()=>{try{await I()}catch(e){console.error("❌ Erreur lors de l'initialisation:",e),i("Une erreur est survenue lors du chargement de la page.")}});async function I(){if(!l&&!u){i("Paramètres de confirmation manquants. Veuillez vérifier votre lien.");return}await w(),$(),B()}async function w(){try{let e;if(l?e=await fetch(`/api/payments/verify-session/${l}`):u&&(e=await fetch(`/api/bookings/${u}`)),!e.ok)throw new Error(`Erreur HTTP: ${e.status}`);const a=await e.json();o=a.data.booking||a.data,await h(o.boatId),console.log("✅ Données de la réservation chargées:",o)}catch(e){throw console.error("❌ Erreur lors du chargement de la réservation:",e),e}}async function h(e){try{const a=await fetch(`/api/boats/${e}`);if(!a.ok)throw new Error(`Erreur HTTP: ${a.status}`);n=(await a.json()).data.boat,console.log("✅ Données du bateau chargées:",n)}catch(a){throw console.error("❌ Erreur lors du chargement du bateau:",a),a}}function B(){const e=document.getElementById("breadcrumb-boat-name");e&&n&&(e.textContent=n.name||"Bateau")}function $(){var y;if(t.bookingNumber.textContent=o.bookingNumber||`#${(y=o._id)==null?void 0:y.slice(-8).toUpperCase()}`,n.images&&n.images.length>0){const d=n.images.find(f=>f.isMain)||n.images[0];d&&d.url&&(t.boatImage.src=`https://sailingloc.onrender.com${d.url}`,t.boatImage.style.display="block",t.noImage.style.display="none")}t.boatName.textContent=n.name,t.boatType.textContent=`${n.type} • ${n.category}`,t.boatLocation.textContent=`${n.location.city}, ${n.location.marina}, ${n.location.country} • ${n.capacity.maxPeople} pers.`,t.startDate.textContent=b(o.startDate),t.endDate.textContent=b(o.endDate),t.passengers.textContent=o.passengers||o.guests;const e=new Date(o.startDate),a=new Date(o.endDate),r=Math.ceil((a-e)/(1e3*60*60*24));t.duration.textContent=`${r} jour${r>1?"s":""}`;const m=o.dailyRate||n.pricing.dailyRate,c=o.subtotal||r*m,g=o.serviceFee||Math.round(c*.05),E=o.total||c+g,s=o.currency||n.pricing.currency||"EUR";t.dailyRate.textContent=`${m} ${s}`,t.daysCount.textContent=r,t.subtotal.textContent=`${c} ${s}`,t.serviceFee.textContent=`${g} ${s}`,t.totalPrice.textContent=`${E} ${s}`}function i(e){t.errorMessage.textContent=e,t.errorMessage.style.display="flex"}function b(e){return new Date(e).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}window.addEventListener("error",e=>{console.error("❌ Erreur globale:",e.error),i("Une erreur inattendue est survenue.")});window.addEventListener("unhandledrejection",e=>{console.error("❌ Promesse rejetée:",e.reason),i("Une erreur est survenue lors du traitement.")});
