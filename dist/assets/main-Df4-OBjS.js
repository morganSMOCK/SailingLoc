/* empty css              */(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();class g{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.authEndpoint=`${this.baseURL}/auth`}async register(e){try{const t=await fetch(`${this.authEndpoint}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log("📡 Réponse HTTP:",{status:t.status,statusText:t.statusText,ok:t.ok,url:t.url});let r;try{r=await t.json(),console.log("📊 Données JSON reçues:",r)}catch(a){console.error("❌ Erreur parsing JSON:",a);const o=await t.text();throw console.log("📄 Réponse texte:",o),new Error(`Réponse invalide du serveur: ${t.status}`)}if(!t.ok)throw console.error("❌ Réponse HTTP non-OK:",t.status,r),new Error(r.message||"Erreur lors de l'inscription");return r}catch(t){throw console.error("❌ Erreur AuthService.register:",t),t}}async login(e,t){try{const r=`${this.authEndpoint}/login`;console.log("🔐 AuthService.login appelé"),console.log("📍 URL:",r),console.log("📊 Données:",{email:e,password:t?"***":"vide"});const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});console.log("📡 Réponse HTTP:",{status:a.status,statusText:a.statusText,ok:a.ok,url:a.url});let o;try{o=await a.json(),console.log("📊 Données JSON reçues:",o)}catch(s){console.error("❌ Erreur parsing JSON:",s);const n=await a.text();throw console.log("📄 Réponse texte:",n),new Error(`Réponse invalide du serveur: ${a.status}`)}if(!a.ok)throw console.error("❌ Réponse HTTP non-OK:",a.status,o),new Error(o.message||"Erreur lors de la connexion");return o}catch(r){throw console.error("❌ Erreur AuthService.login:",r),r}}async logout(){try{const e=this.getAuthToken(),t=`${this.authEndpoint}/logout`;console.log("🚪 AuthService.logout appelé"),console.log("📍 URL:",t);const r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}}});let a;try{a=await r.json()}catch{a={success:r.ok}}if(!r.ok)throw new Error(a.message||"Erreur lors de la déconnexion");return this.clearAuthData(),a}catch(e){throw console.error("Erreur lors de la déconnexion:",e),this.clearAuthData(),e}}async getProfile(){try{const e=this.getAuthToken();if(!e)throw new Error("Token d'authentification manquant");const t=await fetch(`${this.authEndpoint}/profile`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la récupération du profil");return r}catch(e){throw console.error("Erreur lors de la récupération du profil:",e),e}}async updateProfile(e){try{const t=this.getAuthToken();if(!t)throw new Error("Token d'authentification manquant");const r=await fetch(`${this.authEndpoint}/profile`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await r.json();if(!r.ok)throw new Error(a.message||"Erreur lors de la mise à jour du profil");return a}catch(t){throw console.error("Erreur lors de la mise à jour du profil:",t),t}}async changePassword(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Token d'authentification manquant");const a=await fetch(`${this.authEndpoint}/change-password`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})}),o=await a.json();if(!a.ok)throw new Error(o.message||"Erreur lors du changement de mot de passe");return o}catch(r){throw console.error("Erreur lors du changement de mot de passe:",r),r}}async verifyToken(){try{const e=this.getAuthToken();if(!e)throw new Error("Aucun token trouvé");const t=await fetch(`${this.authEndpoint}/verify-token`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Token invalide");return r}catch(e){throw console.error("Erreur lors de la vérification du token:",e),e}}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la récupération du token:",e),null}}isAuthenticated(){const e=this.getAuthToken();if(!e)return!1;try{const t=JSON.parse(atob(e.split(".")[1])),r=Date.now()/1e3;return t.exp>r}catch(t){return console.error("Token invalide:",t),!1}}getCurrentUser(){try{const e=localStorage.getItem("sailingloc_user");return e?JSON.parse(e):null}catch(e){return console.error("Erreur lors de la récupération des données utilisateur:",e),null}}clearAuthData(){try{localStorage.removeItem("sailingloc_token"),localStorage.removeItem("sailingloc_user")}catch(e){console.error("Erreur lors du nettoyage des données d'authentification:",e)}}handleAuthError(e){return(e.message.includes("Token")||e.message.includes("401"))&&this.clearAuthData(),{success:!1,message:e.message||"Erreur d'authentification",error:e}}async refreshToken(){try{const e=this.getAuthToken();if(!e)throw new Error("Aucun token à rafraîchir");const t=await fetch(`${this.authEndpoint}/refresh-token`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors du rafraîchissement du token");return r.data&&r.data.token&&localStorage.setItem("sailingloc_token",r.data.token),r}catch(e){throw console.error("Erreur lors du rafraîchissement du token:",e),this.clearAuthData(),e}}async authenticatedFetch(e,t={}){const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const a={...t,headers:{...t.headers,Authorization:`Bearer ${r}`,"Content-Type":"application/json"}};try{const o=await fetch(e,a);if(o.status===401)try{await this.refreshToken();const s=this.getAuthToken();return a.headers.Authorization=`Bearer ${s}`,await fetch(e,a)}catch{throw this.clearAuthData(),new Error("Session expirée, veuillez vous reconnecter")}return o}catch(o){throw console.error("Erreur lors de la requête authentifiée:",o),o}}}class f{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.boatsEndpoint=`${this.baseURL}/boats`}async getBoats(e={}){try{const t=new URLSearchParams;Object.keys(e).forEach(s=>{e[s]!==void 0&&e[s]!==""&&t.append(s,e[s])});const r=`${this.boatsEndpoint}?${t.toString()}`,a=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}}),o=await a.json();if(!a.ok)throw new Error(o.message||"Erreur lors de la récupération des bateaux");return o}catch(t){throw console.error("Erreur lors de la récupération des bateaux:",t),t}}async getBoatById(e){try{const t=await fetch(`${this.boatsEndpoint}/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la récupération du bateau");return r}catch(t){throw console.error("Erreur lors de la récupération du bateau:",t),t}}async createBoat(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(this.boatsEndpoint,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:e}),a=await r.json();if(!r.ok)throw new Error(a.message||"Erreur lors de la création du bateau");return a}catch(t){throw console.error("Erreur lors de la création du bateau:",t),t}}async updateBoat(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const a=await fetch(`${this.boatsEndpoint}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(t)}),o=await a.json();if(!a.ok)throw new Error(o.message||"Erreur lors de la mise à jour du bateau");return o}catch(r){throw console.error("Erreur lors de la mise à jour du bateau:",r),r}}async getOwnerBoats(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams(e),a=`${this.boatsEndpoint}/owner/my-boats?${r.toString()}`,o=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la récupération des bateaux");return s}catch(t){throw console.error("Erreur lors de la récupération des bateaux du propriétaire:",t),t}}async checkAvailability(e,t,r){try{const a=new URLSearchParams({startDate:t,endDate:r}),o=await fetch(`${this.boatsEndpoint}/${e}/availability?${a.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la vérification de disponibilité");return s}catch(a){throw console.error("Erreur lors de la vérification de disponibilité:",a),a}}async searchNearby(e,t,r=5e4){try{const a=new URLSearchParams({latitude:e.toString(),longitude:t.toString(),maxDistance:r.toString()}),o=await fetch(`${this.boatsEndpoint}/search/nearby?${a.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la recherche par proximité");return s}catch(a){throw console.error("Erreur lors de la recherche par proximité:",a),a}}async getOwnerBoats(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams;Object.keys(e).forEach(n=>{e[n]!==void 0&&e[n]!==""&&r.append(n,e[n])});const a=`${this.boatsEndpoint}/owner/my-boats?${r.toString()}`,o=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la récupération des bateaux du propriétaire");return s}catch(t){throw console.error("Erreur lors de la récupération des bateaux du propriétaire:",t),t}}async getBoatStats(){try{const e=this.getAuthToken();if(!e)throw new Error("Authentification requise");const t=await fetch(`${this.boatsEndpoint}/stats/overview`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la récupération des statistiques");return r}catch(e){throw console.error("Erreur lors de la récupération des statistiques:",e),e}}async uploadBoatImages(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const a=new FormData;Array.from(t).forEach((n,i)=>{a.append("images",n)});const o=await fetch(`${this.boatsEndpoint}/${e}/images`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:a}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de l'upload des images");return s}catch(r){throw console.error("Erreur lors de l'upload des images:",r),r}}async deleteBoatImage(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const a=await fetch(`${this.boatsEndpoint}/${e}/images/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}),o=await a.json();if(!a.ok)throw new Error(o.message||"Erreur lors de la suppression de l'image");return o}catch(r){throw console.error("Erreur lors de la suppression de l'image:",r),r}}async updateBoat(e,t,r=null){try{const a=this.getAuthToken();if(!a)throw new Error("Authentification requise");const o=new FormData;Object.keys(t).forEach(i=>{t[i]!==void 0&&t[i]!==null&&(typeof t[i]=="object"?o.append(i,JSON.stringify(t[i])):o.append(i,t[i]))}),r&&r.length>0&&r.forEach(i=>{o.append("images",i)});const s=await fetch(`${this.boatsEndpoint}/${e}`,{method:"PUT",headers:{Authorization:`Bearer ${a}`},body:o}),n=await s.json();if(!s.ok)throw new Error(n.message||"Erreur lors de la mise à jour du bateau");return n}catch(a){throw console.error("Erreur lors de la mise à jour du bateau:",a),a}}async deleteBoat(e,t=!1){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const a=t?"?force=true":"",o=await fetch(`${this.boatsEndpoint}/${e}${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la suppression du bateau");return s}catch(r){throw console.error("Erreur lors de la suppression du bateau:",r),r}}async restoreBoat(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.boatsEndpoint}/${e}/restore`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),a=await r.json();if(!r.ok)throw new Error(a.message||"Erreur lors de la restauration du bateau");return a}catch(t){throw console.error("Erreur lors de la restauration du bateau:",t),t}}async setMainImage(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const a=await fetch(`${this.boatsEndpoint}/${e}/images/${t}/main`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),o=await a.json();if(!a.ok)throw new Error(o.message||"Erreur lors de la définition de l'image principale");return o}catch(r){throw console.error("Erreur lors de la définition de l'image principale:",r),r}}getBoatTypes(){return[{value:"voilier",label:"Voilier"},{value:"catamaran",label:"Catamaran"},{value:"yacht",label:"Yacht"},{value:"bateau_moteur",label:"Bateau à moteur"},{value:"semi_rigide",label:"Semi-rigide"},{value:"peniche",label:"Péniche"}]}getBoatCategories(){return[{value:"luxe",label:"Luxe"},{value:"standard",label:"Standard"},{value:"economique",label:"Économique"},{value:"sportif",label:"Sportif"},{value:"familial",label:"Familial"}]}validateBoatData(e){const t=[];return(!e.name||e.name.trim().length===0)&&t.push("Le nom du bateau est obligatoire"),(!e.description||e.description.trim().length===0)&&t.push("La description est obligatoire"),e.type||t.push("Le type de bateau est obligatoire"),e.category||t.push("La catégorie est obligatoire"),e.specifications?((!e.specifications.length||e.specifications.length<=0)&&t.push("La longueur doit être positive"),(!e.specifications.width||e.specifications.width<=0)&&t.push("La largeur doit être positive")):t.push("Les spécifications sont obligatoires"),e.capacity?(!e.capacity.maxPeople||e.capacity.maxPeople<=0)&&t.push("Le nombre maximum de personnes doit être positif"):t.push("La capacité est obligatoire"),e.location?((!e.location.marina||e.location.marina.trim().length===0)&&t.push("Le port d'attache est obligatoire"),(!e.location.city||e.location.city.trim().length===0)&&t.push("La ville est obligatoire")):t.push("La localisation est obligatoire"),e.pricing?((!e.pricing.dailyRate||e.pricing.dailyRate<=0)&&t.push("Le tarif journalier doit être positif"),(!e.pricing.securityDeposit||e.pricing.securityDeposit<0)&&t.push("La caution ne peut pas être négative")):t.push("Les tarifs sont obligatoires"),{isValid:t.length===0,errors:t}}getAuthToken(){try{if(window.app&&window.app.storageManager){const t=window.app.storageManager.getToken();return console.log("🔐 [BOAT SERVICE] Token récupéré via StorageManager:",t?"Présent":"Absent"),t}const e=localStorage.getItem("sailingloc_token");return console.log("🔐 [BOAT SERVICE] Token récupéré via localStorage:",e?"Présent":"Absent"),e}catch(e){return console.error("Erreur lors de la récupération du token:",e),null}}formatBoatForDisplay(e){var t,r,a,o,s,n;return{...e,formattedPrice:`${e.pricing.dailyRate}€/jour`,formattedCapacity:`${e.capacity.maxPeople} personnes`,formattedLength:`${e.specifications.length}m`,formattedLocation:`${e.location.city}, ${e.location.country}`,mainImage:((r=(t=e.images)==null?void 0:t.find(i=>i.isMain))==null?void 0:r.url)||((o=(a=e.images)==null?void 0:a[0])==null?void 0:o.url),rating:{...e.rating,formattedAverage:((n=(s=e.rating)==null?void 0:s.average)==null?void 0:n.toFixed(1))||"0.0"}}}calculateTotalPrice(e,t,r){const a=new Date(t),o=new Date(r),s=Math.ceil((o-a)/(1e3*60*60*24));let n=0;if(s>=30&&e.pricing.monthlyRate){const i=Math.floor(s/30),c=s%30;n=i*e.pricing.monthlyRate+c*e.pricing.dailyRate}else if(s>=7&&e.pricing.weeklyRate){const i=Math.floor(s/7),c=s%7;n=i*e.pricing.weeklyRate+c*e.pricing.dailyRate}else n=s*e.pricing.dailyRate;return{days:s,subtotal:n,cleaningFee:e.pricing.cleaningFee||0,securityDeposit:e.pricing.securityDeposit,total:n+(e.pricing.cleaningFee||0)}}}class y{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.bookingsEndpoint=`${this.baseURL}/bookings`}async createBooking(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(this.bookingsEndpoint,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)}),a=await r.json();if(!r.ok)throw new Error(a.message||"Erreur lors de la création de la réservation");return a}catch(t){throw console.error("Erreur lors de la création de la réservation:",t),t}}async getUserBookings(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams;Object.keys(e).forEach(n=>{e[n]!==void 0&&e[n]!==""&&r.append(n,e[n])});const a=`${this.bookingsEndpoint}?${r.toString()}`,o=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la récupération des réservations");return s}catch(t){throw console.error("Erreur lors de la récupération des réservations:",t),t}}async getBookingById(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.bookingsEndpoint}/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),a=await r.json();if(!r.ok)throw new Error(a.message||"Erreur lors de la récupération de la réservation");return a}catch(t){throw console.error("Erreur lors de la récupération de la réservation:",t),t}}async confirmBooking(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.bookingsEndpoint}/${e}/confirm`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),a=await r.json();if(!r.ok)throw new Error(a.message||"Erreur lors de la confirmation de la réservation");return a}catch(t){throw console.error("Erreur lors de la confirmation de la réservation:",t),t}}async cancelBooking(e,t=""){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const a=await fetch(`${this.bookingsEndpoint}/${e}/cancel`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({reason:t})}),o=await a.json();if(!a.ok)throw new Error(o.message||"Erreur lors de l'annulation de la réservation");return o}catch(r){throw console.error("Erreur lors de l'annulation de la réservation:",r),r}}async checkIn(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const a=await fetch(`${this.bookingsEndpoint}/${e}/checkin`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await a.json();if(!a.ok)throw new Error(o.message||"Erreur lors du check-in");return o}catch(r){throw console.error("Erreur lors du check-in:",r),r}}async checkOut(e,t){try{const r=this.getAuthToken();if(!r)throw new Error("Authentification requise");const a=await fetch(`${this.bookingsEndpoint}/${e}/checkout`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await a.json();if(!a.ok)throw new Error(o.message||"Erreur lors du check-out");return o}catch(r){throw console.error("Erreur lors du check-out:",r),r}}async addReview(e,t,r){try{const a=this.getAuthToken();if(!a)throw new Error("Authentification requise");const o=await fetch(`${this.bookingsEndpoint}/${e}/review`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({rating:t,comment:r})}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de l'ajout de l'avis");return s}catch(a){throw console.error("Erreur lors de l'ajout de l'avis:",a),a}}async getBookingStats(){try{const e=this.getAuthToken();if(!e)throw new Error("Authentification requise");const t=await fetch(`${this.bookingsEndpoint}/stats/overview`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la récupération des statistiques");return r}catch(e){throw console.error("Erreur lors de la récupération des statistiques:",e),e}}validateBookingData(e){const t=[];if(e.boatId||t.push("L'ID du bateau est obligatoire"),e.startDate||t.push("La date de début est obligatoire"),e.endDate||t.push("La date de fin est obligatoire"),e.startDate&&e.endDate){const r=new Date(e.startDate),a=new Date(e.endDate),o=new Date;o.setHours(0,0,0,0),r<o&&t.push("La date de début ne peut pas être dans le passé"),a<=r&&t.push("La date de fin doit être postérieure à la date de début");const s=new Date;s.setFullYear(s.getFullYear()+1),r>s&&t.push("La réservation ne peut pas être faite plus d'un an à l'avance")}return e.participants?((!e.participants.adults||e.participants.adults<1)&&t.push("Il doit y avoir au moins 1 adulte"),e.participants.children&&e.participants.children<0&&t.push("Le nombre d'enfants ne peut pas être négatif")):t.push("Les informations sur les participants sont obligatoires"),e.emergencyContact?((!e.emergencyContact.name||e.emergencyContact.name.trim().length===0)&&t.push("Le nom du contact d'urgence est obligatoire"),(!e.emergencyContact.phone||e.emergencyContact.phone.trim().length===0)&&t.push("Le téléphone du contact d'urgence est obligatoire"),(!e.emergencyContact.relationship||e.emergencyContact.relationship.trim().length===0)&&t.push("La relation avec le contact d'urgence est obligatoire")):t.push("Le contact d'urgence est obligatoire"),e.renterExperience?(e.renterExperience.hasLicense===void 0&&t.push("L'information sur le permis nautique est obligatoire"),e.renterExperience.yearsOfExperience!==void 0&&e.renterExperience.yearsOfExperience<0&&t.push("Les années d'expérience ne peuvent pas être négatives")):t.push("Les informations sur l'expérience nautique sont obligatoires"),{isValid:t.length===0,errors:t}}calculateCancellationFees(e){const t=new Date,r=new Date(e.startDate),a=Math.ceil((r-t)/(1e3*60*60*24));let o=0;a<1?o=100:a<7?o=50:a<14?o=25:a<30&&(o=10);const s=e.pricing.totalAmount*o/100,n=e.pricing.totalAmount-s;return{daysUntilStart:a,feePercentage:o,cancellationFee:s,refundAmount:n,canCancel:a>=0}}formatBookingForDisplay(e){const t=new Date(e.startDate),r=new Date(e.endDate),a=Math.ceil((r-t)/(1e3*60*60*24));return{...e,formattedStartDate:t.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),formattedEndDate:r.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),formattedDuration:`${a} jour${a>1?"s":""}`,formattedTotalAmount:`${e.pricing.totalAmount}€`,formattedStatus:this.getStatusLabel(e.status),statusColor:this.getStatusColor(e.status),canCancel:this.canCancelBooking(e),canReview:this.canReviewBooking(e)}}getStatusLabel(e){return{pending:"En attente",confirmed:"Confirmée",paid:"Payée",active:"En cours",completed:"Terminée",cancelled:"Annulée",refunded:"Remboursée"}[e]||e}getStatusColor(e){return{pending:"status-warning",confirmed:"status-info",paid:"status-success",active:"status-primary",completed:"status-success",cancelled:"status-danger",refunded:"status-secondary"}[e]||"status-default"}canCancelBooking(e){const t=["pending","confirmed","paid"],r=new Date,a=new Date(e.startDate);return t.includes(e.status)&&a>r}canReviewBooking(e){var t;return e.status==="completed"&&!((t=e.review)!=null&&t.renterReview)}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la récupération du token:",e),null}}createDefaultBookingData(e){const t=new Date;t.setDate(t.getDate()+1);const r=new Date;return r.setDate(r.getDate()+2),{boatId:e,startDate:t.toISOString().split("T")[0],endDate:r.toISOString().split("T")[0],participants:{adults:2,children:0},emergencyContact:{name:"",phone:"",relationship:""},renterExperience:{hasLicense:!1,licenseType:"",yearsOfExperience:0,previousBoatTypes:[],additionalInfo:""},specialRequests:"",skipperRequested:!1,additionalServices:[]}}toCalendarEvent(e){return{id:e._id,title:`${e.boat.name} - ${e.bookingNumber}`,start:e.startDate,end:e.endDate,color:this.getStatusColor(e.status),extendedProps:{booking:e,status:e.status,boatName:e.boat.name,totalAmount:e.pricing.totalAmount}}}}class v{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.paymentsEndpoint=`${this.baseURL}/payments`,this.stripePublishableKey=void 0,this.stripe=null,this.initializeStripe()}async initializeStripe(){if(this.stripePublishableKey&&window.Stripe)try{this.stripe=window.Stripe(this.stripePublishableKey),console.log("✅ Stripe initialisé")}catch(e){console.error("❌ Erreur lors de l'initialisation de Stripe:",e)}else console.log("ℹ️ Stripe non configuré - Mode simulation activé")}async createPaymentIntent(e){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=await fetch(`${this.paymentsEndpoint}/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({bookingId:e})}),a=await r.json();if(!r.ok)throw new Error(a.message||"Erreur lors de la création du paiement");return a}catch(t){throw console.error("Erreur lors de la création du Payment Intent:",t),t}}async confirmPayment(e,t=null){try{if(!this.getAuthToken())throw new Error("Authentification requise");return this.stripe&&t?await this.confirmStripePayment(e,t):await this.confirmSimulatedPayment(e,t)}catch(r){throw console.error("Erreur lors de la confirmation du paiement:",r),r}}async confirmStripePayment(e,t){try{const{error:r,paymentIntent:a}=await this.stripe.confirmCardPayment(e,{payment_method:t});if(r)throw new Error(r.message);return a.status==="succeeded"?await this.notifyPaymentSuccess(e):{success:!1,message:"Le paiement n'a pas pu être traité"}}catch(r){throw console.error("Erreur lors du paiement Stripe:",r),r}}async confirmSimulatedPayment(e,t){try{const r=this.getAuthToken(),a=await fetch(`${this.paymentsEndpoint}/confirm-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({paymentIntentId:e,paymentMethodId:t||"pm_simulation_card"})}),o=await a.json();if(!a.ok)throw new Error(o.message||"Erreur lors de la confirmation du paiement");return o}catch(r){throw console.error("Erreur lors du paiement simulé:",r),r}}async notifyPaymentSuccess(e){try{const t=this.getAuthToken(),r=await fetch(`${this.paymentsEndpoint}/confirm-payment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({paymentIntentId:e})}),a=await r.json();if(!r.ok)throw new Error(a.message||"Erreur lors de la notification du paiement");return a}catch(t){throw console.error("Erreur lors de la notification du paiement:",t),t}}async refundPayment(e,t=null,r=""){try{const a=this.getAuthToken();if(!a)throw new Error("Authentification requise");const o=await fetch(`${this.paymentsEndpoint}/refund`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({bookingId:e,amount:t,reason:r})}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors du remboursement");return s}catch(a){throw console.error("Erreur lors du remboursement:",a),a}}async getPaymentHistory(e={}){try{const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const r=new URLSearchParams;Object.keys(e).forEach(n=>{e[n]!==void 0&&e[n]!==""&&r.append(n,e[n])});const a=`${this.paymentsEndpoint}/history?${r.toString()}`,o=await fetch(a,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),s=await o.json();if(!o.ok)throw new Error(s.message||"Erreur lors de la récupération de l'historique");return s}catch(t){throw console.error("Erreur lors de la récupération de l'historique des paiements:",t),t}}async getPaymentStats(){try{const e=this.getAuthToken();if(!e)throw new Error("Authentification requise");const t=await fetch(`${this.paymentsEndpoint}/stats`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la récupération des statistiques");return r}catch(e){throw console.error("Erreur lors de la récupération des statistiques de paiement:",e),e}}createSimulatedPaymentForm(e,t){const r=document.createElement("form");return r.className="payment-form",r.innerHTML=`
      <div class="payment-header">
        <h3>Paiement sécurisé</h3>
        <p class="payment-amount">Montant: ${(e.amount/100).toFixed(2)}€</p>
      </div>
      
      <div class="payment-method">
        <h4>Mode de paiement</h4>
        <div class="payment-options">
          <label class="payment-option">
            <input type="radio" name="payment-method" value="card" checked>
            <span class="option-label">
              💳 Carte bancaire
            </span>
          </label>
        </div>
      </div>
      
      <div class="card-form" id="card-form">
        <div class="form-group">
          <label for="card-number">Numéro de carte</label>
          <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="card-expiry">MM/AA</label>
            <input type="text" id="card-expiry" placeholder="12/25" maxlength="5" required>
          </div>
          <div class="form-group">
            <label for="card-cvc">CVC</label>
            <input type="text" id="card-cvc" placeholder="123" maxlength="4" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="card-name">Nom sur la carte</label>
          <input type="text" id="card-name" placeholder="Jean Dupont" required>
        </div>
      </div>
      
      <div class="payment-summary">
        <div class="summary-line">
          <span>Sous-total:</span>
          <span>${(e.amount/100).toFixed(2)}€</span>
        </div>
        <div class="summary-line total">
          <span>Total:</span>
          <span>${(e.amount/100).toFixed(2)}€</span>
        </div>
      </div>
      
      <button type="submit" class="btn-primary btn-full payment-submit">
        Payer ${(e.amount/100).toFixed(2)}€
      </button>
      
      <div class="payment-security">
        <p>🔒 Paiement sécurisé SSL</p>
      </div>
    `,this.setupCardFormatting(r),r.addEventListener("submit",async a=>{a.preventDefault();try{const o=r.querySelector(".payment-submit"),s=o.textContent;o.disabled=!0,o.textContent="Traitement...",await new Promise(i=>setTimeout(i,2e3));const n=await this.confirmPayment(e.id);if(n.success)this.showPaymentSuccess(t,n.data);else throw new Error(n.message||"Erreur de paiement")}catch(o){console.error("Erreur de paiement:",o),this.showPaymentError(t,o.message);const s=r.querySelector(".payment-submit");s.disabled=!1,s.textContent=originalText}}),t.innerHTML="",t.appendChild(r),{form:r,submit:()=>r.dispatchEvent(new Event("submit"))}}setupCardFormatting(e){const t=e.querySelector("#card-number"),r=e.querySelector("#card-expiry"),a=e.querySelector("#card-cvc");t&&t.addEventListener("input",o=>{var i;let s=o.target.value.replace(/\s/g,"").replace(/[^0-9]/gi,""),n=((i=s.match(/.{1,4}/g))==null?void 0:i.join(" "))||s;o.target.value=n}),r&&r.addEventListener("input",o=>{let s=o.target.value.replace(/\D/g,"");s.length>=2&&(s=s.substring(0,2)+"/"+s.substring(2,4)),o.target.value=s}),a&&a.addEventListener("input",o=>{o.target.value=o.target.value.replace(/[^0-9]/g,"")})}showPaymentSuccess(e,t){e.innerHTML=`
      <div class="payment-success">
        <div class="success-icon">✅</div>
        <h3>Paiement réussi !</h3>
        <p>Votre réservation a été confirmée.</p>
        <div class="payment-details">
          <p><strong>Numéro de réservation:</strong> ${t.booking.bookingNumber}</p>
          <p><strong>Montant payé:</strong> ${t.payment.amount}€</p>
        </div>
        <button class="btn-primary" onclick="window.location.reload()">
          Retour à l'accueil
        </button>
      </div>
    `}showPaymentError(e,t){const r=document.createElement("div");r.className="payment-error",r.innerHTML=`
      <div class="error-icon">❌</div>
      <p><strong>Erreur de paiement:</strong> ${t}</p>
      <button class="btn-secondary" onclick="this.parentElement.remove()">
        Réessayer
      </button>
    `,e.insertBefore(r,e.firstChild),setTimeout(()=>{r.parentElement&&r.remove()},5e3)}validateCardData(e){const t=[];if((!e.number||e.number.replace(/\s/g,"").length<13)&&t.push("Numéro de carte invalide"),!e.expiry||!/^\d{2}\/\d{2}$/.test(e.expiry))t.push("Date d'expiration invalide (MM/AA)");else{const[r,a]=e.expiry.split("/"),o=new Date,s=o.getFullYear()%100,n=o.getMonth()+1;(parseInt(r)<1||parseInt(r)>12)&&t.push("Mois d'expiration invalide"),(parseInt(a)<s||parseInt(a)===s&&parseInt(r)<n)&&t.push("Carte expirée")}return(!e.cvc||e.cvc.length<3||e.cvc.length>4)&&t.push("Code CVC inval ide"),(!e.name||e.name.trim().length<2)&&t.push("Nom sur la carte requis"),{isValid:t.length===0,errors:t}}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la récupération du token:",e),null}}formatAmount(e,t="EUR"){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:t}).format(e/100)}isStripeReady(){return this.stripe!==null&&this.stripePublishableKey!==void 0}async loadStripe(){if(window.Stripe)return!0;try{const e=document.createElement("script");return e.src="https://js.stripe.com/v3/",e.async=!0,new Promise((t,r)=>{e.onload=()=>{this.initializeStripe(),t(!0)},e.onerror=()=>r(!1),document.head.appendChild(e)})}catch(e){return console.error("Erreur lors du chargement de Stripe:",e),!1}}}class w{constructor(){this.notificationContainer=null,this.notificationQueue=[],this.maxNotifications=5,this.activeModals=new Set,this.loadingElements=new Map,this.init()}init(){this.createNotificationContainer(),this.setupGlobalEventListeners(),this.setupKeyboardShortcuts()}createNotificationContainer(){this.notificationContainer=document.getElementById("notifications"),this.notificationContainer||(this.notificationContainer=document.createElement("div"),this.notificationContainer.id="notifications",this.notificationContainer.className="notifications",document.body.appendChild(this.notificationContainer))}setupGlobalEventListeners(){document.addEventListener("keydown",e=>{e.key==="Escape"&&this.closeTopModal()}),window.addEventListener("resize",()=>{this.handleWindowResize()}),window.addEventListener("scroll",()=>{this.handleScroll()})}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="k"&&(e.preventDefault(),this.focusSearchInput())})}showNotification(e,t="info",r=5e3,a={}){const o={id:Date.now()+Math.random(),message:e,type:t,duration:r,...a};if(this.notificationContainer.children.length>=this.maxNotifications){this.notificationQueue.push(o);return}this.renderNotification(o)}renderNotification(e){const t=document.createElement("div");t.className=`notification notification-${e.type}`,t.setAttribute("data-notification-id",e.id);const r={success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"};if(t.innerHTML=`
      <div class="notification-content">
        <span class="notification-icon">${r[e.type]||r.info}</span>
        <span class="notification-message">${e.message}</span>
        <button class="notification-close" aria-label="Fermer">×</button>
      </div>
      ${e.duration>0?'<div class="notification-progress"></div>':""}
    `,t.querySelector(".notification-close").addEventListener("click",()=>{this.hideNotification(e.id)}),t.style.transform="translateX(100%)",t.style.opacity="0",this.notificationContainer.appendChild(t),requestAnimationFrame(()=>{t.style.transform="translateX(0)",t.style.opacity="1"}),e.duration>0){const o=t.querySelector(".notification-progress");o&&(o.style.animationDuration=`${e.duration}ms`),setTimeout(()=>{this.hideNotification(e.id)},e.duration)}}hideNotification(e){const t=this.notificationContainer.querySelector(`[data-notification-id="${e}"]`);t&&(t.style.transform="translateX(100%)",t.style.opacity="0",setTimeout(()=>{if(t.parentElement&&(t.remove(),this.notificationQueue.length>0)){const r=this.notificationQueue.shift();this.renderNotification(r)}},300))}showModal(e,t={}){const r=document.getElementById(e);if(!r){console.error(`Modale ${e} non trouvée`);return}this.activeModals.add(e);const a={closeOnBackdrop:!0,focus:!0,...t};r.style.display="flex",r.classList.add("modal-active"),requestAnimationFrame(()=>{r.classList.add("modal-open")}),a.focus&&setTimeout(()=>{const o=r.querySelector("input, button, textarea, select");o&&o.focus()},100),document.body.classList.add("modal-open"),a.closeOnBackdrop&&r.addEventListener("click",this.handleModalBackdropClick.bind(this))}hideModal(e){const t=document.getElementById(e);t&&(this.activeModals.delete(e),t.classList.remove("modal-open"),setTimeout(()=>{t.style.display="none",t.classList.remove("modal-active"),this.activeModals.size===0&&document.body.classList.remove("modal-open")},300),t.removeEventListener("click",this.handleModalBackdropClick.bind(this)))}closeTopModal(){if(this.activeModals.size>0){const e=Array.from(this.activeModals).pop();this.hideModal(e)}}handleModalBackdropClick(e){if(e.target.classList.contains("modal")){const t=e.target.id;this.hideModal(t)}}showLoading(e,t="Chargement..."){const r=typeof e=="string"?document.getElementById(e)||document.querySelector(e):e;if(!r){console.error(`Élément ${e} non trouvé pour le loading`);return}this.loadingElements.has(r)||this.loadingElements.set(r,{originalContent:r.innerHTML,originalDisabled:r.disabled});const a=`
      <div class="loading-overlay">
        <div class="loading-spinner">
          <div class="spinner"></div>
          <span class="loading-message">${t}</span>
        </div>
      </div>
    `;r.tagName==="BUTTON"?(r.disabled=!0,r.innerHTML=`<span class="spinner-small"></span> ${t}`):(r.style.position="relative",r.insertAdjacentHTML("beforeend",a))}hideLoading(e){const t=typeof e=="string"?document.getElementById(e)||document.querySelector(e):e;if(!t)return;const r=this.loadingElements.get(t);r&&(t.innerHTML=r.originalContent,t.disabled=r.originalDisabled,this.loadingElements.delete(t));const a=t.querySelector(".loading-overlay");a&&a.remove()}scrollTo(e,t={}){const r=typeof e=="string"?document.querySelector(e):e;if(!r){console.error(`Élément ${e} non trouvé pour le scroll`);return}const a={behavior:"smooth",offset:0,...t},s=r.getBoundingClientRect().top+window.pageYOffset-a.offset;window.scrollTo({top:s,behavior:a.behavior})}handleWindowResize(){this.activeModals.forEach(e=>{document.getElementById(e)})}handleScroll(){const e=window.scrollY,t=document.querySelector(".hero");if(t){const a=t.querySelector(".hero-image");a&&(a.style.transform=`translateY(${e*.5}px)`)}const r=document.querySelector(".navbar");r&&(e>100?r.classList.add("scrolled"):r.classList.remove("scrolled"))}focusSearchInput(){const e=document.getElementById("search-location");e&&(e.focus(),e.select())}}const E=(()=>{let m={};const e={get(s){try{return localStorage.getItem(s)}catch{return null}},set(s,n){try{localStorage.setItem(s,n)}catch{}}},t=s=>m[s]??s,r=()=>{document.querySelectorAll("[data-i18n]").forEach(s=>{const n=s.getAttribute("data-i18n"),i=t(n);s.hasAttribute("data-i18n-placeholder")?s.placeholder=i.replace(/<[^>]+>/g,""):s.innerHTML=i})},a=async s=>{m=await(await fetch(`/i18n/${s}.json`,{cache:"no-cache"})).json(),e.set("lang",s),r()};return{init:async()=>{const s=e.get("lang")||(navigator.language||"fr").slice(0,2),n=["fr","en"].includes(s)?s:"fr";await a(n);const i=document.getElementById("langSwitcher");i&&(i.value=n,i.addEventListener("change",c=>a(c.target.value)))},load:a,t}})();class b{constructor(){this.prefix="sailingloc_",this.isStorageAvailable=this.checkStorageAvailability()}checkStorageAvailability(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return console.warn("localStorage non disponible:",e),!1}}setToken(e){if(!this.isStorageAvailable)return!1;try{return localStorage.setItem(`${this.prefix}token`,e),!0}catch(t){return console.error("Erreur lors de la sauvegarde du token:",t),!1}}getToken(){if(!this.isStorageAvailable)return null;try{return localStorage.getItem(`${this.prefix}token`)}catch(e){return console.error("Erreur lors de la récupération du token:",e),null}}removeToken(){if(!this.isStorageAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}token`),!0}catch(e){return console.error("Erreur lors de la suppression du token:",e),!1}}setUser(e){if(!this.isStorageAvailable)return!1;try{return localStorage.setItem(`${this.prefix}user`,JSON.stringify(e)),!0}catch(t){return console.error("Erreur lors de la sauvegarde des données utilisateur:",t),!1}}getUser(){if(!this.isStorageAvailable)return null;try{const e=localStorage.getItem(`${this.prefix}user`);return e?JSON.parse(e):null}catch(e){return console.error("Erreur lors de la récupération des données utilisateur:",e),null}}removeUser(){if(!this.isStorageAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}user`),!0}catch(e){return console.error("Erreur lors de la suppression des données utilisateur:",e),!1}}clearAuth(){const e=this.removeToken(),t=this.removeUser();return e&&t}setSearchPreferences(e){if(!this.isStorageAvailable)return!1;try{return localStorage.setItem(`${this.prefix}search_prefs`,JSON.stringify(e)),!0}catch(t){return console.error("Erreur lors de la sauvegarde des préférences:",t),!1}}getSearchPreferences(){if(!this.isStorageAvailable)return this.getDefaultSearchPreferences();try{const e=localStorage.getItem(`${this.prefix}search_prefs`);return e?JSON.parse(e):this.getDefaultSearchPreferences()}catch(e){return console.error("Erreur lors de la récupération des préférences:",e),this.getDefaultSearchPreferences()}}getDefaultSearchPreferences(){return{location:"",type:"all",maxPrice:1e3,minCapacity:1,sortBy:"price",sortOrder:"asc"}}addToSearchHistory(e){if(!this.isStorageAvailable||!e.trim())return!1;try{let t=this.getSearchHistory();return t=t.filter(r=>r.toLowerCase()!==e.toLowerCase()),t.unshift(e.trim()),t=t.slice(0,10),localStorage.setItem(`${this.prefix}search_history`,JSON.stringify(t)),!0}catch(t){return console.error("Erreur lors de la sauvegarde de l'historique:",t),!1}}getSearchHistory(){if(!this.isStorageAvailable)return[];try{const e=localStorage.getItem(`${this.prefix}search_history`);return e?JSON.parse(e):[]}catch(e){return console.error("Erreur lors de la récupération de l'historique:",e),[]}}clearSearchHistory(){if(!this.isStorageAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}search_history`),!0}catch(e){return console.error("Erreur lors de l'effacement de l'historique:",e),!1}}addToFavorites(e){if(!this.isStorageAvailable||!e)return!1;try{let t=this.getFavorites();return t.includes(e)||(t.push(e),localStorage.setItem(`${this.prefix}favorites`,JSON.stringify(t))),!0}catch(t){return console.error("Erreur lors de l'ajout aux favoris:",t),!1}}removeFromFavorites(e){if(!this.isStorageAvailable||!e)return!1;try{let t=this.getFavorites();return t=t.filter(r=>r!==e),localStorage.setItem(`${this.prefix}favorites`,JSON.stringify(t)),!0}catch(t){return console.error("Erreur lors de la suppression des favoris:",t),!1}}getFavorites(){if(!this.isStorageAvailable)return[];try{const e=localStorage.getItem(`${this.prefix}favorites`);return e?JSON.parse(e):[]}catch(e){return console.error("Erreur lors de la récupération des favoris:",e),[]}}isFavorite(e){return this.getFavorites().includes(e)}setAppSettings(e){if(!this.isStorageAvailable)return!1;try{const r={...this.getAppSettings(),...e};return localStorage.setItem(`${this.prefix}app_settings`,JSON.stringify(r)),!0}catch(t){return console.error("Erreur lors de la sauvegarde des paramètres:",t),!1}}getAppSettings(){if(!this.isStorageAvailable)return this.getDefaultAppSettings();try{const e=localStorage.getItem(`${this.prefix}app_settings`);return e?JSON.parse(e):this.getDefaultAppSettings()}catch(e){return console.error("Erreur lors de la récupération des paramètres:",e),this.getDefaultAppSettings()}}getDefaultAppSettings(){return{theme:"light",language:"fr",currency:"EUR",notifications:!0,emailUpdates:!0,autoSave:!0}}setFormData(e,t){if(!this.isStorageAvailable||!e)return!1;try{return localStorage.setItem(`${this.prefix}form_${e}`,JSON.stringify(t)),!0}catch(r){return console.error("Erreur lors de la sauvegarde du formulaire:",r),!1}}getFormData(e){if(!this.isStorageAvailable||!e)return null;try{const t=localStorage.getItem(`${this.prefix}form_${e}`);return t?JSON.parse(t):null}catch(t){return console.error("Erreur lors de la récupération du formulaire:",t),null}}removeFormData(e){if(!this.isStorageAvailable||!e)return!1;try{return localStorage.removeItem(`${this.prefix}form_${e}`),!0}catch(t){return console.error("Erreur lors de la suppression du formulaire:",t),!1}}clearAllData(){if(!this.isStorageAvailable)return!1;try{return Object.keys(localStorage).forEach(t=>{t.startsWith(this.prefix)&&localStorage.removeItem(t)}),!0}catch(e){return console.error("Erreur lors du nettoyage des données:",e),!1}}getStorageSize(){if(!this.isStorageAvailable)return{bytes:0,kb:0,mb:0};try{let e=0;return Object.keys(localStorage).forEach(r=>{r.startsWith(this.prefix)&&(e+=localStorage.getItem(r).length)}),{bytes:e,kb:Math.round(e/1024*100)/100,mb:Math.round(e/(1024*1024)*100)/100}}catch(e){return console.error("Erreur lors du calcul de la taille:",e),{bytes:0,kb:0,mb:0}}}setWithExpiry(e,t,r){if(!this.isStorageAvailable)return!1;try{const o={value:t,expiry:new Date().getTime()+r};return localStorage.setItem(`${this.prefix}${e}`,JSON.stringify(o)),!0}catch(a){return console.error("Erreur lors de la sauvegarde avec expiration:",a),!1}}getWithExpiry(e){if(!this.isStorageAvailable)return null;try{const t=localStorage.getItem(`${this.prefix}${e}`);if(!t)return null;const r=JSON.parse(t);return new Date().getTime()>r.expiry?(localStorage.removeItem(`${this.prefix}${e}`),null):r.value}catch(t){return console.error("Erreur lors de la récupération avec expiration:",t),null}}setSessionData(e,t){try{return sessionStorage.setItem(`${this.prefix}${e}`,JSON.stringify(t)),!0}catch(r){return console.error("Erreur lors de la sauvegarde en session:",r),!1}}getSessionData(e){try{const t=sessionStorage.getItem(`${this.prefix}${e}`);return t?JSON.parse(t):null}catch(t){return console.error("Erreur lors de la récupération en session:",t),null}}removeSessionData(e){try{return sessionStorage.removeItem(`${this.prefix}${e}`),!0}catch(t){return console.error("Erreur lors de la suppression en session:",t),!1}}}class B{constructor(){this.authService=new g,this.boatService=new f,this.bookingService=new y,this.paymentService=new v,this.uiManager=new w,this.storageManager=new b,this.currentUser=null,this.currentPage=1,this.boatsPerPage=12,this.currentFilters={},this.selectedImages=[],this.init()}async init(){try{console.log("🚀 Initialisation de SailingLoc..."),await E.init(),await this.checkAuthStatus(),this.setupEventListeners();const e=window.location.pathname;(e==="/"||e.endsWith("index.html")||e.endsWith("boats.html"))&&await this.loadBoats(),this.setupNavigation(),this.initBoatManagement(),console.log("✅ SailingLoc initialisé avec succès")}catch(e){console.error("❌ Erreur lors de l'initialisation:",e),this.uiManager.showNotification("Erreur lors du chargement de l'application","error")}}async checkAuthStatus(){const e=this.storageManager.getToken();if(console.log("🔐 [AUTH] Token trouvé:",e?"Oui":"Non"),e)try{const t=await this.authService.verifyToken();console.log("🔐 [AUTH] Vérification token:",t.success?"Valide":"Invalide"),t.success?(this.currentUser=t.data.user,console.log("🔐 [AUTH] Utilisateur connecté:",this.currentUser.email,"Rôle:",this.currentUser.role),this.updateUIForAuthenticatedUser()):(console.log("🔐 [AUTH] Token invalide, nettoyage..."),this.storageManager.clearAuth())}catch(t){console.error("Erreur lors de la vérification du token:",t),this.storageManager.clearAuth()}else console.log("🔐 [AUTH] Aucun token trouvé, utilisateur non connecté")}setupEventListeners(){this.setupAuthListeners(),this.setupSearchListeners(),this.setupNavigationListeners(),this.setupFormListeners(),this.setupModalListeners()}setupAuthListeners(){const e=document.getElementById("login-btn"),t=document.getElementById("register-btn");e&&e.addEventListener("click",()=>this.uiManager.showModal("login-modal")),t&&t.addEventListener("click",()=>this.uiManager.showModal("register-modal"));const r=document.getElementById("login-form"),a=document.getElementById("register-form");r&&r.addEventListener("submit",l=>this.handleLogin(l)),a&&a.addEventListener("submit",l=>this.handleRegister(l));const o=document.getElementById("switch-to-register"),s=document.getElementById("switch-to-login");o&&o.addEventListener("click",l=>{l.preventDefault(),this.uiManager.hideModal("login-modal"),this.uiManager.showModal("register-modal")}),s&&s.addEventListener("click",l=>{l.preventDefault(),this.uiManager.hideModal("register-modal"),this.uiManager.showModal("login-modal")});const n=document.getElementById("user-avatar"),i=document.getElementById("logout-link");n&&n.addEventListener("click",()=>this.toggleUserMenu()),i&&i.addEventListener("click",l=>{l.preventDefault(),this.handleLogout()});const c=document.getElementById("profile-link"),u=document.getElementById("bookings-link"),h=document.getElementById("boats-link");c&&c.addEventListener("click",l=>{l.preventDefault(),this.showProfile()}),u&&u.addEventListener("click",l=>{l.preventDefault(),this.showBookings()}),h&&h.addEventListener("click",l=>{l.preventDefault(),this.showMyBoats()})}setupSearchListeners(){const e=window.location.pathname;if(!(e==="/"||e.endsWith("index.html")||e.endsWith("boats.html")))return;const r=document.getElementById("search-btn");r&&r.addEventListener("click",()=>this.handleSearch());const a=document.getElementById("apply-filters");a&&a.addEventListener("click",()=>this.applyFilters());const o=document.getElementById("filter-price"),s=document.getElementById("price-display");o&&s&&o.addEventListener("input",c=>{s.textContent=`${c.target.value}€`});const n=document.getElementById("prev-page"),i=document.getElementById("next-page");n&&n.addEventListener("click",()=>this.changePage(this.currentPage-1)),i&&i.addEventListener("click",()=>this.changePage(this.currentPage+1))}setupNavigationListeners(){const e=document.getElementById("mobile-menu-toggle"),t=document.getElementById("nav-menu");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active")});const r=document.querySelectorAll(".nav-link");r.forEach(a=>{a.addEventListener("click",o=>{const s=a.getAttribute("href");if(s&&(s.includes(".html")||s.startsWith("http")))return;o.preventDefault();const n=s.substring(1),i=document.getElementById(n);i&&(i.scrollIntoView({behavior:"smooth",block:"start"}),r.forEach(c=>c.classList.remove("active")),a.classList.add("active"))})}),window.addEventListener("scroll",()=>{const a=document.getElementById("navbar");a&&(window.scrollY>100?a.classList.add("scrolled"):a.classList.remove("scrolled"))})}setupFormListeners(){const e=document.getElementById("contact-form");e&&e.addEventListener("submit",d=>this.handleContactForm(d));const t=document.getElementById("profile-form");t&&t.addEventListener("submit",d=>this.handleProfileUpdate(d));const r=document.getElementById("change-password-form");r&&r.addEventListener("submit",d=>this.handlePasswordChange(d));const a=document.getElementById("change-password-form-profile");a&&a.addEventListener("submit",d=>this.handlePasswordChange(d));const o=document.getElementById("preferences-form");o&&o.addEventListener("submit",d=>this.handlePreferencesUpdate(d));const s=document.getElementById("add-boat-form");s&&s.addEventListener("submit",d=>this.handleAddBoat(d));const n=document.getElementById("edit-boat-form");n&&n.addEventListener("submit",d=>this.handleEditBoat(d)),this.setupImageUpload();const i=document.getElementById("change-password-btn");i&&i.addEventListener("click",()=>{this.uiManager.showModal("change-password-modal")});const c=document.getElementById("add-boat-btn");c&&c.addEventListener("click",()=>{this.showAddBoatModal()}),document.querySelectorAll(".tab-btn").forEach(d=>{d.addEventListener("click",()=>{const p=d.getAttribute("data-tab");this.switchTab(p)})});const h=document.getElementById("refresh-bookings"),l=document.getElementById("refresh-boats");h&&h.addEventListener("click",()=>this.loadUserBookings()),l&&l.addEventListener("click",()=>this.loadOwnerBoats())}setupModalListeners(){document.querySelectorAll(".modal-close").forEach(r=>{r.addEventListener("click",a=>{const o=r.closest(".modal");o&&this.uiManager.hideModal(o.id)})}),document.querySelectorAll(".modal").forEach(r=>{r.addEventListener("click",a=>{a.target===r&&this.uiManager.hideModal(r.id)})})}async handleLogin(e){e.preventDefault();const t=document.getElementById("login-email").value,r=document.getElementById("login-password").value;if(console.log("🔐 Tentative de connexion:",{email:t,password:r?"***":"vide"}),!t||!r){this.uiManager.showNotification("Veuillez remplir tous les champs","error");return}try{this.uiManager.showLoading("login-form"),console.log("🔐 Appel AuthService.login...");const a=await this.authService.login(t,r);console.log("📡 Réponse complète:",a),a.success?(console.log("✅ Connexion réussie, données utilisateur:",a.data.user),this.currentUser=a.data.user,this.storageManager.setToken(a.data.token),this.storageManager.setUser(a.data.user),this.updateUIForAuthenticatedUser(),this.uiManager.hideModal("login-modal"),this.uiManager.showNotification("Connexion réussie !","success"),document.getElementById("login-form").reset()):(console.error("❌ Échec de connexion:",a.message),this.uiManager.showNotification(a.message||"Email ou mot de passe incorrect","error"))}catch(a){console.error("Erreur de connexion:",a),this.uiManager.showNotification(`Erreur de connexion: ${a.message||"Problème de réseau"}`,"error")}finally{this.uiManager.hideLoading("login-form")}}async handleRegister(e){e.preventDefault();const t={firstName:document.getElementById("register-firstname").value,lastName:document.getElementById("register-lastname").value,email:document.getElementById("register-email").value,password:document.getElementById("register-password").value,phone:document.getElementById("register-phone").value,role:document.getElementById("register-role").value};if(console.log("📝 Tentative d'inscription:",{...t,password:t.password?"***":"vide"}),!t.firstName||!t.lastName||!t.email||!t.password||!t.role){this.uiManager.showNotification("Veuillez remplir tous les champs obligatoires","error");return}if(t.password.length<6){this.uiManager.showNotification("Le mot de passe doit contenir au moins 6 caractères","error");return}try{this.uiManager.showLoading("register-form"),console.log("📝 Appel AuthService.register...");const r=await this.authService.register(t);console.log("📡 Réponse inscription:",r),r.success?(console.log("✅ Inscription réussie, données utilisateur:",r.data.user),this.currentUser=r.data.user,this.storageManager.setToken(r.data.token),this.storageManager.setUser(r.data.user),this.updateUIForAuthenticatedUser(),this.uiManager.hideModal("register-modal"),this.uiManager.showNotification("Inscription réussie !","success"),document.getElementById("register-form").reset()):(console.error("❌ Échec d'inscription:",r.message),this.uiManager.showNotification(r.message||"Erreur d'inscription","error"))}catch(r){console.error("Erreur d'inscription:",r),this.uiManager.showNotification(`Erreur d'inscription: ${r.message||"Problème de réseau"}`,"error")}finally{this.uiManager.hideLoading("register-form")}}async handleLogout(){try{await this.authService.logout(),this.currentUser=null,this.storageManager.clearAuth(),this.updateUIForUnauthenticatedUser(),this.uiManager.showNotification("Déconnexion réussie","success")}catch(e){console.error("Erreur de déconnexion:",e),this.currentUser=null,this.storageManager.clearAuth(),this.updateUIForUnauthenticatedUser()}}async showProfile(){try{this.uiManager.showModal("profile-modal"),await this.loadUserProfile()}catch(e){console.error("Erreur lors de l'affichage du profil:",e),this.uiManager.showNotification("Erreur lors du chargement du profil","error")}}async loadUserProfile(){var e,t;try{const r=await this.authService.getProfile();if(r.success){const a=r.data.user;document.getElementById("profile-firstname").value=a.firstName||"",document.getElementById("profile-lastname").value=a.lastName||"",document.getElementById("profile-email").value=a.email||"",document.getElementById("profile-phone").value=a.phone||"",a.address&&(document.getElementById("profile-street").value=a.address.street||"",document.getElementById("profile-city").value=a.address.city||"",document.getElementById("profile-postal").value=a.address.postalCode||""),a.preferences&&(document.getElementById("profile-language").value=a.preferences.language||"fr",document.getElementById("profile-currency").value=a.preferences.currency||"EUR",document.getElementById("email-notifications").checked=((e=a.preferences.notifications)==null?void 0:e.email)!==!1,document.getElementById("sms-notifications").checked=((t=a.preferences.notifications)==null?void 0:t.sms)===!0)}}catch(r){console.error("Erreur lors du chargement du profil:",r),this.uiManager.showNotification("Erreur lors du chargement du profil","error")}}async handleProfileUpdate(e){e.preventDefault();const t={firstName:document.getElementById("profile-firstname").value,lastName:document.getElementById("profile-lastname").value,phone:document.getElementById("profile-phone").value,address:{street:document.getElementById("profile-street").value,city:document.getElementById("profile-city").value,postalCode:document.getElementById("profile-postal").value}};try{this.uiManager.showLoading("profile-form");const r=await this.authService.updateProfile(t);r.success?(this.currentUser=r.data.user,this.storageManager.setUser(r.data.user),this.updateUIForAuthenticatedUser(),this.uiManager.showNotification("Profil mis à jour avec succès !","success")):this.uiManager.showNotification(r.message||"Erreur lors de la mise à jour","error")}catch(r){console.error("Erreur lors de la mise à jour du profil:",r),this.uiManager.showNotification("Erreur lors de la mise à jour du profil","error")}finally{this.uiManager.hideLoading("profile-form")}}async handlePasswordChange(e){e.preventDefault();const t=e.target,r=t.querySelector('[id*="current-password"]').value,a=t.querySelector('[id*="new-password"]').value,o=t.querySelector('[id*="confirm-password"]').value;if(a!==o){this.uiManager.showNotification("Les mots de passe ne correspondent pas","error");return}try{this.uiManager.showLoading(t);const s=await this.authService.changePassword(r,a);s.success?(this.uiManager.showNotification("Mot de passe modifié avec succès !","success"),t.reset()):this.uiManager.showNotification(s.message||"Erreur lors du changement de mot de passe","error")}catch(s){console.error("Erreur lors du changement de mot de passe:",s),this.uiManager.showNotification("Erreur lors du changement de mot de passe","error")}finally{this.uiManager.hideLoading(t)}}async handlePreferencesUpdate(e){e.preventDefault();const t={preferences:{language:document.getElementById("profile-language").value,currency:document.getElementById("profile-currency").value,notifications:{email:document.getElementById("email-notifications").checked,sms:document.getElementById("sms-notifications").checked}}};try{this.uiManager.showLoading("preferences-form");const r=await this.authService.updateProfile(t);r.success?(this.currentUser=r.data.user,this.storageManager.setUser(r.data.user),this.uiManager.showNotification("Préférences mises à jour avec succès !","success")):this.uiManager.showNotification(r.message||"Erreur lors de la mise à jour","error")}catch(r){console.error("Erreur lors de la mise à jour des préférences:",r),this.uiManager.showNotification("Erreur lors de la mise à jour des préférences","error")}finally{this.uiManager.hideLoading("preferences-form")}}async showBookings(){try{this.uiManager.showModal("bookings-modal"),await this.loadUserBookings()}catch(e){console.error("Erreur lors de l'affichage des réservations:",e),this.uiManager.showNotification("Erreur lors du chargement des réservations","error")}}async loadUserBookings(){try{const e=document.getElementById("bookings-list");e.innerHTML=`
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Chargement des réservations...</p>
        </div>
      `;const t=await this.bookingService.getUserBookings();t.success?this.renderBookings(t.data.bookings):e.innerHTML=`
          <div class="no-results">
            <h3>Aucune réservation trouvée</h3>
            <p>Vous n'avez pas encore de réservations</p>
          </div>
        `}catch(e){console.error("Erreur lors du chargement des réservations:",e);const t=document.getElementById("bookings-list");t.innerHTML=`
        <div class="no-results">
          <h3>Erreur de chargement</h3>
          <p>Impossible de charger les réservations</p>
        </div>
      `}}renderBookings(e){const t=document.getElementById("bookings-list");if(e.length===0){t.innerHTML=`
        <div class="no-results">
          <h3>Aucune réservation</h3>
          <p>Vous n'avez pas encore de réservations</p>
        </div>
      `;return}t.innerHTML=e.map(r=>{var a,o,s;return`
      <div class="booking-card">
        <div class="booking-header">
          <span class="booking-number">#${r.bookingNumber}</span>
          <span class="booking-status status-${r.status}">${this.getStatusLabel(r.status)}</span>
        </div>
        <div class="booking-details">
          <div class="booking-detail">
            <span class="booking-detail-label">Bateau</span>
            <span class="booking-detail-value">${((a=r.boat)==null?void 0:a.name)||"N/A"}</span>
          </div>
          <div class="booking-detail">
            <span class="booking-detail-label">Dates</span>
            <span class="booking-detail-value">
              ${new Date(r.startDate).toLocaleDateString("fr-FR")} - 
              ${new Date(r.endDate).toLocaleDateString("fr-FR")}
            </span>
          </div>
          <div class="booking-detail">
            <span class="booking-detail-label">Montant</span>
            <span class="booking-detail-value">${((o=r.pricing)==null?void 0:o.totalAmount)||0}€</span>
          </div>
          <div class="booking-detail">
            <span class="booking-detail-label">Participants</span>
            <span class="booking-detail-value">${((s=r.participants)==null?void 0:s.total)||0} personnes</span>
          </div>
        </div>
        <div class="booking-actions">
          <button class="btn-secondary btn-small" onclick="app.viewBookingDetails('${r._id}')">
            Voir détails
          </button>
          ${r.status==="pending"||r.status==="confirmed"?`
            <button class="btn-ghost btn-small" onclick="app.cancelBooking('${r._id}')">
              Annuler
            </button>
          `:""}
        </div>
      </div>
    `}).join("")}async showMyBoats(){try{window.location.href="boat-management.html"}catch(e){console.error("Erreur lors de la redirection:",e),this.uiManager.showNotification("Erreur lors de la redirection","error")}}async loadOwnerBoats(){try{const e=document.getElementById("my-boats-list");e.innerHTML=`
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Chargement de vos bateaux...</p>
        </div>
      `;const t=await this.boatService.getOwnerBoats();t.success?this.renderOwnerBoats(t.data.boats):e.innerHTML=`
          <div class="no-results">
            <h3>Aucun bateau trouvé</h3>
            <p>Vous n'avez pas encore ajouté de bateaux</p>
          </div>
        `}catch(e){console.error("Erreur lors du chargement des bateaux:",e);const t=document.getElementById("my-boats-list");t.innerHTML=`
        <div class="no-results">
          <h3>Erreur de chargement</h3>
          <p>Impossible de charger vos bateaux</p>
        </div>
      `}}renderOwnerBoats(e){const t=document.getElementById("my-boats-list");if(e.length===0){t.innerHTML=`
        <div class="no-results">
          <h3>Aucun bateau</h3>
          <p>Vous n'avez pas encore ajouté de bateaux</p>
          <button class="btn-primary" onclick="app.uiManager.showModal('add-boat-modal')">
            Ajouter votre premier bateau
          </button>
        </div>
      `;return}t.innerHTML=e.map(r=>{var a,o,s,n,i,c,u;return`
      <div class="my-boat-card">
        <div class="my-boat-image">
          <img src="${r.mainImage||((o=(a=r.images)==null?void 0:a[0])==null?void 0:o.url)||"https://images.pexels.com/photos/1001682/pexels-photo-1001682.jpeg?auto=compress&cs=tinysrgb&w=400&h=300&fit=crop"}" alt="${r.name}">
          <div class="boat-status-badge status-${r.status}">${this.getBoatStatusLabel(r.status)}</div>
        </div>
        <div class="my-boat-content">
          <h3 class="my-boat-name">${r.name}</h3>
          <p class="my-boat-location">📍 ${((s=r.location)==null?void 0:s.city)||"N/A"}</p>
          <div class="my-boat-stats">
            <div class="boat-stat">
              <div class="boat-stat-value">${((n=r.pricing)==null?void 0:n.dailyRate)||0}€</div>
              <div class="boat-stat-label">Prix/jour</div>
            </div>
            <div class="boat-stat">
              <div class="boat-stat-value">${((i=r.stats)==null?void 0:i.totalBookings)||0}</div>
              <div class="boat-stat-label">Réservations</div>
            </div>
            <div class="boat-stat">
              <div class="boat-stat-value">${((u=(c=r.rating)==null?void 0:c.average)==null?void 0:u.toFixed(1))||"0.0"}</div>
              <div class="boat-stat-label">Note</div>
            </div>
          </div>
          <div class="my-boat-actions">
            <button class="btn-primary btn-small" onclick="app.editBoat('${r._id}')">
              Modifier
            </button>
            <button class="btn-secondary btn-small" onclick="app.showBoatDetails('${r._id}')">
              Voir
            </button>
            <button class="btn-ghost btn-small" onclick="app.toggleBoatStatus('${r._id}')">
              ${r.status==="available"?"Désactiver":"Activer"}
            </button>
          </div>
        </div>
      </div>
    `}).join("")}switchTab(e){document.querySelectorAll(".tab-btn").forEach(t=>t.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active")),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.getElementById(e).classList.add("active")}getStatusLabel(e){return{pending:"En attente",confirmed:"Confirmée",paid:"Payée",active:"En cours",completed:"Terminée",cancelled:"Annulée",refunded:"Remboursée"}[e]||e}getBoatStatusLabel(e){return{available:"Disponible",rented:"Loué",maintenance:"Maintenance",inactive:"Inactif"}[e]||e}async viewBookingDetails(e){this.uiManager.showNotification("Fonctionnalité en cours de développement","info")}async cancelBooking(e){confirm("Êtes-vous sûr de vouloir annuler cette réservation ?")&&this.uiManager.showNotification("Fonctionnalité en cours de développement","info")}async toggleBoatStatus(e){this.uiManager.showNotification("Fonctionnalité en cours de développement","info")}updateUIForAuthenticatedUser(){const e=document.getElementById("login-btn"),t=document.getElementById("register-btn"),r=document.getElementById("user-menu"),a=document.getElementById("user-name"),o=document.getElementById("user-email"),s=document.getElementById("user-initials"),n=document.getElementById("boats-link");e&&(e.style.display="none"),t&&(t.style.display="none"),r&&(r.style.display="block"),this.currentUser&&(a&&(a.textContent=`${this.currentUser.firstName} ${this.currentUser.lastName}`),o&&(o.textContent=this.currentUser.email),s&&(s.textContent=`${this.currentUser.firstName[0]}${this.currentUser.lastName[0]}`.toUpperCase()),n&&["owner","admin"].includes(this.currentUser.role)&&(n.style.display="block"))}updateUIForUnauthenticatedUser(){const e=document.getElementById("login-btn"),t=document.getElementById("register-btn"),r=document.getElementById("user-menu");e&&(e.style.display="block"),t&&(t.style.display="block"),r&&(r.style.display="none")}toggleUserMenu(){const e=document.getElementById("user-dropdown");e&&e.classList.toggle("active")}async loadBoats(e={},t=1){try{const r=document.getElementById("boats-grid"),a=document.getElementById("boats-loading");a&&(a.style.display="block");const o={page:t,limit:this.boatsPerPage,...e};console.log("🚤 Chargement des bateaux depuis:",this.boatService.boatsEndpoint),console.log("📊 Paramètres:",o);const s=await this.boatService.getBoats(o);console.log("📡 Réponse API:",s),s.success?(this.renderBoats(s.data.boats),this.renderPagination(s.data.pagination),this.currentPage=t,this.currentFilters=e):(console.error("❌ Erreur API:",s),this.uiManager.showNotification(`Erreur API: ${s.message||"Données non disponibles"}`,"error"),this.renderBoats([]))}catch(r){console.error("Erreur lors du chargement des bateaux:",r),this.uiManager.showNotification(`Erreur de connexion: ${r.message}`,"error"),this.renderBoats([])}finally{const r=document.getElementById("boats-loading");r&&(r.style.display="none")}}renderBoats(e){const t=document.getElementById("boats-grid");if(t){if(t.innerHTML="",e.length===0){t.innerHTML=`
        <div class="no-results">
          <h3>Aucun bateau trouvé</h3>
          <p>Essayez de modifier vos critères de recherche</p>
        </div>
      `;return}e.forEach(r=>{try{const a=this.createBoatCard(r);a&&a.nodeType?t.appendChild(a):console.error("Erreur: createBoatCard n'a pas retourné un élément DOM valide pour le bateau:",r)}catch(a){console.error("Erreur lors de la création de la carte du bateau:",a,r)}})}}createBoatCard(e){var t,r,a,o,s,n,i,c,u,h;try{if(!e||!e._id)return console.error("Données de bateau invalides:",e),this.createErrorCard("Données de bateau invalides");const l=document.createElement("div");l.className="boat-card",l.setAttribute("data-boat-id",e._id);const d=e.mainImage||((r=(t=e.images)==null?void 0:t[0])==null?void 0:r.url)||"https://images.pexels.com/photos/1001682/pexels-photo-1001682.jpeg?auto=compress&cs=tinysrgb&w=400&h=300&fit=crop";l.innerHTML=`
        <div class="boat-image">
          <img src="${d}" alt="${e.name||"Bateau"}" loading="lazy">
          <div class="boat-badge">${this.formatBoatType(e.type||"voilier")}</div>
          <div class="boat-rating">
            <span class="rating-stars">${this.renderStars(((a=e.rating)==null?void 0:a.average)||0)}</span>
            <span class="rating-count">(${((o=e.rating)==null?void 0:o.totalReviews)||0})</span>
          </div>
        </div>
        <div class="boat-content">
          <h3 class="boat-name">${e.name||"Nom non disponible"}</h3>
          <p class="boat-location">📍 ${((s=e.location)==null?void 0:s.city)||"Ville"}, ${((n=e.location)==null?void 0:n.country)||"Pays"}</p>
          <div class="boat-specs">
            <span class="spec">👥 ${((i=e.capacity)==null?void 0:i.maxPeople)||0} pers.</span>
            <span class="spec">📏 ${((c=e.specifications)==null?void 0:c.length)||0}m</span>
            ${(u=e.capacity)!=null&&u.cabins?`<span class="spec">🛏️ ${e.capacity.cabins} cabines</span>`:""}
          </div>
          <div class="boat-price">
            <span class="price">${((h=e.pricing)==null?void 0:h.dailyRate)||0}€</span>
            <span class="price-unit">/jour</span>
          </div>
          <button class="btn-primary btn-full boat-details-btn">Voir les détails</button>
        </div>
      `;const p=l.querySelector(".boat-details-btn");return p&&p.addEventListener("click",()=>this.showBoatDetails(e._id)),l}catch(l){return console.error("Erreur lors de la création de la carte de bateau:",l,e),this.createErrorCard("Erreur lors du chargement")}}createErrorCard(e){const t=document.createElement("div");return t.className="boat-card error-card",t.innerHTML=`
      <div class="boat-content">
        <h3>Erreur</h3>
        <p>${e}</p>
      </div>
    `,t}formatBoatType(e){return{voilier:"Voilier",catamaran:"Catamaran",yacht:"Yacht",bateau_moteur:"Bateau à moteur",semi_rigide:"Semi-rigide",peniche:"Péniche"}[e]||e}renderStars(e){const t=Math.floor(e),r=e%1>=.5,a=5-t-(r?1:0);let o="";for(let s=0;s<t;s++)o+="⭐";r&&(o+="⭐");for(let s=0;s<a;s++)o+="☆";return o}async showBoatDetails(e){try{this.uiManager.showLoading("boat-modal");const t=await this.boatService.getBoatById(e);t.success?(this.renderBoatDetails(t.data.boat),this.uiManager.showModal("boat-modal")):this.uiManager.showNotification("Erreur lors du chargement des détails","error")}catch(t){console.error("Erreur lors du chargement des détails:",t),this.uiManager.showNotification("Erreur lors du chargement des détails","error")}finally{this.uiManager.hideLoading("boat-modal")}}renderBoatDetails(e){var a,o,s,n,i,c,u;const t=document.getElementById("boat-modal-title"),r=document.getElementById("boat-details");t&&(t.textContent=e.name),r&&(r.innerHTML=`
        <div class="boat-details-content">
          <div class="boat-gallery">
            <div class="main-image">
              <img src="${e.mainImage||((o=(a=e.images)==null?void 0:a[0])==null?void 0:o.url)}" alt="${e.name}">
            </div>
            ${((s=e.images)==null?void 0:s.length)>1?`
              <div class="image-thumbnails">
                ${e.images.slice(1,5).map(h=>`
                  <img src="${h.url}" alt="${h.caption||e.name}" class="thumbnail">
                `).join("")}
              </div>
            `:""}
          </div>
          
          <div class="boat-info">
            <div class="boat-header">
              <div class="boat-meta">
                <span class="boat-type">${this.formatBoatType(e.type)}</span>
                <span class="boat-category">${e.category}</span>
              </div>
              <div class="boat-rating-large">
                ${this.renderStars(((n=e.rating)==null?void 0:n.average)||0)}
                <span class="rating-text">${((c=(i=e.rating)==null?void 0:i.average)==null?void 0:c.toFixed(1))||"0.0"} (${((u=e.rating)==null?void 0:u.totalReviews)||0} avis)</span>
              </div>
            </div>
            
            <p class="boat-description">${e.description}</p>
            
            <div class="boat-specs-grid">
              <div class="spec-item">
                <strong>Capacité:</strong> ${e.capacity.maxPeople} personnes
              </div>
              <div class="spec-item">
                <strong>Longueur:</strong> ${e.specifications.length}m
              </div>
              <div class="spec-item">
                <strong>Largeur:</strong> ${e.specifications.width}m
              </div>
              ${e.capacity.cabins?`
                <div class="spec-item">
                  <strong>Cabines:</strong> ${e.capacity.cabins}
                </div>
              `:""}
              ${e.capacity.berths?`
                <div class="spec-item">
                  <strong>Couchages:</strong> ${e.capacity.berths}
                </div>
              `:""}
              ${e.capacity.bathrooms?`
                <div class="spec-item">
                  <strong>Salles de bain:</strong> ${e.capacity.bathrooms}
                </div>
              `:""}
            </div>
            
            <div class="boat-location-info">
              <h3>Localisation</h3>
              <p>📍 ${e.location.marina}, ${e.location.city}, ${e.location.country}</p>
            </div>
            
            <div class="boat-pricing">
              <div class="price-main">
                <span class="price-amount">${e.pricing.dailyRate}€</span>
                <span class="price-unit">/jour</span>
              </div>
              ${e.pricing.weeklyRate?`
                <div class="price-secondary">
                  <span class="price-amount">${e.pricing.weeklyRate}€</span>
                  <span class="price-unit">/semaine</span>
                </div>
              `:""}
              <div class="price-details">
                <p>Caution: ${e.pricing.securityDeposit}€</p>
                ${e.pricing.cleaningFee>0?`<p>Frais de nettoyage: ${e.pricing.cleaningFee}€</p>`:""}
              </div>
            </div>
            
            <div class="boat-actions">
              ${this.currentUser?`
                <button class="btn-primary btn-large" onclick="app.initiateBooking('${e._id}')">
                  Réserver maintenant
                </button>
              `:`
                <button class="btn-primary btn-large" onclick="app.uiManager.showModal('login-modal')">
                  Connectez-vous pour réserver
                </button>
              `}
            </div>
          </div>
        </div>
      `)}renderPagination(e){const t=document.getElementById("boats-pagination"),r=document.getElementById("page-numbers"),a=document.getElementById("prev-page"),o=document.getElementById("next-page");if(!t||!r)return;if(e.pages<=1){t.style.display="none";return}t.style.display="flex",a&&(a.disabled=e.page<=1),o&&(o.disabled=e.page>=e.pages),r.innerHTML="";const s=Math.max(1,e.page-2),n=Math.min(e.pages,e.page+2);for(let i=s;i<=n;i++){const c=document.createElement("button");c.className=`btn-page ${i===e.page?"active":""}`,c.textContent=i,c.addEventListener("click",()=>this.changePage(i)),r.appendChild(c)}}async changePage(e){if(e<1)return;await this.loadBoats(this.currentFilters,e);const t=document.getElementById("boats");t&&t.scrollIntoView({behavior:"smooth"})}async handleSearch(){const e=document.getElementById("search-location").value;document.getElementById("search-start-date").value,document.getElementById("search-end-date").value;const t=document.getElementById("search-guests").value,r={};e&&(r.search=e),t&&(r.minCapacity=t);const a=document.getElementById("boats");a&&a.scrollIntoView({behavior:"smooth"}),await this.loadBoats(r,1)}async applyFilters(){const e={},t=document.getElementById("filter-type").value,r=document.getElementById("filter-price").value,a=document.getElementById("filter-capacity").value;t&&(e.type=t),r&&(e.maxPrice=r),a&&(e.minCapacity=a),await this.loadBoats(e,1)}async handleContactForm(e){e.preventDefault();const t=document.getElementById("contact-name").value,r=document.getElementById("contact-email").value,a=document.getElementById("contact-message").value;try{this.uiManager.showLoading("contact-form");const o=await fetch(`${this.apiBaseUrl||""}/api/contact`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:r,message:a})}),s=await o.json();if(!o.ok||!s.success)throw new Error(s.message||"Échec de l'envoi du message");this.uiManager.showNotification("Message envoyé avec succès !","success"),document.getElementById("contact-form").reset()}catch(o){console.error("Erreur lors de l'envoi du message:",o),this.uiManager.showNotification("Erreur lors de l'envoi du message","error")}finally{this.uiManager.hideLoading("contact-form")}}setupNavigation(){const e=document.querySelectorAll("section[id]"),t=document.querySelectorAll(".nav-link");if(e.length>0&&window.location.pathname==="/"||window.location.pathname.endsWith("index.html")){const r=new IntersectionObserver(a=>{a.forEach(o=>{if(o.isIntersecting){const s=o.target.getAttribute("id");t.forEach(n=>{n.classList.remove("active"),n.getAttribute("href")===`#${s}`&&n.classList.add("active")})}})},{threshold:.3,rootMargin:"-100px 0px -100px 0px"});e.forEach(a=>r.observe(a))}}setupImageUpload(){const e=document.getElementById("boat-image-input"),t=document.getElementById("image-preview-container");e&&t&&e.addEventListener("change",s=>{this.handleImageSelection(s.target.files,"add")});const r=document.getElementById("edit-boat-images"),a=document.getElementById("edit-image-preview-container");r&&a&&r.addEventListener("change",s=>{this.handleImageSelection(s.target.files,"edit")});const o=document.getElementById("edit-image-upload-area");o&&o.addEventListener("click",()=>{r.click()})}handleImageSelection(e,t="add"){const a=["image/jpeg","image/jpg","image/png","image/webp"];Array.from(e).forEach(o=>{if(o.size>5242880){this.uiManager.showNotification(`L'image ${o.name} est trop volumineuse (max 5MB)`,"error");return}if(!a.includes(o.type)){this.uiManager.showNotification(`Format non supporté pour ${o.name}`,"error");return}t==="add"?(this.selectedImages.push(o),this.addImagePreview(o)):t==="edit"&&this.addEditImagePreview(o)})}addImagePreview(e){const t=document.getElementById("image-preview-container"),r=new FileReader;r.onload=a=>{const o=document.createElement("div");o.className="image-preview",o.innerHTML=`
        <img src="${a.target.result}" alt="Aperçu">
        <button type="button" class="remove-image" onclick="app.removeImage('${e.name}')">×</button>
      `,t.appendChild(o)},r.readAsDataURL(e)}addEditImagePreview(e){const t=document.getElementById("edit-image-preview-container"),r=new FileReader;r.onload=a=>{const o=document.createElement("div");o.className="image-preview-item new",o.innerHTML=`
        <img src="${a.target.result}" alt="Aperçu">
        <button type="button" class="remove-image-btn" onclick="app.removeEditImage('${e.name}')">×</button>
      `,t.appendChild(o)},r.readAsDataURL(e)}removeImage(e){this.selectedImages=this.selectedImages.filter(t=>t.name!==e),this.updateImagePreviews()}removeEditImage(e){document.getElementById("edit-image-preview-container").querySelectorAll(".image-preview-item.new").forEach(a=>{const o=a.querySelector("img");o&&o.src.includes(e)&&a.remove()})}removeExistingImage(e){const r=document.getElementById("edit-image-preview-container").querySelectorAll(".image-preview-item.existing");r[e]&&r[e].remove()}updateImagePreviews(){const e=document.getElementById("image-preview-container");e.innerHTML="",this.selectedImages.forEach(t=>{this.addImagePreview(t)})}async handleAddBoat(e){if(e.preventDefault(),!this.currentUser){this.uiManager.showNotification("Vous devez être connecté pour ajouter un bateau","error");return}const t=new FormData;t.append("name",document.getElementById("boat-name").value.trim()),t.append("type",document.getElementById("boat-type").value),t.append("description",document.getElementById("boat-description").value.trim()),t.append("category",document.getElementById("boat-category").value);const r=parseFloat(document.getElementById("boat-length").value),a=parseFloat(document.getElementById("boat-width").value);t.append("specifications[length]",isNaN(r)?"":r),t.append("specifications[width]",isNaN(a)?"":a);const o=parseInt(document.getElementById("boat-capacity").value,10);t.append("capacity[maxPeople]",isNaN(o)?"":o),t.append("location[city]",document.getElementById("boat-city").value.trim()),t.append("location[marina]",document.getElementById("boat-marina").value.trim()),t.append("location[country]","France");const s=parseFloat(document.getElementById("boat-daily-rate").value),n=parseFloat(document.getElementById("boat-security-deposit").value);t.append("pricing[dailyRate]",isNaN(s)?"":s),t.append("pricing[securityDeposit]",isNaN(n)?"":n),this.selectedImages&&this.selectedImages.length>0&&this.selectedImages.forEach(i=>t.append("images",i));try{this.uiManager.showLoading("add-boat-form");const i=await fetch(`${this.boatService.boatsEndpoint}`,{method:"POST",headers:{Authorization:`Bearer ${this.boatService.getAuthToken()}`},body:t}),c=await i.json();if(i.ok&&c.success)this.uiManager.showNotification("Bateau ajouté avec succès !","success"),this.uiManager.hideModal("add-boat-modal"),document.getElementById("add-boat-form").reset(),this.selectedImages=[],this.updateImagePreviews(),document.getElementById("my-boats-modal").classList.contains("active")&&await this.loadOwnerBoats();else throw new Error(c.message||"Erreur lors de l'ajout du bateau")}catch(i){console.error("Erreur lors de l'ajout du bateau:",i),this.uiManager.showNotification(`Erreur: ${i.message}`,"error")}finally{this.uiManager.hideLoading("add-boat-form")}}async handleEditBoat(e){if(e.preventDefault(),!this.currentUser){this.uiManager.showNotification("Vous devez être connecté pour modifier un bateau","error");return}const t=e.target,r=t.dataset.boatId;if(!r){this.uiManager.showNotification("ID du bateau manquant","error");return}const a=new FormData(t),o=["name","type","category","length","width","capacity","city","pricePerDay","deposit"];for(const s of o)if(!a.get(s)){this.uiManager.showNotification(`Le champ ${s} est requis`,"error");return}try{this.uiManager.showLoading("edit-boat-form");const s=await fetch(`${this.boatService.boatsEndpoint}/${r}`,{method:"PUT",headers:{Authorization:`Bearer ${this.currentUser.token}`},body:a}),n=await s.json();if(s.ok&&n.success)this.uiManager.showNotification("Bateau modifié avec succès !","success"),this.uiManager.hideModal("edit-boat-modal"),t.reset(),this.selectedImages=[],this.updateImagePreviews(),await this.loadBoatManagementData();else throw new Error(n.message||"Erreur lors de la modification du bateau")}catch(s){console.error("Erreur lors de la modification du bateau:",s),this.uiManager.showNotification(`Erreur: ${s.message}`,"error")}finally{this.uiManager.hideLoading("edit-boat-form")}}async initiateBooking(e){if(!this.currentUser){this.uiManager.showModal("login-modal");return}this.uiManager.showNotification("Fonctionnalité de réservation en cours de développement","info")}initBoatManagement(){console.log("🚤 Initialisation de la gestion des bateaux..."),window.location.pathname.includes("boat-management.html")&&(this.setupBoatManagementEventListeners(),this.loadBoatManagementData())}setupBoatManagementEventListeners(){const e=document.getElementById("status-filter"),t=document.getElementById("type-filter"),r=document.getElementById("search-input"),a=document.getElementById("search-btn");e&&e.addEventListener("change",()=>this.filterBoats()),t&&t.addEventListener("change",()=>this.filterBoats()),r&&r.addEventListener("input",()=>this.debounceSearch()),a&&a.addEventListener("click",()=>this.filterBoats());const o=document.getElementById("grid-view-btn"),s=document.getElementById("list-view-btn");o&&o.addEventListener("click",()=>this.setViewMode("grid")),s&&s.addEventListener("click",()=>this.setViewMode("list"));const n=document.getElementById("prev-page-btn"),i=document.getElementById("next-page-btn");n&&n.addEventListener("click",()=>this.changePage(-1)),i&&i.addEventListener("click",()=>this.changePage(1));const c=document.getElementById("retry-btn");c&&c.addEventListener("click",()=>this.loadBoatManagementData());const u=document.getElementById("add-first-boat-btn");u&&u.addEventListener("click",()=>{this.uiManager.showModal("add-boat-modal")})}async loadBoatManagementData(){try{this.showLoadingState();const[e,t]=await Promise.all([this.boatService.getBoatStats(),this.boatService.getOwnerBoats()]);e.success&&this.updateStats(e.data.overview),t.success&&(this.displayBoats(t.data.boats),this.updatePagination(t.data.pagination)),this.hideLoadingState()}catch(e){console.error("Erreur lors du chargement des données:",e),this.showErrorState(e.message)}}showLoadingState(){const e=document.getElementById("loading-message"),t=document.getElementById("error-message"),r=document.getElementById("empty-message"),a=document.getElementById("boats-grid");e&&(e.style.display="block"),t&&(t.style.display="none"),r&&(r.style.display="none"),a&&(a.style.display="none")}hideLoadingState(){const e=document.getElementById("loading-message");e&&(e.style.display="none")}showErrorState(e){const t=document.getElementById("loading-message"),r=document.getElementById("error-message"),a=document.getElementById("error-text"),o=document.getElementById("empty-message"),s=document.getElementById("boats-grid");t&&(t.style.display="none"),r&&(r.style.display="block"),a&&(a.textContent=e),o&&(o.style.display="none"),s&&(s.style.display="none")}updateStats(e){const t=document.getElementById("total-boats"),r=document.getElementById("available-boats"),a=document.getElementById("total-bookings"),o=document.getElementById("total-revenue");t&&(t.textContent=e.totalBoats||0),r&&(r.textContent=e.availableBoats||0),a&&(a.textContent=e.totalBookings||0),o&&(o.textContent=`${e.totalRevenue||0}€`)}displayBoats(e){const t=document.getElementById("boats-grid"),r=document.getElementById("empty-message"),a=document.getElementById("error-message");if(t){if(e.length===0){t.style.display="none",r&&(r.style.display="block"),a&&(a.style.display="none");return}t.style.display="grid",r&&(r.style.display="none"),a&&(a.style.display="none"),t.innerHTML=e.map(o=>this.createBoatCard(o)).join("")}}createBoatCard(e){var s,n,i,c,u,h,l,d;const t=e.status||"available",r=this.getStatusText(e.status),a=this.getTypeText(e.type),o=((n=(s=e.images)==null?void 0:s.find(p=>p.isMain))==null?void 0:n.url)||((c=(i=e.images)==null?void 0:i[0])==null?void 0:c.url)||"boat-icon.svg";return`
      <div class="boat-management-card ${e.isActive?"":"inactive"}" data-boat-id="${e._id}">
        <img src="${o}" alt="${e.name}" class="boat-card-image" onerror="this.src='boat-icon.svg'">
        <div class="boat-card-content">
          <div class="boat-card-header">
            <div>
              <h3 class="boat-card-title">${e.name}</h3>
              <span class="boat-card-type">${a}</span>
            </div>
            <span class="boat-card-status ${t}">${r}</span>
          </div>
          
          <div class="boat-card-info">
            <div class="boat-info-item">
              <span class="boat-info-icon">👥</span>
              <span>${((u=e.capacity)==null?void 0:u.maxPeople)||0} personnes</span>
            </div>
            <div class="boat-info-item">
              <span class="boat-info-icon">📏</span>
              <span>${((h=e.specifications)==null?void 0:h.length)||0}m</span>
            </div>
            <div class="boat-info-item">
              <span class="boat-info-icon">💰</span>
              <span>${((l=e.pricing)==null?void 0:l.dailyRate)||0}€/jour</span>
            </div>
            <div class="boat-info-item">
              <span class="boat-info-icon">📍</span>
              <span>${((d=e.location)==null?void 0:d.city)||"N/A"}</span>
            </div>
          </div>
          
          <div class="boat-card-actions">
            <button class="boat-action-btn" onclick="window.app.editBoat('${e._id}')">
              <span>✏️</span>
              Modifier
            </button>
            <button class="boat-action-btn" onclick="window.app.manageImages('${e._id}')">
              <span>🖼️</span>
              Images
            </button>
            ${e.isActive?`<button class="boat-action-btn danger" onclick="window.app.deleteBoat('${e._id}')">
                <span>🗑️</span>
                Supprimer
              </button>`:`<button class="boat-action-btn primary" onclick="window.app.restoreBoat('${e._id}')">
                <span>🔄</span>
                Restaurer
              </button>`}
          </div>
        </div>
      </div>
    `}getStatusText(e){return{available:"Disponible",booked:"Réservé",maintenance:"Maintenance",inactive:"Inactif"}[e]||"Inconnu"}getTypeText(e){return{sailboat:"Voilier",motorboat:"Bateau à moteur",catamaran:"Catamaran",yacht:"Yacht",other:"Autre"}[e]||e}async filterBoats(){var a,o,s;const e=(a=document.getElementById("status-filter"))==null?void 0:a.value,t=(o=document.getElementById("type-filter"))==null?void 0:o.value,r=(s=document.getElementById("search-input"))==null?void 0:s.value;try{this.showLoadingState();const n={};e&&(n.status=e),t&&(n.type=t),r&&(n.search=r);const i=await this.boatService.getOwnerBoats(n);i.success&&(this.displayBoats(i.data.boats),this.updatePagination(i.data.pagination))}catch(n){console.error("Erreur lors du filtrage:",n),this.showErrorState("Erreur lors du filtrage des bateaux")}}debounceSearch(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.filterBoats()},500)}setViewMode(e){const t=document.getElementById("boats-grid"),r=document.getElementById("grid-view-btn"),a=document.getElementById("list-view-btn");t&&(t.className=e==="grid"?"boats-grid":"boats-grid list-view"),r&&r.classList.toggle("active",e==="grid"),a&&a.classList.toggle("active",e==="list")}async changePage(e){console.log("Changement de page:",e)}updatePagination(e){const t=document.getElementById("pagination"),r=document.getElementById("page-info"),a=document.getElementById("prev-page-btn"),o=document.getElementById("next-page-btn");!t||!e||(t.style.display=e.pages>1?"flex":"none",r&&(r.textContent=`Page ${e.page} sur ${e.pages}`),a&&(a.disabled=e.page<=1),o&&(o.disabled=e.page>=e.pages))}async editBoat(e){try{const t=await this.boatService.getBoatById(e);if(t.success){const r=t.data.boat;this.showEditBoatModal(r)}else throw new Error(t.message)}catch(t){console.error("Erreur lors de la récupération du bateau:",t),this.uiManager.showNotification(`Erreur: ${t.message}`,"error")}}manageImages(e){this.uiManager.showNotification("Fonctionnalité de gestion d'images en cours de développement","info")}async deleteBoat(e){if(confirm("Êtes-vous sûr de vouloir supprimer ce bateau ?"))try{const t=await this.boatService.deleteBoat(e);if(t.success)this.uiManager.showNotification("Bateau supprimé avec succès","success"),await this.loadBoatManagementData();else throw new Error(t.message)}catch(t){console.error("Erreur lors de la suppression:",t),this.uiManager.showNotification(`Erreur: ${t.message}`,"error")}}async restoreBoat(e){try{const t=await this.boatService.restoreBoat(e);if(t.success)this.uiManager.showNotification("Bateau restauré avec succès","success"),await this.loadBoatManagementData();else throw new Error(t.message)}catch(t){console.error("Erreur lors de la restauration:",t),this.uiManager.showNotification(`Erreur: ${t.message}`,"error")}}showAddBoatModal(){this.uiManager.showModal("add-boat-modal")}showEditBoatModal(e){this.populateEditForm(e),this.uiManager.showModal("edit-boat-modal")}populateEditForm(e){const t=document.getElementById("edit-boat-name"),r=document.getElementById("edit-boat-type"),a=document.getElementById("edit-boat-category"),o=document.getElementById("edit-boat-description"),s=document.getElementById("edit-boat-length"),n=document.getElementById("edit-boat-width"),i=document.getElementById("edit-boat-capacity"),c=document.getElementById("edit-boat-city"),u=document.getElementById("edit-boat-marina"),h=document.getElementById("edit-boat-price"),l=document.getElementById("edit-boat-deposit"),d=document.getElementById("edit-boat-form");t&&(t.value=e.name||""),r&&(r.value=e.type||""),a&&(a.value=e.category||""),o&&(o.value=e.description||""),s&&(s.value=e.length||""),n&&(n.value=e.width||""),i&&(i.value=e.capacity||""),c&&(c.value=e.city||""),u&&(u.value=e.marina||""),h&&(h.value=e.pricePerDay||""),l&&(l.value=e.deposit||""),d&&(d.dataset.boatId=e._id),this.displayExistingImages(e.images||[])}displayExistingImages(e){const t=document.getElementById("edit-image-preview-container");t&&(t.innerHTML="",e&&e.length>0&&e.forEach((r,a)=>{const o=document.createElement("div");o.className="image-preview-item existing",o.innerHTML=`
          <img src="${r}" alt="Image du bateau">
          <button type="button" class="remove-image-btn" onclick="app.removeExistingImage(${a})">×</button>
        `,t.appendChild(o)}))}}document.addEventListener("DOMContentLoaded",()=>{window.app=new B});export{B as S};
