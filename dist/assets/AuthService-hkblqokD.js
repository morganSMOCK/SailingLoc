(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();class c{constructor(){this.baseURL="https://sailingloc.onrender.com/api",this.authEndpoint=`${this.baseURL}/auth`}async register(e){try{const r=await fetch(`${this.authEndpoint}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log("üì° R√©ponse HTTP:",{status:r.status,statusText:r.statusText,ok:r.ok,url:r.url});let t;try{t=await r.json(),console.log("üìä Donn√©es JSON re√ßues:",t)}catch(o){console.error("‚ùå Erreur parsing JSON:",o);const n=await r.text();throw console.log("üìÑ R√©ponse texte:",n),new Error(`R√©ponse invalide du serveur: ${r.status}`)}if(!r.ok)throw console.error("‚ùå R√©ponse HTTP non-OK:",r.status,t),new Error(t.message||"Erreur lors de l'inscription");return t}catch(r){throw console.error("‚ùå Erreur AuthService.register:",r),r}}async login(e,r){try{const t=`${this.authEndpoint}/login`;console.log("üîê AuthService.login appel√©"),console.log("üìç URL:",t),console.log("üìä Donn√©es:",{email:e,password:r?"***":"vide"});const o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r})});console.log("üì° R√©ponse HTTP:",{status:o.status,statusText:o.statusText,ok:o.ok,url:o.url});let n;try{n=await o.json(),console.log("üìä Donn√©es JSON re√ßues:",n)}catch(s){console.error("‚ùå Erreur parsing JSON:",s);const i=await o.text();throw console.log("üìÑ R√©ponse texte:",i),new Error(`R√©ponse invalide du serveur: ${o.status}`)}if(!o.ok)throw console.error("‚ùå R√©ponse HTTP non-OK:",o.status,n),new Error(n.message||"Erreur lors de la connexion");return n}catch(t){throw console.error("‚ùå Erreur AuthService.login:",t),t}}async logout(){try{const e=this.getAuthToken(),r=`${this.authEndpoint}/logout`;console.log("üö™ AuthService.logout appel√©"),console.log("üìç URL:",r);const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}}});let o;try{o=await t.json()}catch{o={success:t.ok}}if(!t.ok)throw new Error(o.message||"Erreur lors de la d√©connexion");return this.clearAuthData(),o}catch(e){throw console.error("Erreur lors de la d√©connexion:",e),this.clearAuthData(),e}}async getProfile(){try{const e=this.getAuthToken();if(!e)throw new Error("Token d'authentification manquant");const r=await fetch(`${this.authEndpoint}/profile`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),t=await r.json();if(!r.ok)throw new Error(t.message||"Erreur lors de la r√©cup√©ration du profil");return t}catch(e){throw console.error("Erreur lors de la r√©cup√©ration du profil:",e),e}}async updateProfile(e){try{const r=this.getAuthToken();if(!r)throw new Error("Token d'authentification manquant");const t=await fetch(`${this.authEndpoint}/profile`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(e)}),o=await t.json();if(!t.ok)throw new Error(o.message||"Erreur lors de la mise √† jour du profil");return o}catch(r){throw console.error("Erreur lors de la mise √† jour du profil:",r),r}}async changePassword(e,r){try{const t=this.getAuthToken();if(!t)throw new Error("Token d'authentification manquant");const o=await fetch(`${this.authEndpoint}/change-password`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:r})}),n=await o.json();if(!o.ok)throw new Error(n.message||"Erreur lors du changement de mot de passe");return n}catch(t){throw console.error("Erreur lors du changement de mot de passe:",t),t}}async verifyToken(){try{const e=this.getAuthToken();if(!e)throw new Error("Aucun token trouv√©");const r=await fetch(`${this.authEndpoint}/verify-token`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),t=await r.json();if(!r.ok)throw new Error(t.message||"Token invalide");return t}catch(e){throw console.error("Erreur lors de la v√©rification du token:",e),e}}getAuthToken(){try{return localStorage.getItem("sailingloc_token")}catch(e){return console.error("Erreur lors de la r√©cup√©ration du token:",e),null}}isAuthenticated(){const e=this.getAuthToken();if(!e)return!1;try{const r=JSON.parse(atob(e.split(".")[1])),t=Date.now()/1e3;return r.exp>t}catch(r){return console.error("Token invalide:",r),!1}}getCurrentUser(){try{const e=localStorage.getItem("sailingloc_user");return e?JSON.parse(e):null}catch(e){return console.error("Erreur lors de la r√©cup√©ration des donn√©es utilisateur:",e),null}}clearAuthData(){try{localStorage.removeItem("sailingloc_token"),localStorage.removeItem("sailingloc_user")}catch(e){console.error("Erreur lors du nettoyage des donn√©es d'authentification:",e)}}handleAuthError(e){return(e.message.includes("Token")||e.message.includes("401"))&&this.clearAuthData(),{success:!1,message:e.message||"Erreur d'authentification",error:e}}async refreshToken(){try{const e=this.getAuthToken();if(!e)throw new Error("Aucun token √† rafra√Æchir");const r=await fetch(`${this.authEndpoint}/refresh-token`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),t=await r.json();if(!r.ok)throw new Error(t.message||"Erreur lors du rafra√Æchissement du token");return t.data&&t.data.token&&localStorage.setItem("sailingloc_token",t.data.token),t}catch(e){throw console.error("Erreur lors du rafra√Æchissement du token:",e),this.clearAuthData(),e}}async authenticatedFetch(e,r={}){const t=this.getAuthToken();if(!t)throw new Error("Authentification requise");const o={...r,headers:{...r.headers,Authorization:`Bearer ${t}`,"Content-Type":"application/json"}};try{const n=await fetch(e,o);if(n.status===401)try{await this.refreshToken();const s=this.getAuthToken();return o.headers.Authorization=`Bearer ${s}`,await fetch(e,o)}catch{throw this.clearAuthData(),new Error("Session expir√©e, veuillez vous reconnecter")}return n}catch(n){throw console.error("Erreur lors de la requ√™te authentifi√©e:",n),n}}}export{c as A};
