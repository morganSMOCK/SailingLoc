<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Carte de Bateau - SailingLoc</title>
  <style>
    body {
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    .test-container {
      max-width: 800px;
      margin: 0 auto;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .boats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .test-data {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
    }
  </style>
  <link rel="stylesheet" crossorigin href="/assets/style-Deg_6pYg.css">
</head>
<body>
  <div class="test-container">
    <h1>Test de Cr√©ation de Cartes de Bateaux</h1>
    
    <div class="test-section">
      <h2>Donn√©es de Test</h2>
      <p>Voici les donn√©es du bateau qui causait l'erreur :</p>
      <div class="test-data" id="test-data"></div>
    </div>
    
    <div class="test-section">
      <h2>R√©sultat du Test</h2>
      <p>Cliquez sur le bouton pour tester la cr√©ation de la carte :</p>
      <button id="test-btn" onclick="testBoatCard()">Tester la Cr√©ation de Carte</button>
      <div id="test-result"></div>
    </div>
    
    <div class="test-section">
      <h2>Cartes Cr√©√©es</h2>
      <div class="boats-grid" id="boats-grid">
        <!-- Les cartes de test appara√Ætront ici -->
      </div>
    </div>
  </div>

  <script>
    // Donn√©es du bateau qui causait l'erreur
    const testBoatData = {
      specifications: {
        length: 10,
        width: 10,
        fuelType: 'diesel'
      },
      capacity: {
        maxPeople: 10
      },
      location: {
        city: 'Nice',
        marina: 'Port de Canne',
        country: 'France'
      },
      pricing: {
        dailyRate: 200,
        securityDeposit: 1000,
        currency: 'EUR'
      },
      _id: '68c45f5ff0ebd2594d8f434e',
      amenities: [],
      category: 'standard',
      createdAt: '2025-09-12T17:58:55.559Z',
      description: 'gregerg',
      id: '68c45f5ff0ebd2594d8f434e',
      imageUrls: [],
      images: [],
      isActive: true,
      name: 'Bateau morgan',
      owner: {
        _id: '68befdaea15ed31c9bb53d0c',
        firstName: 'Martin',
        lastName: 'Clara',
        fullName: 'Martin Clara',
        id: '68befdaea15ed31c9bb53d0c'
      },
      rules: [],
      status: 'available',
      type: 'bateau √† moteur',
      updatedAt: '2025-09-12T17:58:55.559Z',
      __v: 0
    };

    // Afficher les donn√©es de test
    document.getElementById('test-data').textContent = JSON.stringify(testBoatData, null, 2);

    // Fonction de test
    function testBoatCard() {
      const resultDiv = document.getElementById('test-result');
      const boatsGrid = document.getElementById('boats-grid');
      
      try {
        console.log('üß™ Test de cr√©ation de carte de bateau...');
        console.log('Donn√©es:', testBoatData);
        
        // Simuler la fonction createBoatCard
        const card = createBoatCard(testBoatData);
        
        if (card && card.nodeType) {
          resultDiv.innerHTML = '<p style="color: green;">‚úÖ Succ√®s ! La carte a √©t√© cr√©√©e correctement.</p>';
          boatsGrid.appendChild(card);
          console.log('‚úÖ Carte cr√©√©e avec succ√®s:', card);
        } else {
          resultDiv.innerHTML = '<p style="color: red;">‚ùå Erreur ! La carte n\'a pas √©t√© cr√©√©e correctement.</p>';
          console.error('‚ùå Erreur: createBoatCard n\'a pas retourn√© un √©l√©ment DOM valide');
        }
      } catch (error) {
        resultDiv.innerHTML = `<p style="color: red;">‚ùå Erreur: ${error.message}</p>`;
        console.error('‚ùå Erreur lors du test:', error);
      }
    }

    // Fonction createBoatCard simplifi√©e pour le test
    function createBoatCard(boat) {
      try {
        // Validation des donn√©es du bateau
        if (!boat || !boat._id) {
          console.error('Donn√©es de bateau invalides:', boat);
          return createErrorCard('Donn√©es de bateau invalides');
        }

        const card = document.createElement('div');
        card.className = 'boat-card';
        card.setAttribute('data-boat-id', boat._id);
        
        // Gestion des images - essayer plusieurs sources
        let mainImage = 'https://images.pexels.com/photos/1001682/pexels-photo-1001682.jpeg?auto=compress&cs=tinysrgb&w=400&h=300&fit=crop';
        
        if (boat.mainImage) {
          mainImage = boat.mainImage;
        } else if (boat.images && boat.images.length > 0) {
          // Chercher une image avec URL
          const imageWithUrl = boat.images.find(img => img.url);
          if (imageWithUrl) {
            mainImage = imageWithUrl.url;
          }
        } else if (boat.imageUrls && boat.imageUrls.length > 0) {
          mainImage = boat.imageUrls[0];
        }
        
        // Nettoyer les donn√©es pour √©viter les erreurs d'affichage
        const boatName = (boat.name || 'Nom non disponible').replace(/[<>]/g, '');
        const boatType = formatBoatType(boat.type || 'voilier');
        const city = (boat.location?.city || 'Ville').replace(/[<>]/g, '');
        const country = (boat.location?.country || 'Pays').replace(/[<>]/g, '');
        const maxPeople = boat.capacity?.maxPeople || 0;
        const length = boat.specifications?.length || 0;
        const dailyRate = boat.pricing?.dailyRate || 0;
        const rating = boat.rating?.average || 0;
        const totalReviews = boat.rating?.totalReviews || 0;
        
        card.innerHTML = `
          <div class="boat-image">
            <img src="${mainImage}" alt="${boatName}" loading="lazy" onerror="this.src='https://images.pexels.com/photos/1001682/pexels-photo-1001682.jpeg?auto=compress&cs=tinysrgb&w=400&h=300&fit=crop'">
            <div class="boat-badge">${boatType}</div>
            <div class="boat-rating">
              <span class="rating-stars">${renderStars(rating)}</span>
              <span class="rating-count">(${totalReviews})</span>
            </div>
          </div>
          <div class="boat-content">
            <h3 class="boat-name">${boatName}</h3>
            <p class="boat-location">üìç ${city}, ${country}</p>
            <div class="boat-specs">
              <span class="spec">üë• ${maxPeople} pers.</span>
              <span class="spec">üìè ${length}m</span>
              ${boat.capacity?.cabins ? `<span class="spec">üõèÔ∏è ${boat.capacity.cabins} cabines</span>` : ''}
            </div>
            <div class="boat-price">
              <span class="price">${dailyRate}‚Ç¨</span>
              <span class="price-unit">/jour</span>
            </div>
            <button class="btn-primary btn-full boat-details-btn">Voir les d√©tails</button>
          </div>
        `;
        
        return card;
      } catch (error) {
        console.error('Erreur lors de la cr√©ation de la carte de bateau:', error, boat);
        return createErrorCard('Erreur lors du chargement');
      }
    }

    // Fonctions utilitaires
    function createErrorCard(message) {
      const card = document.createElement('div');
      card.className = 'boat-card error-card';
      card.innerHTML = `
        <div class="boat-content">
          <h3>Erreur</h3>
          <p>${message}</p>
        </div>
      `;
      return card;
    }

    function formatBoatType(type) {
      const types = {
        'voilier': 'Voilier',
        'catamaran': 'Catamaran',
        'yacht': 'Yacht',
        'bateau_moteur': 'Bateau √† moteur',
        'bateau √† moteur': 'Bateau √† moteur',
        'semi_rigide': 'Semi-rigide',
        'peniche': 'P√©niche'
      };
      return types[type] || type;
    }

    function renderStars(rating) {
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 >= 0.5;
      const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
      
      let stars = '';
      
      // √âtoiles pleines
      for (let i = 0; i < fullStars; i++) {
        stars += '‚≠ê';
      }
      
      // Demi-√©toile
      if (hasHalfStar) {
        stars += '‚≠ê';
      }
      
      // √âtoiles vides
      for (let i = 0; i < emptyStars; i++) {
        stars += '‚òÜ';
      }
      
      return stars;
    }
  </script>
</body>
</html>
